"use strict";var r0=Object.defineProperty;var i0=(f,i,r)=>i in f?r0(f,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[i]=r;var nu=(f,i,r)=>(i0(f,typeof i!="symbol"?i+"":i,r),r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var $n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bs(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Wr={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Wr.exports;(function(f,i){(function(){var r,o="4.17.21",l=200,d="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",_="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,C="__lodash_placeholder__",v=1,T=2,D=4,N=1,I=2,O=1,$=2,j=4,X=8,nt=16,bt=32,At=64,Pt=128,Gt=256,te=512,Ht=30,Mn="...",Gn=800,Gr=16,Cn=1,Hn=2,Hr=3,Ce=1/0,ge=9007199254740991,Kn=17976931348623157e292,Se=NaN,L=4294967295,z=L-1,q=L>>>1,lt=[["ary",Pt],["bind",O],["bindKey",$],["curry",X],["curryRight",nt],["flip",te],["partial",bt],["partialRight",At],["rearg",Gt]],tt="[object Arguments]",ft="[object Array]",at="[object AsyncFunction]",ut="[object Boolean]",yt="[object Date]",Kt="[object DOMException]",Ft="[object Error]",Wt="[object Function]",_e="[object GeneratorFunction]",gt="[object Map]",Lt="[object Number]",Re="[object Null]",wt="[object Object]",Bt="[object Promise]",le="[object Proxy]",ee="[object RegExp]",ht="[object Set]",ve="[object String]",Jn="[object Symbol]",bu="[object Undefined]",Sn="[object WeakMap]",Mu="[object WeakSet]",xn="[object ArrayBuffer]",sn="[object DataView]",Kr="[object Float32Array]",Jr="[object Float64Array]",Zr="[object Int8Array]",Yr="[object Int16Array]",jr="[object Int32Array]",Xr="[object Uint8Array]",Qr="[object Uint8ClampedArray]",Vr="[object Uint16Array]",ti="[object Uint32Array]",Cu=/\b__p \+= '';/g,Su=/\b(__p \+=) '' \+/g,xu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,As=/&(?:amp|lt|gt|quot|#39);/g,Ps=/[&<>"']/g,Au=RegExp(As.source),Pu=RegExp(Ps.source),Tu=/<%-([\s\S]+?)%>/g,Eu=/<%([\s\S]+?)%>/g,Ts=/<%=([\s\S]+?)%>/g,Iu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ou=/^\w*$/,Fu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ei=/[\\^$.*+?()[\]{}|]/g,Lu=RegExp(ei.source),ni=/^\s+/,Ru=/\s/,ku=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Du=/\{\n\/\* \[wrapped with (.+)\] \*/,Nu=/,? & /,Wu=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Bu=/[()=,{}\[\]\/\s]/,Uu=/\\(\\)?/g,$u=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Es=/\w*$/,zu=/^[-+]0x[0-9a-f]+$/i,qu=/^0b[01]+$/i,Gu=/^\[object .+?Constructor\]$/,Hu=/^0o[0-7]+$/i,Ku=/^(?:0|[1-9]\d*)$/,Ju=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zn=/($^)/,Zu=/['\n\r\u2028\u2029\\]/g,Yn="\\ud800-\\udfff",Yu="\\u0300-\\u036f",ju="\\ufe20-\\ufe2f",Xu="\\u20d0-\\u20ff",Is=Yu+ju+Xu,Os="\\u2700-\\u27bf",Fs="a-z\\xdf-\\xf6\\xf8-\\xff",Qu="\\xac\\xb1\\xd7\\xf7",Vu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",tc="\\u2000-\\u206f",ec=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ls="A-Z\\xc0-\\xd6\\xd8-\\xde",Rs="\\ufe0e\\ufe0f",ks=Qu+Vu+tc+ec,ri="['’]",nc="["+Yn+"]",Ds="["+ks+"]",jn="["+Is+"]",Ns="\\d+",rc="["+Os+"]",Ws="["+Fs+"]",Bs="[^"+Yn+ks+Ns+Os+Fs+Ls+"]",ii="\\ud83c[\\udffb-\\udfff]",ic="(?:"+jn+"|"+ii+")",Us="[^"+Yn+"]",si="(?:\\ud83c[\\udde6-\\uddff]){2}",ai="[\\ud800-\\udbff][\\udc00-\\udfff]",an="["+Ls+"]",$s="\\u200d",zs="(?:"+Ws+"|"+Bs+")",sc="(?:"+an+"|"+Bs+")",qs="(?:"+ri+"(?:d|ll|m|re|s|t|ve))?",Gs="(?:"+ri+"(?:D|LL|M|RE|S|T|VE))?",Hs=ic+"?",Ks="["+Rs+"]?",ac="(?:"+$s+"(?:"+[Us,si,ai].join("|")+")"+Ks+Hs+")*",oc="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",uc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Js=Ks+Hs+ac,cc="(?:"+[rc,si,ai].join("|")+")"+Js,lc="(?:"+[Us+jn+"?",jn,si,ai,nc].join("|")+")",fc=RegExp(ri,"g"),hc=RegExp(jn,"g"),oi=RegExp(ii+"(?="+ii+")|"+lc+Js,"g"),pc=RegExp([an+"?"+Ws+"+"+qs+"(?="+[Ds,an,"$"].join("|")+")",sc+"+"+Gs+"(?="+[Ds,an+zs,"$"].join("|")+")",an+"?"+zs+"+"+qs,an+"+"+Gs,uc,oc,Ns,cc].join("|"),"g"),dc=RegExp("["+$s+Yn+Is+Rs+"]"),gc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_c=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],vc=-1,ct={};ct[Kr]=ct[Jr]=ct[Zr]=ct[Yr]=ct[jr]=ct[Xr]=ct[Qr]=ct[Vr]=ct[ti]=!0,ct[tt]=ct[ft]=ct[xn]=ct[ut]=ct[sn]=ct[yt]=ct[Ft]=ct[Wt]=ct[gt]=ct[Lt]=ct[wt]=ct[ee]=ct[ht]=ct[ve]=ct[Sn]=!1;var ot={};ot[tt]=ot[ft]=ot[xn]=ot[sn]=ot[ut]=ot[yt]=ot[Kr]=ot[Jr]=ot[Zr]=ot[Yr]=ot[jr]=ot[gt]=ot[Lt]=ot[wt]=ot[ee]=ot[ht]=ot[ve]=ot[Jn]=ot[Xr]=ot[Qr]=ot[Vr]=ot[ti]=!0,ot[Ft]=ot[Wt]=ot[Sn]=!1;var mc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},yc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},wc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},bc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mc=parseFloat,Cc=parseInt,Zs=typeof $n=="object"&&$n&&$n.Object===Object&&$n,Sc=typeof self=="object"&&self&&self.Object===Object&&self,Tt=Zs||Sc||Function("return this")(),ui=i&&!i.nodeType&&i,Je=ui&&!0&&f&&!f.nodeType&&f,Ys=Je&&Je.exports===ui,ci=Ys&&Zs.process,ne=function(){try{var m=Je&&Je.require&&Je.require("util").types;return m||ci&&ci.binding&&ci.binding("util")}catch{}}(),js=ne&&ne.isArrayBuffer,Xs=ne&&ne.isDate,Qs=ne&&ne.isMap,Vs=ne&&ne.isRegExp,ta=ne&&ne.isSet,ea=ne&&ne.isTypedArray;function Jt(m,S,M){switch(M.length){case 0:return m.call(S);case 1:return m.call(S,M[0]);case 2:return m.call(S,M[0],M[1]);case 3:return m.call(S,M[0],M[1],M[2])}return m.apply(S,M)}function xc(m,S,M,R){for(var G=-1,et=m==null?0:m.length;++G<et;){var Mt=m[G];S(R,Mt,M(Mt),m)}return R}function re(m,S){for(var M=-1,R=m==null?0:m.length;++M<R&&S(m[M],M,m)!==!1;);return m}function Ac(m,S){for(var M=m==null?0:m.length;M--&&S(m[M],M,m)!==!1;);return m}function na(m,S){for(var M=-1,R=m==null?0:m.length;++M<R;)if(!S(m[M],M,m))return!1;return!0}function ke(m,S){for(var M=-1,R=m==null?0:m.length,G=0,et=[];++M<R;){var Mt=m[M];S(Mt,M,m)&&(et[G++]=Mt)}return et}function Xn(m,S){var M=m==null?0:m.length;return!!M&&on(m,S,0)>-1}function li(m,S,M){for(var R=-1,G=m==null?0:m.length;++R<G;)if(M(S,m[R]))return!0;return!1}function pt(m,S){for(var M=-1,R=m==null?0:m.length,G=Array(R);++M<R;)G[M]=S(m[M],M,m);return G}function De(m,S){for(var M=-1,R=S.length,G=m.length;++M<R;)m[G+M]=S[M];return m}function fi(m,S,M,R){var G=-1,et=m==null?0:m.length;for(R&&et&&(M=m[++G]);++G<et;)M=S(M,m[G],G,m);return M}function Pc(m,S,M,R){var G=m==null?0:m.length;for(R&&G&&(M=m[--G]);G--;)M=S(M,m[G],G,m);return M}function hi(m,S){for(var M=-1,R=m==null?0:m.length;++M<R;)if(S(m[M],M,m))return!0;return!1}var Tc=pi("length");function Ec(m){return m.split("")}function Ic(m){return m.match(Wu)||[]}function ra(m,S,M){var R;return M(m,function(G,et,Mt){if(S(G,et,Mt))return R=et,!1}),R}function Qn(m,S,M,R){for(var G=m.length,et=M+(R?1:-1);R?et--:++et<G;)if(S(m[et],et,m))return et;return-1}function on(m,S,M){return S===S?zc(m,S,M):Qn(m,ia,M)}function Oc(m,S,M,R){for(var G=M-1,et=m.length;++G<et;)if(R(m[G],S))return G;return-1}function ia(m){return m!==m}function sa(m,S){var M=m==null?0:m.length;return M?gi(m,S)/M:Se}function pi(m){return function(S){return S==null?r:S[m]}}function di(m){return function(S){return m==null?r:m[S]}}function aa(m,S,M,R,G){return G(m,function(et,Mt,st){M=R?(R=!1,et):S(M,et,Mt,st)}),M}function Fc(m,S){var M=m.length;for(m.sort(S);M--;)m[M]=m[M].value;return m}function gi(m,S){for(var M,R=-1,G=m.length;++R<G;){var et=S(m[R]);et!==r&&(M=M===r?et:M+et)}return M}function _i(m,S){for(var M=-1,R=Array(m);++M<m;)R[M]=S(M);return R}function Lc(m,S){return pt(S,function(M){return[M,m[M]]})}function oa(m){return m&&m.slice(0,fa(m)+1).replace(ni,"")}function Zt(m){return function(S){return m(S)}}function vi(m,S){return pt(S,function(M){return m[M]})}function An(m,S){return m.has(S)}function ua(m,S){for(var M=-1,R=m.length;++M<R&&on(S,m[M],0)>-1;);return M}function ca(m,S){for(var M=m.length;M--&&on(S,m[M],0)>-1;);return M}function Rc(m,S){for(var M=m.length,R=0;M--;)m[M]===S&&++R;return R}var kc=di(mc),Dc=di(yc);function Nc(m){return"\\"+bc[m]}function Wc(m,S){return m==null?r:m[S]}function un(m){return dc.test(m)}function Bc(m){return gc.test(m)}function Uc(m){for(var S,M=[];!(S=m.next()).done;)M.push(S.value);return M}function mi(m){var S=-1,M=Array(m.size);return m.forEach(function(R,G){M[++S]=[G,R]}),M}function la(m,S){return function(M){return m(S(M))}}function Ne(m,S){for(var M=-1,R=m.length,G=0,et=[];++M<R;){var Mt=m[M];(Mt===S||Mt===C)&&(m[M]=C,et[G++]=M)}return et}function Vn(m){var S=-1,M=Array(m.size);return m.forEach(function(R){M[++S]=R}),M}function $c(m){var S=-1,M=Array(m.size);return m.forEach(function(R){M[++S]=[R,R]}),M}function zc(m,S,M){for(var R=M-1,G=m.length;++R<G;)if(m[R]===S)return R;return-1}function qc(m,S,M){for(var R=M+1;R--;)if(m[R]===S)return R;return R}function cn(m){return un(m)?Hc(m):Tc(m)}function fe(m){return un(m)?Kc(m):Ec(m)}function fa(m){for(var S=m.length;S--&&Ru.test(m.charAt(S)););return S}var Gc=di(wc);function Hc(m){for(var S=oi.lastIndex=0;oi.test(m);)++S;return S}function Kc(m){return m.match(oi)||[]}function Jc(m){return m.match(pc)||[]}var Zc=function m(S){S=S==null?Tt:ln.defaults(Tt.Object(),S,ln.pick(Tt,_c));var M=S.Array,R=S.Date,G=S.Error,et=S.Function,Mt=S.Math,st=S.Object,yi=S.RegExp,Yc=S.String,ie=S.TypeError,tr=M.prototype,jc=et.prototype,fn=st.prototype,er=S["__core-js_shared__"],nr=jc.toString,it=fn.hasOwnProperty,Xc=0,ha=function(){var t=/[^.]+$/.exec(er&&er.keys&&er.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),rr=fn.toString,Qc=nr.call(st),Vc=Tt._,tl=yi("^"+nr.call(it).replace(ei,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=Ys?S.Buffer:r,We=S.Symbol,sr=S.Uint8Array,pa=ir?ir.allocUnsafe:r,ar=la(st.getPrototypeOf,st),da=st.create,ga=fn.propertyIsEnumerable,or=tr.splice,_a=We?We.isConcatSpreadable:r,Pn=We?We.iterator:r,Ze=We?We.toStringTag:r,ur=function(){try{var t=Ve(st,"defineProperty");return t({},"",{}),t}catch{}}(),el=S.clearTimeout!==Tt.clearTimeout&&S.clearTimeout,nl=R&&R.now!==Tt.Date.now&&R.now,rl=S.setTimeout!==Tt.setTimeout&&S.setTimeout,cr=Mt.ceil,lr=Mt.floor,wi=st.getOwnPropertySymbols,il=ir?ir.isBuffer:r,va=S.isFinite,sl=tr.join,al=la(st.keys,st),Ct=Mt.max,It=Mt.min,ol=R.now,ul=S.parseInt,ma=Mt.random,cl=tr.reverse,bi=Ve(S,"DataView"),Tn=Ve(S,"Map"),Mi=Ve(S,"Promise"),hn=Ve(S,"Set"),En=Ve(S,"WeakMap"),In=Ve(st,"create"),fr=En&&new En,pn={},ll=tn(bi),fl=tn(Tn),hl=tn(Mi),pl=tn(hn),dl=tn(En),hr=We?We.prototype:r,On=hr?hr.valueOf:r,ya=hr?hr.toString:r;function u(t){if(_t(t)&&!H(t)&&!(t instanceof Q)){if(t instanceof se)return t;if(it.call(t,"__wrapped__"))return bo(t)}return new se(t)}var dn=function(){function t(){}return function(e){if(!dt(e))return{};if(da)return da(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function pr(){}function se(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}u.templateSettings={escape:Tu,evaluate:Eu,interpolate:Ts,variable:"",imports:{_:u}},u.prototype=pr.prototype,u.prototype.constructor=u,se.prototype=dn(pr.prototype),se.prototype.constructor=se;function Q(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=L,this.__views__=[]}function gl(){var t=new Q(this.__wrapped__);return t.__actions__=Ut(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ut(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ut(this.__views__),t}function _l(){if(this.__filtered__){var t=new Q(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function vl(){var t=this.__wrapped__.value(),e=this.__dir__,n=H(t),s=e<0,a=n?t.length:0,c=If(0,a,this.__views__),h=c.start,g=c.end,y=g-h,x=s?g:h-1,A=this.__iteratees__,P=A.length,F=0,k=It(y,this.__takeCount__);if(!n||!s&&a==y&&k==y)return qa(t,this.__actions__);var B=[];t:for(;y--&&F<k;){x+=e;for(var J=-1,U=t[x];++J<P;){var Y=A[J],V=Y.iteratee,Xt=Y.type,Dt=V(U);if(Xt==Hn)U=Dt;else if(!Dt){if(Xt==Cn)continue t;break t}}B[F++]=U}return B}Q.prototype=dn(pr.prototype),Q.prototype.constructor=Q;function Ye(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function ml(){this.__data__=In?In(null):{},this.size=0}function yl(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function wl(t){var e=this.__data__;if(In){var n=e[t];return n===w?r:n}return it.call(e,t)?e[t]:r}function bl(t){var e=this.__data__;return In?e[t]!==r:it.call(e,t)}function Ml(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=In&&e===r?w:e,this}Ye.prototype.clear=ml,Ye.prototype.delete=yl,Ye.prototype.get=wl,Ye.prototype.has=bl,Ye.prototype.set=Ml;function xe(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Cl(){this.__data__=[],this.size=0}function Sl(t){var e=this.__data__,n=dr(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():or.call(e,n,1),--this.size,!0}function xl(t){var e=this.__data__,n=dr(e,t);return n<0?r:e[n][1]}function Al(t){return dr(this.__data__,t)>-1}function Pl(t,e){var n=this.__data__,s=dr(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}xe.prototype.clear=Cl,xe.prototype.delete=Sl,xe.prototype.get=xl,xe.prototype.has=Al,xe.prototype.set=Pl;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Tl(){this.size=0,this.__data__={hash:new Ye,map:new(Tn||xe),string:new Ye}}function El(t){var e=Ar(this,t).delete(t);return this.size-=e?1:0,e}function Il(t){return Ar(this,t).get(t)}function Ol(t){return Ar(this,t).has(t)}function Fl(t,e){var n=Ar(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}Ae.prototype.clear=Tl,Ae.prototype.delete=El,Ae.prototype.get=Il,Ae.prototype.has=Ol,Ae.prototype.set=Fl;function je(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ae;++e<n;)this.add(t[e])}function Ll(t){return this.__data__.set(t,w),this}function Rl(t){return this.__data__.has(t)}je.prototype.add=je.prototype.push=Ll,je.prototype.has=Rl;function he(t){var e=this.__data__=new xe(t);this.size=e.size}function kl(){this.__data__=new xe,this.size=0}function Dl(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Nl(t){return this.__data__.get(t)}function Wl(t){return this.__data__.has(t)}function Bl(t,e){var n=this.__data__;if(n instanceof xe){var s=n.__data__;if(!Tn||s.length<l-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ae(s)}return n.set(t,e),this.size=n.size,this}he.prototype.clear=kl,he.prototype.delete=Dl,he.prototype.get=Nl,he.prototype.has=Wl,he.prototype.set=Bl;function wa(t,e){var n=H(t),s=!n&&en(t),a=!n&&!s&&qe(t),c=!n&&!s&&!a&&mn(t),h=n||s||a||c,g=h?_i(t.length,Yc):[],y=g.length;for(var x in t)(e||it.call(t,x))&&!(h&&(x=="length"||a&&(x=="offset"||x=="parent")||c&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||Ie(x,y)))&&g.push(x);return g}function ba(t){var e=t.length;return e?t[Li(0,e-1)]:r}function Ul(t,e){return Pr(Ut(t),Xe(e,0,t.length))}function $l(t){return Pr(Ut(t))}function Ci(t,e,n){(n!==r&&!pe(t[e],n)||n===r&&!(e in t))&&Pe(t,e,n)}function Fn(t,e,n){var s=t[e];(!(it.call(t,e)&&pe(s,n))||n===r&&!(e in t))&&Pe(t,e,n)}function dr(t,e){for(var n=t.length;n--;)if(pe(t[n][0],e))return n;return-1}function zl(t,e,n,s){return Be(t,function(a,c,h){e(s,a,n(a),h)}),s}function Ma(t,e){return t&&ye(e,xt(e),t)}function ql(t,e){return t&&ye(e,zt(e),t)}function Pe(t,e,n){e=="__proto__"&&ur?ur(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Si(t,e){for(var n=-1,s=e.length,a=M(s),c=t==null;++n<s;)a[n]=c?r:is(t,e[n]);return a}function Xe(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function ae(t,e,n,s,a,c){var h,g=e&v,y=e&T,x=e&D;if(n&&(h=a?n(t,s,a,c):n(t)),h!==r)return h;if(!dt(t))return t;var A=H(t);if(A){if(h=Ff(t),!g)return Ut(t,h)}else{var P=Ot(t),F=P==Wt||P==_e;if(qe(t))return Ka(t,g);if(P==wt||P==tt||F&&!a){if(h=y||F?{}:fo(t),!g)return y?bf(t,ql(h,t)):wf(t,Ma(h,t))}else{if(!ot[P])return a?t:{};h=Lf(t,P,g)}}c||(c=new he);var k=c.get(t);if(k)return k;c.set(t,h),$o(t)?t.forEach(function(U){h.add(ae(U,e,n,U,t,c))}):Bo(t)&&t.forEach(function(U,Y){h.set(Y,ae(U,e,n,Y,t,c))});var B=x?y?Gi:qi:y?zt:xt,J=A?r:B(t);return re(J||t,function(U,Y){J&&(Y=U,U=t[Y]),Fn(h,Y,ae(U,e,n,Y,t,c))}),h}function Gl(t){var e=xt(t);return function(n){return Ca(n,t,e)}}function Ca(t,e,n){var s=n.length;if(t==null)return!s;for(t=st(t);s--;){var a=n[s],c=e[a],h=t[a];if(h===r&&!(a in t)||!c(h))return!1}return!0}function Sa(t,e,n){if(typeof t!="function")throw new ie(p);return Bn(function(){t.apply(r,n)},e)}function Ln(t,e,n,s){var a=-1,c=Xn,h=!0,g=t.length,y=[],x=e.length;if(!g)return y;n&&(e=pt(e,Zt(n))),s?(c=li,h=!1):e.length>=l&&(c=An,h=!1,e=new je(e));t:for(;++a<g;){var A=t[a],P=n==null?A:n(A);if(A=s||A!==0?A:0,h&&P===P){for(var F=x;F--;)if(e[F]===P)continue t;y.push(A)}else c(e,P,s)||y.push(A)}return y}var Be=Xa(me),xa=Xa(Ai,!0);function Hl(t,e){var n=!0;return Be(t,function(s,a,c){return n=!!e(s,a,c),n}),n}function gr(t,e,n){for(var s=-1,a=t.length;++s<a;){var c=t[s],h=e(c);if(h!=null&&(g===r?h===h&&!jt(h):n(h,g)))var g=h,y=c}return y}function Kl(t,e,n,s){var a=t.length;for(n=K(n),n<0&&(n=-n>a?0:a+n),s=s===r||s>a?a:K(s),s<0&&(s+=a),s=n>s?0:qo(s);n<s;)t[n++]=e;return t}function Aa(t,e){var n=[];return Be(t,function(s,a,c){e(s,a,c)&&n.push(s)}),n}function Et(t,e,n,s,a){var c=-1,h=t.length;for(n||(n=kf),a||(a=[]);++c<h;){var g=t[c];e>0&&n(g)?e>1?Et(g,e-1,n,s,a):De(a,g):s||(a[a.length]=g)}return a}var xi=Qa(),Pa=Qa(!0);function me(t,e){return t&&xi(t,e,xt)}function Ai(t,e){return t&&Pa(t,e,xt)}function _r(t,e){return ke(e,function(n){return Oe(t[n])})}function Qe(t,e){e=$e(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[we(e[n++])];return n&&n==s?t:r}function Ta(t,e,n){var s=e(t);return H(t)?s:De(s,n(t))}function Rt(t){return t==null?t===r?bu:Re:Ze&&Ze in st(t)?Ef(t):zf(t)}function Pi(t,e){return t>e}function Jl(t,e){return t!=null&&it.call(t,e)}function Zl(t,e){return t!=null&&e in st(t)}function Yl(t,e,n){return t>=It(e,n)&&t<Ct(e,n)}function Ti(t,e,n){for(var s=n?li:Xn,a=t[0].length,c=t.length,h=c,g=M(c),y=1/0,x=[];h--;){var A=t[h];h&&e&&(A=pt(A,Zt(e))),y=It(A.length,y),g[h]=!n&&(e||a>=120&&A.length>=120)?new je(h&&A):r}A=t[0];var P=-1,F=g[0];t:for(;++P<a&&x.length<y;){var k=A[P],B=e?e(k):k;if(k=n||k!==0?k:0,!(F?An(F,B):s(x,B,n))){for(h=c;--h;){var J=g[h];if(!(J?An(J,B):s(t[h],B,n)))continue t}F&&F.push(B),x.push(k)}}return x}function jl(t,e,n,s){return me(t,function(a,c,h){e(s,n(a),c,h)}),s}function Rn(t,e,n){e=$e(e,t),t=_o(t,e);var s=t==null?t:t[we(ue(e))];return s==null?r:Jt(s,t,n)}function Ea(t){return _t(t)&&Rt(t)==tt}function Xl(t){return _t(t)&&Rt(t)==xn}function Ql(t){return _t(t)&&Rt(t)==yt}function kn(t,e,n,s,a){return t===e?!0:t==null||e==null||!_t(t)&&!_t(e)?t!==t&&e!==e:Vl(t,e,n,s,kn,a)}function Vl(t,e,n,s,a,c){var h=H(t),g=H(e),y=h?ft:Ot(t),x=g?ft:Ot(e);y=y==tt?wt:y,x=x==tt?wt:x;var A=y==wt,P=x==wt,F=y==x;if(F&&qe(t)){if(!qe(e))return!1;h=!0,A=!1}if(F&&!A)return c||(c=new he),h||mn(t)?uo(t,e,n,s,a,c):Pf(t,e,y,n,s,a,c);if(!(n&N)){var k=A&&it.call(t,"__wrapped__"),B=P&&it.call(e,"__wrapped__");if(k||B){var J=k?t.value():t,U=B?e.value():e;return c||(c=new he),a(J,U,n,s,c)}}return F?(c||(c=new he),Tf(t,e,n,s,a,c)):!1}function tf(t){return _t(t)&&Ot(t)==gt}function Ei(t,e,n,s){var a=n.length,c=a,h=!s;if(t==null)return!c;for(t=st(t);a--;){var g=n[a];if(h&&g[2]?g[1]!==t[g[0]]:!(g[0]in t))return!1}for(;++a<c;){g=n[a];var y=g[0],x=t[y],A=g[1];if(h&&g[2]){if(x===r&&!(y in t))return!1}else{var P=new he;if(s)var F=s(x,A,y,t,e,P);if(!(F===r?kn(A,x,N|I,s,P):F))return!1}}return!0}function Ia(t){if(!dt(t)||Nf(t))return!1;var e=Oe(t)?tl:Gu;return e.test(tn(t))}function ef(t){return _t(t)&&Rt(t)==ee}function nf(t){return _t(t)&&Ot(t)==ht}function rf(t){return _t(t)&&Lr(t.length)&&!!ct[Rt(t)]}function Oa(t){return typeof t=="function"?t:t==null?qt:typeof t=="object"?H(t)?Ra(t[0],t[1]):La(t):tu(t)}function Ii(t){if(!Wn(t))return al(t);var e=[];for(var n in st(t))it.call(t,n)&&n!="constructor"&&e.push(n);return e}function sf(t){if(!dt(t))return $f(t);var e=Wn(t),n=[];for(var s in t)s=="constructor"&&(e||!it.call(t,s))||n.push(s);return n}function Oi(t,e){return t<e}function Fa(t,e){var n=-1,s=$t(t)?M(t.length):[];return Be(t,function(a,c,h){s[++n]=e(a,c,h)}),s}function La(t){var e=Ki(t);return e.length==1&&e[0][2]?po(e[0][0],e[0][1]):function(n){return n===t||Ei(n,t,e)}}function Ra(t,e){return Zi(t)&&ho(e)?po(we(t),e):function(n){var s=is(n,t);return s===r&&s===e?ss(n,t):kn(e,s,N|I)}}function vr(t,e,n,s,a){t!==e&&xi(e,function(c,h){if(a||(a=new he),dt(c))af(t,e,h,n,vr,s,a);else{var g=s?s(ji(t,h),c,h+"",t,e,a):r;g===r&&(g=c),Ci(t,h,g)}},zt)}function af(t,e,n,s,a,c,h){var g=ji(t,n),y=ji(e,n),x=h.get(y);if(x){Ci(t,n,x);return}var A=c?c(g,y,n+"",t,e,h):r,P=A===r;if(P){var F=H(y),k=!F&&qe(y),B=!F&&!k&&mn(y);A=y,F||k||B?H(g)?A=g:vt(g)?A=Ut(g):k?(P=!1,A=Ka(y,!0)):B?(P=!1,A=Ja(y,!0)):A=[]:Un(y)||en(y)?(A=g,en(g)?A=Go(g):(!dt(g)||Oe(g))&&(A=fo(y))):P=!1}P&&(h.set(y,A),a(A,y,s,c,h),h.delete(y)),Ci(t,n,A)}function ka(t,e){var n=t.length;if(n)return e+=e<0?n:0,Ie(e,n)?t[e]:r}function Da(t,e,n){e.length?e=pt(e,function(c){return H(c)?function(h){return Qe(h,c.length===1?c[0]:c)}:c}):e=[qt];var s=-1;e=pt(e,Zt(W()));var a=Fa(t,function(c,h,g){var y=pt(e,function(x){return x(c)});return{criteria:y,index:++s,value:c}});return Fc(a,function(c,h){return yf(c,h,n)})}function of(t,e){return Na(t,e,function(n,s){return ss(t,s)})}function Na(t,e,n){for(var s=-1,a=e.length,c={};++s<a;){var h=e[s],g=Qe(t,h);n(g,h)&&Dn(c,$e(h,t),g)}return c}function uf(t){return function(e){return Qe(e,t)}}function Fi(t,e,n,s){var a=s?Oc:on,c=-1,h=e.length,g=t;for(t===e&&(e=Ut(e)),n&&(g=pt(t,Zt(n)));++c<h;)for(var y=0,x=e[c],A=n?n(x):x;(y=a(g,A,y,s))>-1;)g!==t&&or.call(g,y,1),or.call(t,y,1);return t}function Wa(t,e){for(var n=t?e.length:0,s=n-1;n--;){var a=e[n];if(n==s||a!==c){var c=a;Ie(a)?or.call(t,a,1):Di(t,a)}}return t}function Li(t,e){return t+lr(ma()*(e-t+1))}function cf(t,e,n,s){for(var a=-1,c=Ct(cr((e-t)/(n||1)),0),h=M(c);c--;)h[s?c:++a]=t,t+=n;return h}function Ri(t,e){var n="";if(!t||e<1||e>ge)return n;do e%2&&(n+=t),e=lr(e/2),e&&(t+=t);while(e);return n}function Z(t,e){return Xi(go(t,e,qt),t+"")}function lf(t){return ba(yn(t))}function ff(t,e){var n=yn(t);return Pr(n,Xe(e,0,n.length))}function Dn(t,e,n,s){if(!dt(t))return t;e=$e(e,t);for(var a=-1,c=e.length,h=c-1,g=t;g!=null&&++a<c;){var y=we(e[a]),x=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return t;if(a!=h){var A=g[y];x=s?s(A,y,g):r,x===r&&(x=dt(A)?A:Ie(e[a+1])?[]:{})}Fn(g,y,x),g=g[y]}return t}var Ba=fr?function(t,e){return fr.set(t,e),t}:qt,hf=ur?function(t,e){return ur(t,"toString",{configurable:!0,enumerable:!1,value:os(e),writable:!0})}:qt;function pf(t){return Pr(yn(t))}function oe(t,e,n){var s=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var c=M(a);++s<a;)c[s]=t[s+e];return c}function df(t,e){var n;return Be(t,function(s,a,c){return n=e(s,a,c),!n}),!!n}function mr(t,e,n){var s=0,a=t==null?s:t.length;if(typeof e=="number"&&e===e&&a<=q){for(;s<a;){var c=s+a>>>1,h=t[c];h!==null&&!jt(h)&&(n?h<=e:h<e)?s=c+1:a=c}return a}return ki(t,e,qt,n)}function ki(t,e,n,s){var a=0,c=t==null?0:t.length;if(c===0)return 0;e=n(e);for(var h=e!==e,g=e===null,y=jt(e),x=e===r;a<c;){var A=lr((a+c)/2),P=n(t[A]),F=P!==r,k=P===null,B=P===P,J=jt(P);if(h)var U=s||B;else x?U=B&&(s||F):g?U=B&&F&&(s||!k):y?U=B&&F&&!k&&(s||!J):k||J?U=!1:U=s?P<=e:P<e;U?a=A+1:c=A}return It(c,z)}function Ua(t,e){for(var n=-1,s=t.length,a=0,c=[];++n<s;){var h=t[n],g=e?e(h):h;if(!n||!pe(g,y)){var y=g;c[a++]=h===0?0:h}}return c}function $a(t){return typeof t=="number"?t:jt(t)?Se:+t}function Yt(t){if(typeof t=="string")return t;if(H(t))return pt(t,Yt)+"";if(jt(t))return ya?ya.call(t):"";var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function Ue(t,e,n){var s=-1,a=Xn,c=t.length,h=!0,g=[],y=g;if(n)h=!1,a=li;else if(c>=l){var x=e?null:xf(t);if(x)return Vn(x);h=!1,a=An,y=new je}else y=e?[]:g;t:for(;++s<c;){var A=t[s],P=e?e(A):A;if(A=n||A!==0?A:0,h&&P===P){for(var F=y.length;F--;)if(y[F]===P)continue t;e&&y.push(P),g.push(A)}else a(y,P,n)||(y!==g&&y.push(P),g.push(A))}return g}function Di(t,e){return e=$e(e,t),t=_o(t,e),t==null||delete t[we(ue(e))]}function za(t,e,n,s){return Dn(t,e,n(Qe(t,e)),s)}function yr(t,e,n,s){for(var a=t.length,c=s?a:-1;(s?c--:++c<a)&&e(t[c],c,t););return n?oe(t,s?0:c,s?c+1:a):oe(t,s?c+1:0,s?a:c)}function qa(t,e){var n=t;return n instanceof Q&&(n=n.value()),fi(e,function(s,a){return a.func.apply(a.thisArg,De([s],a.args))},n)}function Ni(t,e,n){var s=t.length;if(s<2)return s?Ue(t[0]):[];for(var a=-1,c=M(s);++a<s;)for(var h=t[a],g=-1;++g<s;)g!=a&&(c[a]=Ln(c[a]||h,t[g],e,n));return Ue(Et(c,1),e,n)}function Ga(t,e,n){for(var s=-1,a=t.length,c=e.length,h={};++s<a;){var g=s<c?e[s]:r;n(h,t[s],g)}return h}function Wi(t){return vt(t)?t:[]}function Bi(t){return typeof t=="function"?t:qt}function $e(t,e){return H(t)?t:Zi(t,e)?[t]:wo(rt(t))}var gf=Z;function ze(t,e,n){var s=t.length;return n=n===r?s:n,!e&&n>=s?t:oe(t,e,n)}var Ha=el||function(t){return Tt.clearTimeout(t)};function Ka(t,e){if(e)return t.slice();var n=t.length,s=pa?pa(n):new t.constructor(n);return t.copy(s),s}function Ui(t){var e=new t.constructor(t.byteLength);return new sr(e).set(new sr(t)),e}function _f(t,e){var n=e?Ui(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function vf(t){var e=new t.constructor(t.source,Es.exec(t));return e.lastIndex=t.lastIndex,e}function mf(t){return On?st(On.call(t)):{}}function Ja(t,e){var n=e?Ui(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Za(t,e){if(t!==e){var n=t!==r,s=t===null,a=t===t,c=jt(t),h=e!==r,g=e===null,y=e===e,x=jt(e);if(!g&&!x&&!c&&t>e||c&&h&&y&&!g&&!x||s&&h&&y||!n&&y||!a)return 1;if(!s&&!c&&!x&&t<e||x&&n&&a&&!s&&!c||g&&n&&a||!h&&a||!y)return-1}return 0}function yf(t,e,n){for(var s=-1,a=t.criteria,c=e.criteria,h=a.length,g=n.length;++s<h;){var y=Za(a[s],c[s]);if(y){if(s>=g)return y;var x=n[s];return y*(x=="desc"?-1:1)}}return t.index-e.index}function Ya(t,e,n,s){for(var a=-1,c=t.length,h=n.length,g=-1,y=e.length,x=Ct(c-h,0),A=M(y+x),P=!s;++g<y;)A[g]=e[g];for(;++a<h;)(P||a<c)&&(A[n[a]]=t[a]);for(;x--;)A[g++]=t[a++];return A}function ja(t,e,n,s){for(var a=-1,c=t.length,h=-1,g=n.length,y=-1,x=e.length,A=Ct(c-g,0),P=M(A+x),F=!s;++a<A;)P[a]=t[a];for(var k=a;++y<x;)P[k+y]=e[y];for(;++h<g;)(F||a<c)&&(P[k+n[h]]=t[a++]);return P}function Ut(t,e){var n=-1,s=t.length;for(e||(e=M(s));++n<s;)e[n]=t[n];return e}function ye(t,e,n,s){var a=!n;n||(n={});for(var c=-1,h=e.length;++c<h;){var g=e[c],y=s?s(n[g],t[g],g,n,t):r;y===r&&(y=t[g]),a?Pe(n,g,y):Fn(n,g,y)}return n}function wf(t,e){return ye(t,Ji(t),e)}function bf(t,e){return ye(t,co(t),e)}function wr(t,e){return function(n,s){var a=H(n)?xc:zl,c=e?e():{};return a(n,t,W(s,2),c)}}function gn(t){return Z(function(e,n){var s=-1,a=n.length,c=a>1?n[a-1]:r,h=a>2?n[2]:r;for(c=t.length>3&&typeof c=="function"?(a--,c):r,h&&kt(n[0],n[1],h)&&(c=a<3?r:c,a=1),e=st(e);++s<a;){var g=n[s];g&&t(e,g,s,c)}return e})}function Xa(t,e){return function(n,s){if(n==null)return n;if(!$t(n))return t(n,s);for(var a=n.length,c=e?a:-1,h=st(n);(e?c--:++c<a)&&s(h[c],c,h)!==!1;);return n}}function Qa(t){return function(e,n,s){for(var a=-1,c=st(e),h=s(e),g=h.length;g--;){var y=h[t?g:++a];if(n(c[y],y,c)===!1)break}return e}}function Mf(t,e,n){var s=e&O,a=Nn(t);function c(){var h=this&&this!==Tt&&this instanceof c?a:t;return h.apply(s?n:this,arguments)}return c}function Va(t){return function(e){e=rt(e);var n=un(e)?fe(e):r,s=n?n[0]:e.charAt(0),a=n?ze(n,1).join(""):e.slice(1);return s[t]()+a}}function _n(t){return function(e){return fi(Qo(Xo(e).replace(fc,"")),t,"")}}function Nn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=dn(t.prototype),s=t.apply(n,e);return dt(s)?s:n}}function Cf(t,e,n){var s=Nn(t);function a(){for(var c=arguments.length,h=M(c),g=c,y=vn(a);g--;)h[g]=arguments[g];var x=c<3&&h[0]!==y&&h[c-1]!==y?[]:Ne(h,y);if(c-=x.length,c<n)return io(t,e,br,a.placeholder,r,h,x,r,r,n-c);var A=this&&this!==Tt&&this instanceof a?s:t;return Jt(A,this,h)}return a}function to(t){return function(e,n,s){var a=st(e);if(!$t(e)){var c=W(n,3);e=xt(e),n=function(g){return c(a[g],g,a)}}var h=t(e,n,s);return h>-1?a[c?e[h]:h]:r}}function eo(t){return Ee(function(e){var n=e.length,s=n,a=se.prototype.thru;for(t&&e.reverse();s--;){var c=e[s];if(typeof c!="function")throw new ie(p);if(a&&!h&&xr(c)=="wrapper")var h=new se([],!0)}for(s=h?s:n;++s<n;){c=e[s];var g=xr(c),y=g=="wrapper"?Hi(c):r;y&&Yi(y[0])&&y[1]==(Pt|X|bt|Gt)&&!y[4].length&&y[9]==1?h=h[xr(y[0])].apply(h,y[3]):h=c.length==1&&Yi(c)?h[g]():h.thru(c)}return function(){var x=arguments,A=x[0];if(h&&x.length==1&&H(A))return h.plant(A).value();for(var P=0,F=n?e[P].apply(this,x):A;++P<n;)F=e[P].call(this,F);return F}})}function br(t,e,n,s,a,c,h,g,y,x){var A=e&Pt,P=e&O,F=e&$,k=e&(X|nt),B=e&te,J=F?r:Nn(t);function U(){for(var Y=arguments.length,V=M(Y),Xt=Y;Xt--;)V[Xt]=arguments[Xt];if(k)var Dt=vn(U),Qt=Rc(V,Dt);if(s&&(V=Ya(V,s,a,k)),c&&(V=ja(V,c,h,k)),Y-=Qt,k&&Y<x){var mt=Ne(V,Dt);return io(t,e,br,U.placeholder,n,V,mt,g,y,x-Y)}var de=P?n:this,Le=F?de[t]:t;return Y=V.length,g?V=qf(V,g):B&&Y>1&&V.reverse(),A&&y<Y&&(V.length=y),this&&this!==Tt&&this instanceof U&&(Le=J||Nn(Le)),Le.apply(de,V)}return U}function no(t,e){return function(n,s){return jl(n,t,e(s),{})}}function Mr(t,e){return function(n,s){var a;if(n===r&&s===r)return e;if(n!==r&&(a=n),s!==r){if(a===r)return s;typeof n=="string"||typeof s=="string"?(n=Yt(n),s=Yt(s)):(n=$a(n),s=$a(s)),a=t(n,s)}return a}}function $i(t){return Ee(function(e){return e=pt(e,Zt(W())),Z(function(n){var s=this;return t(e,function(a){return Jt(a,s,n)})})})}function Cr(t,e){e=e===r?" ":Yt(e);var n=e.length;if(n<2)return n?Ri(e,t):e;var s=Ri(e,cr(t/cn(e)));return un(e)?ze(fe(s),0,t).join(""):s.slice(0,t)}function Sf(t,e,n,s){var a=e&O,c=Nn(t);function h(){for(var g=-1,y=arguments.length,x=-1,A=s.length,P=M(A+y),F=this&&this!==Tt&&this instanceof h?c:t;++x<A;)P[x]=s[x];for(;y--;)P[x++]=arguments[++g];return Jt(F,a?n:this,P)}return h}function ro(t){return function(e,n,s){return s&&typeof s!="number"&&kt(e,n,s)&&(n=s=r),e=Fe(e),n===r?(n=e,e=0):n=Fe(n),s=s===r?e<n?1:-1:Fe(s),cf(e,n,s,t)}}function Sr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=ce(e),n=ce(n)),t(e,n)}}function io(t,e,n,s,a,c,h,g,y,x){var A=e&X,P=A?h:r,F=A?r:h,k=A?c:r,B=A?r:c;e|=A?bt:At,e&=~(A?At:bt),e&j||(e&=~(O|$));var J=[t,e,a,k,P,B,F,g,y,x],U=n.apply(r,J);return Yi(t)&&vo(U,J),U.placeholder=s,mo(U,t,e)}function zi(t){var e=Mt[t];return function(n,s){if(n=ce(n),s=s==null?0:It(K(s),292),s&&va(n)){var a=(rt(n)+"e").split("e"),c=e(a[0]+"e"+(+a[1]+s));return a=(rt(c)+"e").split("e"),+(a[0]+"e"+(+a[1]-s))}return e(n)}}var xf=hn&&1/Vn(new hn([,-0]))[1]==Ce?function(t){return new hn(t)}:ls;function so(t){return function(e){var n=Ot(e);return n==gt?mi(e):n==ht?$c(e):Lc(e,t(e))}}function Te(t,e,n,s,a,c,h,g){var y=e&$;if(!y&&typeof t!="function")throw new ie(p);var x=s?s.length:0;if(x||(e&=~(bt|At),s=a=r),h=h===r?h:Ct(K(h),0),g=g===r?g:K(g),x-=a?a.length:0,e&At){var A=s,P=a;s=a=r}var F=y?r:Hi(t),k=[t,e,n,s,a,A,P,c,h,g];if(F&&Uf(k,F),t=k[0],e=k[1],n=k[2],s=k[3],a=k[4],g=k[9]=k[9]===r?y?0:t.length:Ct(k[9]-x,0),!g&&e&(X|nt)&&(e&=~(X|nt)),!e||e==O)var B=Mf(t,e,n);else e==X||e==nt?B=Cf(t,e,g):(e==bt||e==(O|bt))&&!a.length?B=Sf(t,e,n,s):B=br.apply(r,k);var J=F?Ba:vo;return mo(J(B,k),t,e)}function ao(t,e,n,s){return t===r||pe(t,fn[n])&&!it.call(s,n)?e:t}function oo(t,e,n,s,a,c){return dt(t)&&dt(e)&&(c.set(e,t),vr(t,e,r,oo,c),c.delete(e)),t}function Af(t){return Un(t)?r:t}function uo(t,e,n,s,a,c){var h=n&N,g=t.length,y=e.length;if(g!=y&&!(h&&y>g))return!1;var x=c.get(t),A=c.get(e);if(x&&A)return x==e&&A==t;var P=-1,F=!0,k=n&I?new je:r;for(c.set(t,e),c.set(e,t);++P<g;){var B=t[P],J=e[P];if(s)var U=h?s(J,B,P,e,t,c):s(B,J,P,t,e,c);if(U!==r){if(U)continue;F=!1;break}if(k){if(!hi(e,function(Y,V){if(!An(k,V)&&(B===Y||a(B,Y,n,s,c)))return k.push(V)})){F=!1;break}}else if(!(B===J||a(B,J,n,s,c))){F=!1;break}}return c.delete(t),c.delete(e),F}function Pf(t,e,n,s,a,c,h){switch(n){case sn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case xn:return!(t.byteLength!=e.byteLength||!c(new sr(t),new sr(e)));case ut:case yt:case Lt:return pe(+t,+e);case Ft:return t.name==e.name&&t.message==e.message;case ee:case ve:return t==e+"";case gt:var g=mi;case ht:var y=s&N;if(g||(g=Vn),t.size!=e.size&&!y)return!1;var x=h.get(t);if(x)return x==e;s|=I,h.set(t,e);var A=uo(g(t),g(e),s,a,c,h);return h.delete(t),A;case Jn:if(On)return On.call(t)==On.call(e)}return!1}function Tf(t,e,n,s,a,c){var h=n&N,g=qi(t),y=g.length,x=qi(e),A=x.length;if(y!=A&&!h)return!1;for(var P=y;P--;){var F=g[P];if(!(h?F in e:it.call(e,F)))return!1}var k=c.get(t),B=c.get(e);if(k&&B)return k==e&&B==t;var J=!0;c.set(t,e),c.set(e,t);for(var U=h;++P<y;){F=g[P];var Y=t[F],V=e[F];if(s)var Xt=h?s(V,Y,F,e,t,c):s(Y,V,F,t,e,c);if(!(Xt===r?Y===V||a(Y,V,n,s,c):Xt)){J=!1;break}U||(U=F=="constructor")}if(J&&!U){var Dt=t.constructor,Qt=e.constructor;Dt!=Qt&&"constructor"in t&&"constructor"in e&&!(typeof Dt=="function"&&Dt instanceof Dt&&typeof Qt=="function"&&Qt instanceof Qt)&&(J=!1)}return c.delete(t),c.delete(e),J}function Ee(t){return Xi(go(t,r,So),t+"")}function qi(t){return Ta(t,xt,Ji)}function Gi(t){return Ta(t,zt,co)}var Hi=fr?function(t){return fr.get(t)}:ls;function xr(t){for(var e=t.name+"",n=pn[e],s=it.call(pn,e)?n.length:0;s--;){var a=n[s],c=a.func;if(c==null||c==t)return a.name}return e}function vn(t){var e=it.call(u,"placeholder")?u:t;return e.placeholder}function W(){var t=u.iteratee||us;return t=t===us?Oa:t,arguments.length?t(arguments[0],arguments[1]):t}function Ar(t,e){var n=t.__data__;return Df(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ki(t){for(var e=xt(t),n=e.length;n--;){var s=e[n],a=t[s];e[n]=[s,a,ho(a)]}return e}function Ve(t,e){var n=Wc(t,e);return Ia(n)?n:r}function Ef(t){var e=it.call(t,Ze),n=t[Ze];try{t[Ze]=r;var s=!0}catch{}var a=rr.call(t);return s&&(e?t[Ze]=n:delete t[Ze]),a}var Ji=wi?function(t){return t==null?[]:(t=st(t),ke(wi(t),function(e){return ga.call(t,e)}))}:fs,co=wi?function(t){for(var e=[];t;)De(e,Ji(t)),t=ar(t);return e}:fs,Ot=Rt;(bi&&Ot(new bi(new ArrayBuffer(1)))!=sn||Tn&&Ot(new Tn)!=gt||Mi&&Ot(Mi.resolve())!=Bt||hn&&Ot(new hn)!=ht||En&&Ot(new En)!=Sn)&&(Ot=function(t){var e=Rt(t),n=e==wt?t.constructor:r,s=n?tn(n):"";if(s)switch(s){case ll:return sn;case fl:return gt;case hl:return Bt;case pl:return ht;case dl:return Sn}return e});function If(t,e,n){for(var s=-1,a=n.length;++s<a;){var c=n[s],h=c.size;switch(c.type){case"drop":t+=h;break;case"dropRight":e-=h;break;case"take":e=It(e,t+h);break;case"takeRight":t=Ct(t,e-h);break}}return{start:t,end:e}}function Of(t){var e=t.match(Du);return e?e[1].split(Nu):[]}function lo(t,e,n){e=$e(e,t);for(var s=-1,a=e.length,c=!1;++s<a;){var h=we(e[s]);if(!(c=t!=null&&n(t,h)))break;t=t[h]}return c||++s!=a?c:(a=t==null?0:t.length,!!a&&Lr(a)&&Ie(h,a)&&(H(t)||en(t)))}function Ff(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&it.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function fo(t){return typeof t.constructor=="function"&&!Wn(t)?dn(ar(t)):{}}function Lf(t,e,n){var s=t.constructor;switch(e){case xn:return Ui(t);case ut:case yt:return new s(+t);case sn:return _f(t,n);case Kr:case Jr:case Zr:case Yr:case jr:case Xr:case Qr:case Vr:case ti:return Ja(t,n);case gt:return new s;case Lt:case ve:return new s(t);case ee:return vf(t);case ht:return new s;case Jn:return mf(t)}}function Rf(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(ku,`{
/* [wrapped with `+e+`] */
`)}function kf(t){return H(t)||en(t)||!!(_a&&t&&t[_a])}function Ie(t,e){var n=typeof t;return e=e??ge,!!e&&(n=="number"||n!="symbol"&&Ku.test(t))&&t>-1&&t%1==0&&t<e}function kt(t,e,n){if(!dt(n))return!1;var s=typeof e;return(s=="number"?$t(n)&&Ie(e,n.length):s=="string"&&e in n)?pe(n[e],t):!1}function Zi(t,e){if(H(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||jt(t)?!0:Ou.test(t)||!Iu.test(t)||e!=null&&t in st(e)}function Df(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Yi(t){var e=xr(t),n=u[e];if(typeof n!="function"||!(e in Q.prototype))return!1;if(t===n)return!0;var s=Hi(n);return!!s&&t===s[0]}function Nf(t){return!!ha&&ha in t}var Wf=er?Oe:hs;function Wn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||fn;return t===n}function ho(t){return t===t&&!dt(t)}function po(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in st(n))}}function Bf(t){var e=Or(t,function(s){return n.size===b&&n.clear(),s}),n=e.cache;return e}function Uf(t,e){var n=t[1],s=e[1],a=n|s,c=a<(O|$|Pt),h=s==Pt&&n==X||s==Pt&&n==Gt&&t[7].length<=e[8]||s==(Pt|Gt)&&e[7].length<=e[8]&&n==X;if(!(c||h))return t;s&O&&(t[2]=e[2],a|=n&O?0:j);var g=e[3];if(g){var y=t[3];t[3]=y?Ya(y,g,e[4]):g,t[4]=y?Ne(t[3],C):e[4]}return g=e[5],g&&(y=t[5],t[5]=y?ja(y,g,e[6]):g,t[6]=y?Ne(t[5],C):e[6]),g=e[7],g&&(t[7]=g),s&Pt&&(t[8]=t[8]==null?e[8]:It(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function $f(t){var e=[];if(t!=null)for(var n in st(t))e.push(n);return e}function zf(t){return rr.call(t)}function go(t,e,n){return e=Ct(e===r?t.length-1:e,0),function(){for(var s=arguments,a=-1,c=Ct(s.length-e,0),h=M(c);++a<c;)h[a]=s[e+a];a=-1;for(var g=M(e+1);++a<e;)g[a]=s[a];return g[e]=n(h),Jt(t,this,g)}}function _o(t,e){return e.length<2?t:Qe(t,oe(e,0,-1))}function qf(t,e){for(var n=t.length,s=It(e.length,n),a=Ut(t);s--;){var c=e[s];t[s]=Ie(c,n)?a[c]:r}return t}function ji(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var vo=yo(Ba),Bn=rl||function(t,e){return Tt.setTimeout(t,e)},Xi=yo(hf);function mo(t,e,n){var s=e+"";return Xi(t,Rf(s,Gf(Of(s),n)))}function yo(t){var e=0,n=0;return function(){var s=ol(),a=Gr-(s-n);if(n=s,a>0){if(++e>=Gn)return arguments[0]}else e=0;return t.apply(r,arguments)}}function Pr(t,e){var n=-1,s=t.length,a=s-1;for(e=e===r?s:e;++n<e;){var c=Li(n,a),h=t[c];t[c]=t[n],t[n]=h}return t.length=e,t}var wo=Bf(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Fu,function(n,s,a,c){e.push(a?c.replace(Uu,"$1"):s||n)}),e});function we(t){if(typeof t=="string"||jt(t))return t;var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function tn(t){if(t!=null){try{return nr.call(t)}catch{}try{return t+""}catch{}}return""}function Gf(t,e){return re(lt,function(n){var s="_."+n[0];e&n[1]&&!Xn(t,s)&&t.push(s)}),t.sort()}function bo(t){if(t instanceof Q)return t.clone();var e=new se(t.__wrapped__,t.__chain__);return e.__actions__=Ut(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Hf(t,e,n){(n?kt(t,e,n):e===r)?e=1:e=Ct(K(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var a=0,c=0,h=M(cr(s/e));a<s;)h[c++]=oe(t,a,a+=e);return h}function Kf(t){for(var e=-1,n=t==null?0:t.length,s=0,a=[];++e<n;){var c=t[e];c&&(a[s++]=c)}return a}function Jf(){var t=arguments.length;if(!t)return[];for(var e=M(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return De(H(n)?Ut(n):[n],Et(e,1))}var Zf=Z(function(t,e){return vt(t)?Ln(t,Et(e,1,vt,!0)):[]}),Yf=Z(function(t,e){var n=ue(e);return vt(n)&&(n=r),vt(t)?Ln(t,Et(e,1,vt,!0),W(n,2)):[]}),jf=Z(function(t,e){var n=ue(e);return vt(n)&&(n=r),vt(t)?Ln(t,Et(e,1,vt,!0),r,n):[]});function Xf(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:K(e),oe(t,e<0?0:e,s)):[]}function Qf(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:K(e),e=s-e,oe(t,0,e<0?0:e)):[]}function Vf(t,e){return t&&t.length?yr(t,W(e,3),!0,!0):[]}function th(t,e){return t&&t.length?yr(t,W(e,3),!0):[]}function eh(t,e,n,s){var a=t==null?0:t.length;return a?(n&&typeof n!="number"&&kt(t,e,n)&&(n=0,s=a),Kl(t,e,n,s)):[]}function Mo(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:K(n);return a<0&&(a=Ct(s+a,0)),Qn(t,W(e,3),a)}function Co(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s-1;return n!==r&&(a=K(n),a=n<0?Ct(s+a,0):It(a,s-1)),Qn(t,W(e,3),a,!0)}function So(t){var e=t==null?0:t.length;return e?Et(t,1):[]}function nh(t){var e=t==null?0:t.length;return e?Et(t,Ce):[]}function rh(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:K(e),Et(t,e)):[]}function ih(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var a=t[e];s[a[0]]=a[1]}return s}function xo(t){return t&&t.length?t[0]:r}function sh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:K(n);return a<0&&(a=Ct(s+a,0)),on(t,e,a)}function ah(t){var e=t==null?0:t.length;return e?oe(t,0,-1):[]}var oh=Z(function(t){var e=pt(t,Wi);return e.length&&e[0]===t[0]?Ti(e):[]}),uh=Z(function(t){var e=ue(t),n=pt(t,Wi);return e===ue(n)?e=r:n.pop(),n.length&&n[0]===t[0]?Ti(n,W(e,2)):[]}),ch=Z(function(t){var e=ue(t),n=pt(t,Wi);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?Ti(n,r,e):[]});function lh(t,e){return t==null?"":sl.call(t,e)}function ue(t){var e=t==null?0:t.length;return e?t[e-1]:r}function fh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s;return n!==r&&(a=K(n),a=a<0?Ct(s+a,0):It(a,s-1)),e===e?qc(t,e,a):Qn(t,ia,a,!0)}function hh(t,e){return t&&t.length?ka(t,K(e)):r}var ph=Z(Ao);function Ao(t,e){return t&&t.length&&e&&e.length?Fi(t,e):t}function dh(t,e,n){return t&&t.length&&e&&e.length?Fi(t,e,W(n,2)):t}function gh(t,e,n){return t&&t.length&&e&&e.length?Fi(t,e,r,n):t}var _h=Ee(function(t,e){var n=t==null?0:t.length,s=Si(t,e);return Wa(t,pt(e,function(a){return Ie(a,n)?+a:a}).sort(Za)),s});function vh(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,a=[],c=t.length;for(e=W(e,3);++s<c;){var h=t[s];e(h,s,t)&&(n.push(h),a.push(s))}return Wa(t,a),n}function Qi(t){return t==null?t:cl.call(t)}function mh(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&kt(t,e,n)?(e=0,n=s):(e=e==null?0:K(e),n=n===r?s:K(n)),oe(t,e,n)):[]}function yh(t,e){return mr(t,e)}function wh(t,e,n){return ki(t,e,W(n,2))}function bh(t,e){var n=t==null?0:t.length;if(n){var s=mr(t,e);if(s<n&&pe(t[s],e))return s}return-1}function Mh(t,e){return mr(t,e,!0)}function Ch(t,e,n){return ki(t,e,W(n,2),!0)}function Sh(t,e){var n=t==null?0:t.length;if(n){var s=mr(t,e,!0)-1;if(pe(t[s],e))return s}return-1}function xh(t){return t&&t.length?Ua(t):[]}function Ah(t,e){return t&&t.length?Ua(t,W(e,2)):[]}function Ph(t){var e=t==null?0:t.length;return e?oe(t,1,e):[]}function Th(t,e,n){return t&&t.length?(e=n||e===r?1:K(e),oe(t,0,e<0?0:e)):[]}function Eh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:K(e),e=s-e,oe(t,e<0?0:e,s)):[]}function Ih(t,e){return t&&t.length?yr(t,W(e,3),!1,!0):[]}function Oh(t,e){return t&&t.length?yr(t,W(e,3)):[]}var Fh=Z(function(t){return Ue(Et(t,1,vt,!0))}),Lh=Z(function(t){var e=ue(t);return vt(e)&&(e=r),Ue(Et(t,1,vt,!0),W(e,2))}),Rh=Z(function(t){var e=ue(t);return e=typeof e=="function"?e:r,Ue(Et(t,1,vt,!0),r,e)});function kh(t){return t&&t.length?Ue(t):[]}function Dh(t,e){return t&&t.length?Ue(t,W(e,2)):[]}function Nh(t,e){return e=typeof e=="function"?e:r,t&&t.length?Ue(t,r,e):[]}function Vi(t){if(!(t&&t.length))return[];var e=0;return t=ke(t,function(n){if(vt(n))return e=Ct(n.length,e),!0}),_i(e,function(n){return pt(t,pi(n))})}function Po(t,e){if(!(t&&t.length))return[];var n=Vi(t);return e==null?n:pt(n,function(s){return Jt(e,r,s)})}var Wh=Z(function(t,e){return vt(t)?Ln(t,e):[]}),Bh=Z(function(t){return Ni(ke(t,vt))}),Uh=Z(function(t){var e=ue(t);return vt(e)&&(e=r),Ni(ke(t,vt),W(e,2))}),$h=Z(function(t){var e=ue(t);return e=typeof e=="function"?e:r,Ni(ke(t,vt),r,e)}),zh=Z(Vi);function qh(t,e){return Ga(t||[],e||[],Fn)}function Gh(t,e){return Ga(t||[],e||[],Dn)}var Hh=Z(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,Po(t,n)});function To(t){var e=u(t);return e.__chain__=!0,e}function Kh(t,e){return e(t),t}function Tr(t,e){return e(t)}var Jh=Ee(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,a=function(c){return Si(c,t)};return e>1||this.__actions__.length||!(s instanceof Q)||!Ie(n)?this.thru(a):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:Tr,args:[a],thisArg:r}),new se(s,this.__chain__).thru(function(c){return e&&!c.length&&c.push(r),c}))});function Zh(){return To(this)}function Yh(){return new se(this.value(),this.__chain__)}function jh(){this.__values__===r&&(this.__values__=zo(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function Xh(){return this}function Qh(t){for(var e,n=this;n instanceof pr;){var s=bo(n);s.__index__=0,s.__values__=r,e?a.__wrapped__=s:e=s;var a=s;n=n.__wrapped__}return a.__wrapped__=t,e}function Vh(){var t=this.__wrapped__;if(t instanceof Q){var e=t;return this.__actions__.length&&(e=new Q(this)),e=e.reverse(),e.__actions__.push({func:Tr,args:[Qi],thisArg:r}),new se(e,this.__chain__)}return this.thru(Qi)}function tp(){return qa(this.__wrapped__,this.__actions__)}var ep=wr(function(t,e,n){it.call(t,n)?++t[n]:Pe(t,n,1)});function np(t,e,n){var s=H(t)?na:Hl;return n&&kt(t,e,n)&&(e=r),s(t,W(e,3))}function rp(t,e){var n=H(t)?ke:Aa;return n(t,W(e,3))}var ip=to(Mo),sp=to(Co);function ap(t,e){return Et(Er(t,e),1)}function op(t,e){return Et(Er(t,e),Ce)}function up(t,e,n){return n=n===r?1:K(n),Et(Er(t,e),n)}function Eo(t,e){var n=H(t)?re:Be;return n(t,W(e,3))}function Io(t,e){var n=H(t)?Ac:xa;return n(t,W(e,3))}var cp=wr(function(t,e,n){it.call(t,n)?t[n].push(e):Pe(t,n,[e])});function lp(t,e,n,s){t=$t(t)?t:yn(t),n=n&&!s?K(n):0;var a=t.length;return n<0&&(n=Ct(a+n,0)),Rr(t)?n<=a&&t.indexOf(e,n)>-1:!!a&&on(t,e,n)>-1}var fp=Z(function(t,e,n){var s=-1,a=typeof e=="function",c=$t(t)?M(t.length):[];return Be(t,function(h){c[++s]=a?Jt(e,h,n):Rn(h,e,n)}),c}),hp=wr(function(t,e,n){Pe(t,n,e)});function Er(t,e){var n=H(t)?pt:Fa;return n(t,W(e,3))}function pp(t,e,n,s){return t==null?[]:(H(e)||(e=e==null?[]:[e]),n=s?r:n,H(n)||(n=n==null?[]:[n]),Da(t,e,n))}var dp=wr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function gp(t,e,n){var s=H(t)?fi:aa,a=arguments.length<3;return s(t,W(e,4),n,a,Be)}function _p(t,e,n){var s=H(t)?Pc:aa,a=arguments.length<3;return s(t,W(e,4),n,a,xa)}function vp(t,e){var n=H(t)?ke:Aa;return n(t,Fr(W(e,3)))}function mp(t){var e=H(t)?ba:lf;return e(t)}function yp(t,e,n){(n?kt(t,e,n):e===r)?e=1:e=K(e);var s=H(t)?Ul:ff;return s(t,e)}function wp(t){var e=H(t)?$l:pf;return e(t)}function bp(t){if(t==null)return 0;if($t(t))return Rr(t)?cn(t):t.length;var e=Ot(t);return e==gt||e==ht?t.size:Ii(t).length}function Mp(t,e,n){var s=H(t)?hi:df;return n&&kt(t,e,n)&&(e=r),s(t,W(e,3))}var Cp=Z(function(t,e){if(t==null)return[];var n=e.length;return n>1&&kt(t,e[0],e[1])?e=[]:n>2&&kt(e[0],e[1],e[2])&&(e=[e[0]]),Da(t,Et(e,1),[])}),Ir=nl||function(){return Tt.Date.now()};function Sp(t,e){if(typeof e!="function")throw new ie(p);return t=K(t),function(){if(--t<1)return e.apply(this,arguments)}}function Oo(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,Te(t,Pt,r,r,r,r,e)}function Fo(t,e){var n;if(typeof e!="function")throw new ie(p);return t=K(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var ts=Z(function(t,e,n){var s=O;if(n.length){var a=Ne(n,vn(ts));s|=bt}return Te(t,s,e,n,a)}),Lo=Z(function(t,e,n){var s=O|$;if(n.length){var a=Ne(n,vn(Lo));s|=bt}return Te(e,s,t,n,a)});function Ro(t,e,n){e=n?r:e;var s=Te(t,X,r,r,r,r,r,e);return s.placeholder=Ro.placeholder,s}function ko(t,e,n){e=n?r:e;var s=Te(t,nt,r,r,r,r,r,e);return s.placeholder=ko.placeholder,s}function Do(t,e,n){var s,a,c,h,g,y,x=0,A=!1,P=!1,F=!0;if(typeof t!="function")throw new ie(p);e=ce(e)||0,dt(n)&&(A=!!n.leading,P="maxWait"in n,c=P?Ct(ce(n.maxWait)||0,e):c,F="trailing"in n?!!n.trailing:F);function k(mt){var de=s,Le=a;return s=a=r,x=mt,h=t.apply(Le,de),h}function B(mt){return x=mt,g=Bn(Y,e),A?k(mt):h}function J(mt){var de=mt-y,Le=mt-x,eu=e-de;return P?It(eu,c-Le):eu}function U(mt){var de=mt-y,Le=mt-x;return y===r||de>=e||de<0||P&&Le>=c}function Y(){var mt=Ir();if(U(mt))return V(mt);g=Bn(Y,J(mt))}function V(mt){return g=r,F&&s?k(mt):(s=a=r,h)}function Xt(){g!==r&&Ha(g),x=0,s=y=a=g=r}function Dt(){return g===r?h:V(Ir())}function Qt(){var mt=Ir(),de=U(mt);if(s=arguments,a=this,y=mt,de){if(g===r)return B(y);if(P)return Ha(g),g=Bn(Y,e),k(y)}return g===r&&(g=Bn(Y,e)),h}return Qt.cancel=Xt,Qt.flush=Dt,Qt}var xp=Z(function(t,e){return Sa(t,1,e)}),Ap=Z(function(t,e,n){return Sa(t,ce(e)||0,n)});function Pp(t){return Te(t,te)}function Or(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new ie(p);var n=function(){var s=arguments,a=e?e.apply(this,s):s[0],c=n.cache;if(c.has(a))return c.get(a);var h=t.apply(this,s);return n.cache=c.set(a,h)||c,h};return n.cache=new(Or.Cache||Ae),n}Or.Cache=Ae;function Fr(t){if(typeof t!="function")throw new ie(p);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Tp(t){return Fo(2,t)}var Ep=gf(function(t,e){e=e.length==1&&H(e[0])?pt(e[0],Zt(W())):pt(Et(e,1),Zt(W()));var n=e.length;return Z(function(s){for(var a=-1,c=It(s.length,n);++a<c;)s[a]=e[a].call(this,s[a]);return Jt(t,this,s)})}),es=Z(function(t,e){var n=Ne(e,vn(es));return Te(t,bt,r,e,n)}),No=Z(function(t,e){var n=Ne(e,vn(No));return Te(t,At,r,e,n)}),Ip=Ee(function(t,e){return Te(t,Gt,r,r,r,e)});function Op(t,e){if(typeof t!="function")throw new ie(p);return e=e===r?e:K(e),Z(t,e)}function Fp(t,e){if(typeof t!="function")throw new ie(p);return e=e==null?0:Ct(K(e),0),Z(function(n){var s=n[e],a=ze(n,0,e);return s&&De(a,s),Jt(t,this,a)})}function Lp(t,e,n){var s=!0,a=!0;if(typeof t!="function")throw new ie(p);return dt(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),Do(t,e,{leading:s,maxWait:e,trailing:a})}function Rp(t){return Oo(t,1)}function kp(t,e){return es(Bi(e),t)}function Dp(){if(!arguments.length)return[];var t=arguments[0];return H(t)?t:[t]}function Np(t){return ae(t,D)}function Wp(t,e){return e=typeof e=="function"?e:r,ae(t,D,e)}function Bp(t){return ae(t,v|D)}function Up(t,e){return e=typeof e=="function"?e:r,ae(t,v|D,e)}function $p(t,e){return e==null||Ca(t,e,xt(e))}function pe(t,e){return t===e||t!==t&&e!==e}var zp=Sr(Pi),qp=Sr(function(t,e){return t>=e}),en=Ea(function(){return arguments}())?Ea:function(t){return _t(t)&&it.call(t,"callee")&&!ga.call(t,"callee")},H=M.isArray,Gp=js?Zt(js):Xl;function $t(t){return t!=null&&Lr(t.length)&&!Oe(t)}function vt(t){return _t(t)&&$t(t)}function Hp(t){return t===!0||t===!1||_t(t)&&Rt(t)==ut}var qe=il||hs,Kp=Xs?Zt(Xs):Ql;function Jp(t){return _t(t)&&t.nodeType===1&&!Un(t)}function Zp(t){if(t==null)return!0;if($t(t)&&(H(t)||typeof t=="string"||typeof t.splice=="function"||qe(t)||mn(t)||en(t)))return!t.length;var e=Ot(t);if(e==gt||e==ht)return!t.size;if(Wn(t))return!Ii(t).length;for(var n in t)if(it.call(t,n))return!1;return!0}function Yp(t,e){return kn(t,e)}function jp(t,e,n){n=typeof n=="function"?n:r;var s=n?n(t,e):r;return s===r?kn(t,e,r,n):!!s}function ns(t){if(!_t(t))return!1;var e=Rt(t);return e==Ft||e==Kt||typeof t.message=="string"&&typeof t.name=="string"&&!Un(t)}function Xp(t){return typeof t=="number"&&va(t)}function Oe(t){if(!dt(t))return!1;var e=Rt(t);return e==Wt||e==_e||e==at||e==le}function Wo(t){return typeof t=="number"&&t==K(t)}function Lr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ge}function dt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function _t(t){return t!=null&&typeof t=="object"}var Bo=Qs?Zt(Qs):tf;function Qp(t,e){return t===e||Ei(t,e,Ki(e))}function Vp(t,e,n){return n=typeof n=="function"?n:r,Ei(t,e,Ki(e),n)}function td(t){return Uo(t)&&t!=+t}function ed(t){if(Wf(t))throw new G(d);return Ia(t)}function nd(t){return t===null}function rd(t){return t==null}function Uo(t){return typeof t=="number"||_t(t)&&Rt(t)==Lt}function Un(t){if(!_t(t)||Rt(t)!=wt)return!1;var e=ar(t);if(e===null)return!0;var n=it.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&nr.call(n)==Qc}var rs=Vs?Zt(Vs):ef;function id(t){return Wo(t)&&t>=-ge&&t<=ge}var $o=ta?Zt(ta):nf;function Rr(t){return typeof t=="string"||!H(t)&&_t(t)&&Rt(t)==ve}function jt(t){return typeof t=="symbol"||_t(t)&&Rt(t)==Jn}var mn=ea?Zt(ea):rf;function sd(t){return t===r}function ad(t){return _t(t)&&Ot(t)==Sn}function od(t){return _t(t)&&Rt(t)==Mu}var ud=Sr(Oi),cd=Sr(function(t,e){return t<=e});function zo(t){if(!t)return[];if($t(t))return Rr(t)?fe(t):Ut(t);if(Pn&&t[Pn])return Uc(t[Pn]());var e=Ot(t),n=e==gt?mi:e==ht?Vn:yn;return n(t)}function Fe(t){if(!t)return t===0?t:0;if(t=ce(t),t===Ce||t===-Ce){var e=t<0?-1:1;return e*Kn}return t===t?t:0}function K(t){var e=Fe(t),n=e%1;return e===e?n?e-n:e:0}function qo(t){return t?Xe(K(t),0,L):0}function ce(t){if(typeof t=="number")return t;if(jt(t))return Se;if(dt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=dt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=oa(t);var n=qu.test(t);return n||Hu.test(t)?Cc(t.slice(2),n?2:8):zu.test(t)?Se:+t}function Go(t){return ye(t,zt(t))}function ld(t){return t?Xe(K(t),-ge,ge):t===0?t:0}function rt(t){return t==null?"":Yt(t)}var fd=gn(function(t,e){if(Wn(e)||$t(e)){ye(e,xt(e),t);return}for(var n in e)it.call(e,n)&&Fn(t,n,e[n])}),Ho=gn(function(t,e){ye(e,zt(e),t)}),kr=gn(function(t,e,n,s){ye(e,zt(e),t,s)}),hd=gn(function(t,e,n,s){ye(e,xt(e),t,s)}),pd=Ee(Si);function dd(t,e){var n=dn(t);return e==null?n:Ma(n,e)}var gd=Z(function(t,e){t=st(t);var n=-1,s=e.length,a=s>2?e[2]:r;for(a&&kt(e[0],e[1],a)&&(s=1);++n<s;)for(var c=e[n],h=zt(c),g=-1,y=h.length;++g<y;){var x=h[g],A=t[x];(A===r||pe(A,fn[x])&&!it.call(t,x))&&(t[x]=c[x])}return t}),_d=Z(function(t){return t.push(r,oo),Jt(Ko,r,t)});function vd(t,e){return ra(t,W(e,3),me)}function md(t,e){return ra(t,W(e,3),Ai)}function yd(t,e){return t==null?t:xi(t,W(e,3),zt)}function wd(t,e){return t==null?t:Pa(t,W(e,3),zt)}function bd(t,e){return t&&me(t,W(e,3))}function Md(t,e){return t&&Ai(t,W(e,3))}function Cd(t){return t==null?[]:_r(t,xt(t))}function Sd(t){return t==null?[]:_r(t,zt(t))}function is(t,e,n){var s=t==null?r:Qe(t,e);return s===r?n:s}function xd(t,e){return t!=null&&lo(t,e,Jl)}function ss(t,e){return t!=null&&lo(t,e,Zl)}var Ad=no(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=rr.call(e)),t[e]=n},os(qt)),Pd=no(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=rr.call(e)),it.call(t,e)?t[e].push(n):t[e]=[n]},W),Td=Z(Rn);function xt(t){return $t(t)?wa(t):Ii(t)}function zt(t){return $t(t)?wa(t,!0):sf(t)}function Ed(t,e){var n={};return e=W(e,3),me(t,function(s,a,c){Pe(n,e(s,a,c),s)}),n}function Id(t,e){var n={};return e=W(e,3),me(t,function(s,a,c){Pe(n,a,e(s,a,c))}),n}var Od=gn(function(t,e,n){vr(t,e,n)}),Ko=gn(function(t,e,n,s){vr(t,e,n,s)}),Fd=Ee(function(t,e){var n={};if(t==null)return n;var s=!1;e=pt(e,function(c){return c=$e(c,t),s||(s=c.length>1),c}),ye(t,Gi(t),n),s&&(n=ae(n,v|T|D,Af));for(var a=e.length;a--;)Di(n,e[a]);return n});function Ld(t,e){return Jo(t,Fr(W(e)))}var Rd=Ee(function(t,e){return t==null?{}:of(t,e)});function Jo(t,e){if(t==null)return{};var n=pt(Gi(t),function(s){return[s]});return e=W(e),Na(t,n,function(s,a){return e(s,a[0])})}function kd(t,e,n){e=$e(e,t);var s=-1,a=e.length;for(a||(a=1,t=r);++s<a;){var c=t==null?r:t[we(e[s])];c===r&&(s=a,c=n),t=Oe(c)?c.call(t):c}return t}function Dd(t,e,n){return t==null?t:Dn(t,e,n)}function Nd(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:Dn(t,e,n,s)}var Zo=so(xt),Yo=so(zt);function Wd(t,e,n){var s=H(t),a=s||qe(t)||mn(t);if(e=W(e,4),n==null){var c=t&&t.constructor;a?n=s?new c:[]:dt(t)?n=Oe(c)?dn(ar(t)):{}:n={}}return(a?re:me)(t,function(h,g,y){return e(n,h,g,y)}),n}function Bd(t,e){return t==null?!0:Di(t,e)}function Ud(t,e,n){return t==null?t:za(t,e,Bi(n))}function $d(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:za(t,e,Bi(n),s)}function yn(t){return t==null?[]:vi(t,xt(t))}function zd(t){return t==null?[]:vi(t,zt(t))}function qd(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=ce(n),n=n===n?n:0),e!==r&&(e=ce(e),e=e===e?e:0),Xe(ce(t),e,n)}function Gd(t,e,n){return e=Fe(e),n===r?(n=e,e=0):n=Fe(n),t=ce(t),Yl(t,e,n)}function Hd(t,e,n){if(n&&typeof n!="boolean"&&kt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=Fe(t),e===r?(e=t,t=0):e=Fe(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var a=ma();return It(t+a*(e-t+Mc("1e-"+((a+"").length-1))),e)}return Li(t,e)}var Kd=_n(function(t,e,n){return e=e.toLowerCase(),t+(n?jo(e):e)});function jo(t){return as(rt(t).toLowerCase())}function Xo(t){return t=rt(t),t&&t.replace(Ju,kc).replace(hc,"")}function Jd(t,e,n){t=rt(t),e=Yt(e);var s=t.length;n=n===r?s:Xe(K(n),0,s);var a=n;return n-=e.length,n>=0&&t.slice(n,a)==e}function Zd(t){return t=rt(t),t&&Pu.test(t)?t.replace(Ps,Dc):t}function Yd(t){return t=rt(t),t&&Lu.test(t)?t.replace(ei,"\\$&"):t}var jd=_n(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Xd=_n(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Qd=Va("toLowerCase");function Vd(t,e,n){t=rt(t),e=K(e);var s=e?cn(t):0;if(!e||s>=e)return t;var a=(e-s)/2;return Cr(lr(a),n)+t+Cr(cr(a),n)}function tg(t,e,n){t=rt(t),e=K(e);var s=e?cn(t):0;return e&&s<e?t+Cr(e-s,n):t}function eg(t,e,n){t=rt(t),e=K(e);var s=e?cn(t):0;return e&&s<e?Cr(e-s,n)+t:t}function ng(t,e,n){return n||e==null?e=0:e&&(e=+e),ul(rt(t).replace(ni,""),e||0)}function rg(t,e,n){return(n?kt(t,e,n):e===r)?e=1:e=K(e),Ri(rt(t),e)}function ig(){var t=arguments,e=rt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var sg=_n(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function ag(t,e,n){return n&&typeof n!="number"&&kt(t,e,n)&&(e=n=r),n=n===r?L:n>>>0,n?(t=rt(t),t&&(typeof e=="string"||e!=null&&!rs(e))&&(e=Yt(e),!e&&un(t))?ze(fe(t),0,n):t.split(e,n)):[]}var og=_n(function(t,e,n){return t+(n?" ":"")+as(e)});function ug(t,e,n){return t=rt(t),n=n==null?0:Xe(K(n),0,t.length),e=Yt(e),t.slice(n,n+e.length)==e}function cg(t,e,n){var s=u.templateSettings;n&&kt(t,e,n)&&(e=r),t=rt(t),e=kr({},e,s,ao);var a=kr({},e.imports,s.imports,ao),c=xt(a),h=vi(a,c),g,y,x=0,A=e.interpolate||Zn,P="__p += '",F=yi((e.escape||Zn).source+"|"+A.source+"|"+(A===Ts?$u:Zn).source+"|"+(e.evaluate||Zn).source+"|$","g"),k="//# sourceURL="+(it.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++vc+"]")+`
`;t.replace(F,function(U,Y,V,Xt,Dt,Qt){return V||(V=Xt),P+=t.slice(x,Qt).replace(Zu,Nc),Y&&(g=!0,P+=`' +
__e(`+Y+`) +
'`),Dt&&(y=!0,P+=`';
`+Dt+`;
__p += '`),V&&(P+=`' +
((__t = (`+V+`)) == null ? '' : __t) +
'`),x=Qt+U.length,U}),P+=`';
`;var B=it.call(e,"variable")&&e.variable;if(!B)P=`with (obj) {
`+P+`
}
`;else if(Bu.test(B))throw new G(_);P=(y?P.replace(Cu,""):P).replace(Su,"$1").replace(xu,"$1;"),P="function("+(B||"obj")+`) {
`+(B?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+P+`return __p
}`;var J=Vo(function(){return et(c,k+"return "+P).apply(r,h)});if(J.source=P,ns(J))throw J;return J}function lg(t){return rt(t).toLowerCase()}function fg(t){return rt(t).toUpperCase()}function hg(t,e,n){if(t=rt(t),t&&(n||e===r))return oa(t);if(!t||!(e=Yt(e)))return t;var s=fe(t),a=fe(e),c=ua(s,a),h=ca(s,a)+1;return ze(s,c,h).join("")}function pg(t,e,n){if(t=rt(t),t&&(n||e===r))return t.slice(0,fa(t)+1);if(!t||!(e=Yt(e)))return t;var s=fe(t),a=ca(s,fe(e))+1;return ze(s,0,a).join("")}function dg(t,e,n){if(t=rt(t),t&&(n||e===r))return t.replace(ni,"");if(!t||!(e=Yt(e)))return t;var s=fe(t),a=ua(s,fe(e));return ze(s,a).join("")}function gg(t,e){var n=Ht,s=Mn;if(dt(e)){var a="separator"in e?e.separator:a;n="length"in e?K(e.length):n,s="omission"in e?Yt(e.omission):s}t=rt(t);var c=t.length;if(un(t)){var h=fe(t);c=h.length}if(n>=c)return t;var g=n-cn(s);if(g<1)return s;var y=h?ze(h,0,g).join(""):t.slice(0,g);if(a===r)return y+s;if(h&&(g+=y.length-g),rs(a)){if(t.slice(g).search(a)){var x,A=y;for(a.global||(a=yi(a.source,rt(Es.exec(a))+"g")),a.lastIndex=0;x=a.exec(A);)var P=x.index;y=y.slice(0,P===r?g:P)}}else if(t.indexOf(Yt(a),g)!=g){var F=y.lastIndexOf(a);F>-1&&(y=y.slice(0,F))}return y+s}function _g(t){return t=rt(t),t&&Au.test(t)?t.replace(As,Gc):t}var vg=_n(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),as=Va("toUpperCase");function Qo(t,e,n){return t=rt(t),e=n?r:e,e===r?Bc(t)?Jc(t):Ic(t):t.match(e)||[]}var Vo=Z(function(t,e){try{return Jt(t,r,e)}catch(n){return ns(n)?n:new G(n)}}),mg=Ee(function(t,e){return re(e,function(n){n=we(n),Pe(t,n,ts(t[n],t))}),t});function yg(t){var e=t==null?0:t.length,n=W();return t=e?pt(t,function(s){if(typeof s[1]!="function")throw new ie(p);return[n(s[0]),s[1]]}):[],Z(function(s){for(var a=-1;++a<e;){var c=t[a];if(Jt(c[0],this,s))return Jt(c[1],this,s)}})}function wg(t){return Gl(ae(t,v))}function os(t){return function(){return t}}function bg(t,e){return t==null||t!==t?e:t}var Mg=eo(),Cg=eo(!0);function qt(t){return t}function us(t){return Oa(typeof t=="function"?t:ae(t,v))}function Sg(t){return La(ae(t,v))}function xg(t,e){return Ra(t,ae(e,v))}var Ag=Z(function(t,e){return function(n){return Rn(n,t,e)}}),Pg=Z(function(t,e){return function(n){return Rn(t,n,e)}});function cs(t,e,n){var s=xt(e),a=_r(e,s);n==null&&!(dt(e)&&(a.length||!s.length))&&(n=e,e=t,t=this,a=_r(e,xt(e)));var c=!(dt(n)&&"chain"in n)||!!n.chain,h=Oe(t);return re(a,function(g){var y=e[g];t[g]=y,h&&(t.prototype[g]=function(){var x=this.__chain__;if(c||x){var A=t(this.__wrapped__),P=A.__actions__=Ut(this.__actions__);return P.push({func:y,args:arguments,thisArg:t}),A.__chain__=x,A}return y.apply(t,De([this.value()],arguments))})}),t}function Tg(){return Tt._===this&&(Tt._=Vc),this}function ls(){}function Eg(t){return t=K(t),Z(function(e){return ka(e,t)})}var Ig=$i(pt),Og=$i(na),Fg=$i(hi);function tu(t){return Zi(t)?pi(we(t)):uf(t)}function Lg(t){return function(e){return t==null?r:Qe(t,e)}}var Rg=ro(),kg=ro(!0);function fs(){return[]}function hs(){return!1}function Dg(){return{}}function Ng(){return""}function Wg(){return!0}function Bg(t,e){if(t=K(t),t<1||t>ge)return[];var n=L,s=It(t,L);e=W(e),t-=L;for(var a=_i(s,e);++n<t;)e(n);return a}function Ug(t){return H(t)?pt(t,we):jt(t)?[t]:Ut(wo(rt(t)))}function $g(t){var e=++Xc;return rt(t)+e}var zg=Mr(function(t,e){return t+e},0),qg=zi("ceil"),Gg=Mr(function(t,e){return t/e},1),Hg=zi("floor");function Kg(t){return t&&t.length?gr(t,qt,Pi):r}function Jg(t,e){return t&&t.length?gr(t,W(e,2),Pi):r}function Zg(t){return sa(t,qt)}function Yg(t,e){return sa(t,W(e,2))}function jg(t){return t&&t.length?gr(t,qt,Oi):r}function Xg(t,e){return t&&t.length?gr(t,W(e,2),Oi):r}var Qg=Mr(function(t,e){return t*e},1),Vg=zi("round"),t0=Mr(function(t,e){return t-e},0);function e0(t){return t&&t.length?gi(t,qt):0}function n0(t,e){return t&&t.length?gi(t,W(e,2)):0}return u.after=Sp,u.ary=Oo,u.assign=fd,u.assignIn=Ho,u.assignInWith=kr,u.assignWith=hd,u.at=pd,u.before=Fo,u.bind=ts,u.bindAll=mg,u.bindKey=Lo,u.castArray=Dp,u.chain=To,u.chunk=Hf,u.compact=Kf,u.concat=Jf,u.cond=yg,u.conforms=wg,u.constant=os,u.countBy=ep,u.create=dd,u.curry=Ro,u.curryRight=ko,u.debounce=Do,u.defaults=gd,u.defaultsDeep=_d,u.defer=xp,u.delay=Ap,u.difference=Zf,u.differenceBy=Yf,u.differenceWith=jf,u.drop=Xf,u.dropRight=Qf,u.dropRightWhile=Vf,u.dropWhile=th,u.fill=eh,u.filter=rp,u.flatMap=ap,u.flatMapDeep=op,u.flatMapDepth=up,u.flatten=So,u.flattenDeep=nh,u.flattenDepth=rh,u.flip=Pp,u.flow=Mg,u.flowRight=Cg,u.fromPairs=ih,u.functions=Cd,u.functionsIn=Sd,u.groupBy=cp,u.initial=ah,u.intersection=oh,u.intersectionBy=uh,u.intersectionWith=ch,u.invert=Ad,u.invertBy=Pd,u.invokeMap=fp,u.iteratee=us,u.keyBy=hp,u.keys=xt,u.keysIn=zt,u.map=Er,u.mapKeys=Ed,u.mapValues=Id,u.matches=Sg,u.matchesProperty=xg,u.memoize=Or,u.merge=Od,u.mergeWith=Ko,u.method=Ag,u.methodOf=Pg,u.mixin=cs,u.negate=Fr,u.nthArg=Eg,u.omit=Fd,u.omitBy=Ld,u.once=Tp,u.orderBy=pp,u.over=Ig,u.overArgs=Ep,u.overEvery=Og,u.overSome=Fg,u.partial=es,u.partialRight=No,u.partition=dp,u.pick=Rd,u.pickBy=Jo,u.property=tu,u.propertyOf=Lg,u.pull=ph,u.pullAll=Ao,u.pullAllBy=dh,u.pullAllWith=gh,u.pullAt=_h,u.range=Rg,u.rangeRight=kg,u.rearg=Ip,u.reject=vp,u.remove=vh,u.rest=Op,u.reverse=Qi,u.sampleSize=yp,u.set=Dd,u.setWith=Nd,u.shuffle=wp,u.slice=mh,u.sortBy=Cp,u.sortedUniq=xh,u.sortedUniqBy=Ah,u.split=ag,u.spread=Fp,u.tail=Ph,u.take=Th,u.takeRight=Eh,u.takeRightWhile=Ih,u.takeWhile=Oh,u.tap=Kh,u.throttle=Lp,u.thru=Tr,u.toArray=zo,u.toPairs=Zo,u.toPairsIn=Yo,u.toPath=Ug,u.toPlainObject=Go,u.transform=Wd,u.unary=Rp,u.union=Fh,u.unionBy=Lh,u.unionWith=Rh,u.uniq=kh,u.uniqBy=Dh,u.uniqWith=Nh,u.unset=Bd,u.unzip=Vi,u.unzipWith=Po,u.update=Ud,u.updateWith=$d,u.values=yn,u.valuesIn=zd,u.without=Wh,u.words=Qo,u.wrap=kp,u.xor=Bh,u.xorBy=Uh,u.xorWith=$h,u.zip=zh,u.zipObject=qh,u.zipObjectDeep=Gh,u.zipWith=Hh,u.entries=Zo,u.entriesIn=Yo,u.extend=Ho,u.extendWith=kr,cs(u,u),u.add=zg,u.attempt=Vo,u.camelCase=Kd,u.capitalize=jo,u.ceil=qg,u.clamp=qd,u.clone=Np,u.cloneDeep=Bp,u.cloneDeepWith=Up,u.cloneWith=Wp,u.conformsTo=$p,u.deburr=Xo,u.defaultTo=bg,u.divide=Gg,u.endsWith=Jd,u.eq=pe,u.escape=Zd,u.escapeRegExp=Yd,u.every=np,u.find=ip,u.findIndex=Mo,u.findKey=vd,u.findLast=sp,u.findLastIndex=Co,u.findLastKey=md,u.floor=Hg,u.forEach=Eo,u.forEachRight=Io,u.forIn=yd,u.forInRight=wd,u.forOwn=bd,u.forOwnRight=Md,u.get=is,u.gt=zp,u.gte=qp,u.has=xd,u.hasIn=ss,u.head=xo,u.identity=qt,u.includes=lp,u.indexOf=sh,u.inRange=Gd,u.invoke=Td,u.isArguments=en,u.isArray=H,u.isArrayBuffer=Gp,u.isArrayLike=$t,u.isArrayLikeObject=vt,u.isBoolean=Hp,u.isBuffer=qe,u.isDate=Kp,u.isElement=Jp,u.isEmpty=Zp,u.isEqual=Yp,u.isEqualWith=jp,u.isError=ns,u.isFinite=Xp,u.isFunction=Oe,u.isInteger=Wo,u.isLength=Lr,u.isMap=Bo,u.isMatch=Qp,u.isMatchWith=Vp,u.isNaN=td,u.isNative=ed,u.isNil=rd,u.isNull=nd,u.isNumber=Uo,u.isObject=dt,u.isObjectLike=_t,u.isPlainObject=Un,u.isRegExp=rs,u.isSafeInteger=id,u.isSet=$o,u.isString=Rr,u.isSymbol=jt,u.isTypedArray=mn,u.isUndefined=sd,u.isWeakMap=ad,u.isWeakSet=od,u.join=lh,u.kebabCase=jd,u.last=ue,u.lastIndexOf=fh,u.lowerCase=Xd,u.lowerFirst=Qd,u.lt=ud,u.lte=cd,u.max=Kg,u.maxBy=Jg,u.mean=Zg,u.meanBy=Yg,u.min=jg,u.minBy=Xg,u.stubArray=fs,u.stubFalse=hs,u.stubObject=Dg,u.stubString=Ng,u.stubTrue=Wg,u.multiply=Qg,u.nth=hh,u.noConflict=Tg,u.noop=ls,u.now=Ir,u.pad=Vd,u.padEnd=tg,u.padStart=eg,u.parseInt=ng,u.random=Hd,u.reduce=gp,u.reduceRight=_p,u.repeat=rg,u.replace=ig,u.result=kd,u.round=Vg,u.runInContext=m,u.sample=mp,u.size=bp,u.snakeCase=sg,u.some=Mp,u.sortedIndex=yh,u.sortedIndexBy=wh,u.sortedIndexOf=bh,u.sortedLastIndex=Mh,u.sortedLastIndexBy=Ch,u.sortedLastIndexOf=Sh,u.startCase=og,u.startsWith=ug,u.subtract=t0,u.sum=e0,u.sumBy=n0,u.template=cg,u.times=Bg,u.toFinite=Fe,u.toInteger=K,u.toLength=qo,u.toLower=lg,u.toNumber=ce,u.toSafeInteger=ld,u.toString=rt,u.toUpper=fg,u.trim=hg,u.trimEnd=pg,u.trimStart=dg,u.truncate=gg,u.unescape=_g,u.uniqueId=$g,u.upperCase=vg,u.upperFirst=as,u.each=Eo,u.eachRight=Io,u.first=xo,cs(u,function(){var t={};return me(u,function(e,n){it.call(u.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),u.VERSION=o,re(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){u[t].placeholder=u}),re(["drop","take"],function(t,e){Q.prototype[t]=function(n){n=n===r?1:Ct(K(n),0);var s=this.__filtered__&&!e?new Q(this):this.clone();return s.__filtered__?s.__takeCount__=It(n,s.__takeCount__):s.__views__.push({size:It(n,L),type:t+(s.__dir__<0?"Right":"")}),s},Q.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),re(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==Cn||n==Hr;Q.prototype[t]=function(a){var c=this.clone();return c.__iteratees__.push({iteratee:W(a,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),re(["head","last"],function(t,e){var n="take"+(e?"Right":"");Q.prototype[t]=function(){return this[n](1).value()[0]}}),re(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Q.prototype[t]=function(){return this.__filtered__?new Q(this):this[n](1)}}),Q.prototype.compact=function(){return this.filter(qt)},Q.prototype.find=function(t){return this.filter(t).head()},Q.prototype.findLast=function(t){return this.reverse().find(t)},Q.prototype.invokeMap=Z(function(t,e){return typeof t=="function"?new Q(this):this.map(function(n){return Rn(n,t,e)})}),Q.prototype.reject=function(t){return this.filter(Fr(W(t)))},Q.prototype.slice=function(t,e){t=K(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Q(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=K(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},Q.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Q.prototype.toArray=function(){return this.take(L)},me(Q.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),a=u[s?"take"+(e=="last"?"Right":""):e],c=s||/^find/.test(e);a&&(u.prototype[e]=function(){var h=this.__wrapped__,g=s?[1]:arguments,y=h instanceof Q,x=g[0],A=y||H(h),P=function(Y){var V=a.apply(u,De([Y],g));return s&&F?V[0]:V};A&&n&&typeof x=="function"&&x.length!=1&&(y=A=!1);var F=this.__chain__,k=!!this.__actions__.length,B=c&&!F,J=y&&!k;if(!c&&A){h=J?h:new Q(this);var U=t.apply(h,g);return U.__actions__.push({func:Tr,args:[P],thisArg:r}),new se(U,F)}return B&&J?t.apply(this,g):(U=this.thru(P),B?s?U.value()[0]:U.value():U)})}),re(["pop","push","shift","sort","splice","unshift"],function(t){var e=tr[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);u.prototype[t]=function(){var a=arguments;if(s&&!this.__chain__){var c=this.value();return e.apply(H(c)?c:[],a)}return this[n](function(h){return e.apply(H(h)?h:[],a)})}}),me(Q.prototype,function(t,e){var n=u[e];if(n){var s=n.name+"";it.call(pn,s)||(pn[s]=[]),pn[s].push({name:e,func:n})}}),pn[br(r,$).name]=[{name:"wrapper",func:r}],Q.prototype.clone=gl,Q.prototype.reverse=_l,Q.prototype.value=vl,u.prototype.at=Jh,u.prototype.chain=Zh,u.prototype.commit=Yh,u.prototype.next=jh,u.prototype.plant=Qh,u.prototype.reverse=Vh,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=tp,u.prototype.first=u.prototype.head,Pn&&(u.prototype[Pn]=Xh),u},ln=Zc();Je?((Je.exports=ln)._=ln,ui._=ln):Tt._=ln}).call($n)})(Wr,Wr.exports);var s0=Wr.exports;const E=bs(s0),a0={rate:6,span:1e3,th:750};function o0(f,i){(i===null||typeof i>"u")&&(i=a0);let r=0;return Array.isArray(f)?r=(f[0]+f[1])/2:r=f,r<=i.th?1:(1+i.rate/i.span/100)**(r-i.th)}const ru={baseline:0,terrainScale:1};function Nt(f,i=0){return Math.round(f*10**i)/10**i}function nn(f,i,r,o,l){return r+(l-f)/(i-f)*(o-r)}function uu(f,i,r){let o=0,l=0;const d=[];for(o=0;o<r.length;o++)if(r[o]<f[l])d.push(i[l]);else{for(;l<f.length-1&&f[l+1]<=r[o];)l++;l===f.length-1||r[o]===f[l]?d.push(i[l]):d.push(nn(f[l],f[l+1],i[l],i[l+1],r[o]))}return d}function cu(f){let i,r,o,l,d=0,p=0,_=0,w=0,b=0;for(i=0;i<f.length;i++)r=f[i][0],o=f[i][1],l=f[i][2],b+=l,d+=l*r,_+=l*(r*r),p+=l*o,w+=l*(r*o);const C=(p*_-d*w)/(b*_-d*d);return[(b*w-d*p)/(b*_-d*d),C]}function lu(f,i,r,o){let l=0,d=0;const p=[];return r.forEach(_=>{for(;f[l]<_-o;)l++;for(l>0&&f[l]>=_&&l--;d<f.length-1&&f[d+1]<=_+o;)d++;d<f.length-1&&f[d]<=_&&d++;const w=Math.max(o,Math.abs(_-f[l])+.001,Math.abs(_-f[d])+.001),b=[];let C=0;for(let v=l;v<=d;v++)C=(1-(Math.abs(_-f[v])/w)**3)**3,b.push([f[v],i[v],C]);p.push(cu(b))}),p}function gs(f,i,r){return Nt(f,r)<Nt(i,r)}function u0(f,i,r){return Nt(f,r)>Nt(i,r)}function Br(f,i,r){return Nt(f,r)<=Nt(i,r)}function zr(f,i,r){return Nt(f,r)>=Nt(i,r)}function He(f,i,r){return Nt(f,r)===Nt(i,r)}const c0=Object.freeze(Object.defineProperty({__proto__:null,interp:nn,interpArray:uu,linearRegression:cu,req:He,rgt:u0,rgte:zr,rlt:gs,rlte:Br,round:Nt,wlslr:lu},Symbol.toStringTag,{value:"Module"}));function fu(f,i){function r(o){return o<f.noon?o+86400:o}return i>=f.sunrise&&i<=f.sunset?0:!isNaN(f.dawn)&&!isNaN(f.dusk)&&(i<=f.dawn||i>=f.dusk)?1:r(i)>=r(f.nadir)?nn(r(isNaN(f.dawn)?f.nadir:f.dawn),r(f.sunrise),1,0,r(i)):nn(r(f.sunset),r(isNaN(f.dusk)?f.nadir:f.dusk),0,1,r(i))}function l0({timeOfDaySeconds:f,terrainFactor:i,sun:r,model:o=ru}){if(i===1||f>=r.sunrise&&f<=r.sunset)return 1;(o===null||typeof o>"u")&&(o=ru);const l=r.nadirAltitude<-6?1:-(r.nadirAltitude/6),d=(o.terrainScale*(i-1)+o.baseline)*l,p=fu(r,f);return 1+d*p}const Me=["altitude","grade","terrain","heat","dark","fatigue","strategy"];class qn{constructor(i){Object.defineProperty(this,"_data",{value:{}}),Object.defineProperty(this,"_cache",{value:{}}),Me.forEach(r=>{Object.defineProperty(this,r,{enumerable:!0,get(){return this._data[r]||1},set(o){o!==1?this._data[r]=o:delete this._data[r],delete this._cache.combined}})}),Object.assign(this,i)}get combined(){return E.has(this._cache,"combined")||(this._cache.combined=Me.reduce((i,r)=>i*this[r],1)),this._cache.combined}}const f0={a:.0021,b:.034,lower:{lim:-22,m:-.0584,b:-.0164},upper:{lim:16,m:.1012,b:.4624}};function h0(f,i){return(i===null||typeof i>"u")&&(i=f0),f<i.lower.lim?i.lower.m*f+i.lower.b:f>i.upper.lim?i.upper.m*f+i.upper.b:i.a*f**2+i.b*f+1}function hu({point:f,model:i}={}){if(!i)return 1;const r=f.tod;let o=1;if(r>i.start&&r<i.stop){const l=(r-i.start)/(i.stop-i.start)*Math.PI;o+=(i.max-i.baseline)*Math.sin(l)/100}return o+=i.baseline/100,o}function p0({point:f,course:i}){const r=E.findLast(i.terrainFactors,o=>Br(o.start,f.loc,4));return r?r.value/100+1:1}function pu(f,i){let r=0,o=0;return f.forEach((l,d)=>{const p=d===f.length-1?i:f[d+1].onset,_=l.type==="linear"?l.value/2:l.value;o+=(r+_)*(p-l.onset),r+=l.value}),o/i}function d0(f){return f<30?2:f<60?5:f<90?10:f<120?15:20}function g0(f,i,r){let o=-pu(i,r);return i.forEach((l,d)=>{if(f>=l.onset){if(l.type==="step")o+=l.value;else if(l.type==="linear"){const p=d===i.length-1?r:i[d+1].onset;f>p?o+=l.value:o+=l.value*(f-l.onset)/(p-l.onset)}}}),o}class du{constructor(i={}){if(Object.defineProperty(this,"__class",{value:"Strategy",enumerable:!1}),i.__class==="Strategy")Object.assign(this,E.cloneDeep(i));else{if(!i.length)throw new Error("length required");if(this.length=i.length,E.isNumber(i.values))this.values=[{onset:0,value:i.values,type:"linear"}];else if(E.isArray(i.values))this.values=E.cloneDeep(i.values);else{if(i.values)throw new Error(`bad values input: ${JSON.stringify(i.values)}`);this.values=[{onset:0,value:d0(this.length),type:"linear"}]}}}at(i){return 1+g0(i,this.values,this.length)/100}addValue(i){const r=this.values.findIndex(o=>o.onset>=i.onset);r>=0?this.values.splice(r,0,i):this.values.push(i)}}function _0(f,i){return(f-1)*i+1}function _s(f,{plan:i,course:r}){r||(r=i.course),f.factors||(f.factors=new qn),Object.assign(f.factors,{grade:h0(f.grade),altitude:o0(f.alt),terrain:p0({point:f,course:r})}),i&&(Object.assign(f.factors,{strategy:i.strategy.at(f.loc)}),typeof f.tod<"u"&&Object.assign(f.factors,{heat:i.heatModel?hu({point:f,model:i.heatModel}):1,dark:i.event.sun?l0({timeOfDaySeconds:f.tod,terrainFactor:f.factors.terrain,sun:i.event.sun}):1}));const o={};r!=null&&r.scales&&Object.assign(o,r.scales),i!=null&&i.scales&&Object.assign(o,i.scales),Object.keys(o).filter(l=>l!==1&&f.factors[l]).forEach(l=>{f.factors[l]=_0(f.factors[l],o[l])})}class Ms{constructor(i){Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,i)}set name(i){this._data.name=i}get name(){var i;return this._data.name||((i=this.waypoint)==null?void 0:i.name)||void 0}get start(){return this.end-this.len}get pace(){if(E.isNumber(this.time))return this.time?this.time/this.len:0}get delay(){var i,r,o,l;if(!(!E.isNumber((i=this.point1)==null?void 0:i.elapsed)||!E.isNumber((r=this.point2)==null?void 0:r.elapsed)||!E.isNumber((o=this.point1)==null?void 0:o.time)||!E.isNumber((l=this.point2)==null?void 0:l.time)))return this.point2.elapsed-this.point1.elapsed-(this.point2.time-this.point1.time)}get elapsed(){var i;return(i=this.point2)==null?void 0:i.elapsed}get time(){var i,r;if(!(!E.isNumber((i=this.point1)==null?void 0:i.time)||!E.isNumber((r=this.point2)==null?void 0:r.time)))return this.point2.time-this.point1.time}get tod(){var i;return(i=this.point2)==null?void 0:i.tod}set delay(i){}set pace(i){}set elapsed(i){}set time(i){}set tod(i){}}function v0(f,i){return(typeof f=="object"?String(f._id):f)===(typeof i=="object"?String(i._id):i)}var vs={exports:{}},ps,iu;function m0(){if(iu)return ps;iu=1;var f=1e3,i=f*60,r=i*60,o=r*24,l=o*7,d=o*365.25;ps=function(C,v){v=v||{};var T=typeof C;if(T==="string"&&C.length>0)return p(C);if(T==="number"&&isFinite(C))return v.long?w(C):_(C);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(C))};function p(C){if(C=String(C),!(C.length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(C);if(v){var T=parseFloat(v[1]),D=(v[2]||"ms").toLowerCase();switch(D){case"years":case"year":case"yrs":case"yr":case"y":return T*d;case"weeks":case"week":case"w":return T*l;case"days":case"day":case"d":return T*o;case"hours":case"hour":case"hrs":case"hr":case"h":return T*r;case"minutes":case"minute":case"mins":case"min":case"m":return T*i;case"seconds":case"second":case"secs":case"sec":case"s":return T*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return T;default:return}}}}function _(C){var v=Math.abs(C);return v>=o?Math.round(C/o)+"d":v>=r?Math.round(C/r)+"h":v>=i?Math.round(C/i)+"m":v>=f?Math.round(C/f)+"s":C+"ms"}function w(C){var v=Math.abs(C);return v>=o?b(C,v,o,"day"):v>=r?b(C,v,r,"hour"):v>=i?b(C,v,i,"minute"):v>=f?b(C,v,f,"second"):C+" ms"}function b(C,v,T,D){var N=v>=T*1.5;return Math.round(C/T)+" "+D+(N?"s":"")}return ps}function y0(f){r.debug=r,r.default=r,r.coerce=w,r.disable=d,r.enable=l,r.enabled=p,r.humanize=m0(),r.destroy=b,Object.keys(f).forEach(C=>{r[C]=f[C]}),r.names=[],r.skips=[],r.formatters={};function i(C){let v=0;for(let T=0;T<C.length;T++)v=(v<<5)-v+C.charCodeAt(T),v|=0;return r.colors[Math.abs(v)%r.colors.length]}r.selectColor=i;function r(C){let v,T=null,D,N;function I(...O){if(!I.enabled)return;const $=I,j=Number(new Date),X=j-(v||j);$.diff=X,$.prev=v,$.curr=j,v=j,O[0]=r.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let nt=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(At,Pt)=>{if(At==="%%")return"%";nt++;const Gt=r.formatters[Pt];if(typeof Gt=="function"){const te=O[nt];At=Gt.call($,te),O.splice(nt,1),nt--}return At}),r.formatArgs.call($,O),($.log||r.log).apply($,O)}return I.namespace=C,I.useColors=r.useColors(),I.color=r.selectColor(C),I.extend=o,I.destroy=r.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>T!==null?T:(D!==r.namespaces&&(D=r.namespaces,N=r.enabled(C)),N),set:O=>{T=O}}),typeof r.init=="function"&&r.init(I),I}function o(C,v){const T=r(this.namespace+(typeof v>"u"?":":v)+C);return T.log=this.log,T}function l(C){r.save(C),r.namespaces=C,r.names=[],r.skips=[];let v;const T=(typeof C=="string"?C:"").split(/[\s,]+/),D=T.length;for(v=0;v<D;v++)T[v]&&(C=T[v].replace(/\*/g,".*?"),C[0]==="-"?r.skips.push(new RegExp("^"+C.slice(1)+"$")):r.names.push(new RegExp("^"+C+"$")))}function d(){const C=[...r.names.map(_),...r.skips.map(_).map(v=>"-"+v)].join(",");return r.enable(""),C}function p(C){if(C[C.length-1]==="*")return!0;let v,T;for(v=0,T=r.skips.length;v<T;v++)if(r.skips[v].test(C))return!1;for(v=0,T=r.names.length;v<T;v++)if(r.names[v].test(C))return!0;return!1}function _(C){return C.toString().substring(2,C.toString().length-2).replace(/\.\*\?$/,"*")}function w(C){return C instanceof Error?C.stack||C.message:C}function b(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}var w0=y0;(function(f,i){i.formatArgs=o,i.save=l,i.load=d,i.useColors=r,i.storage=p(),i.destroy=(()=>{let w=!1;return()=>{w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+f.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;w.splice(1,0,b,"color: inherit");let C=0,v=0;w[0].replace(/%[a-zA-Z%]/g,T=>{T!=="%%"&&(C++,T==="%c"&&(v=C))}),w.splice(v,0,b)}i.log=console.debug||console.log||(()=>{});function l(w){try{w?i.storage.setItem("debug",w):i.storage.removeItem("debug")}catch{}}function d(){let w;try{w=i.storage.getItem("debug")}catch{}return!w&&typeof process<"u"&&"env"in process&&(w=process.env.DEBUG),w}function p(){try{return localStorage}catch{}}f.exports=w0(i);const{formatters:_}=f.exports;_.j=function(w){try{return JSON.stringify(w)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}})(vs,vs.exports);var b0=vs.exports;const M0=bs(b0),ds={};function Ke(f){if(!ds[f]){const i=M0("ultraPacer:core");i(`loading debug for namespace "${f}"`),ds[f]=i.extend(f)}return ds[f]}function ms(f,i){const r=f.toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:i}).split(":").map(o=>Number(o));return r[0]*60*60+r[1]*60+r[2]}class rn extends Error{constructor(i,r){super(i),this.name="MissingDataError",this.field=r}}const Cs=Ke("geo"),ys=Me;function C0(f){const i={};return ys.forEach(r=>{const o={};o[r]=f,Object.assign(i,o)}),i}function Ss({plan:f,course:i,breaks:r}){var I;const o=Cs.extend("calcSegments");o("exec"),E.isNumber(r[0])&&(r=r.filter(O=>O>0&&gs(O,i.dist,4)),r.unshift(0),r=r.map((O,$)=>({start:O,end:r[$+1]||i.dist})));const l=f?f.points:i.points;if(!(l!=null&&l.length))throw o(`${f?"Plan":"Course"} points are not defined.`),new rn((f?"Plan":"Course")+" points are not defined.","points");const d=[];let p,_,w,b;const C=l[0].actual!==void 0&&l[l.length-1].actual!==void 0;for(p=0,_=r.length;p<_;p++){const O=r[p];He((I=r[p-1])==null?void 0:I.end,O.start,4)?w=b:w=f?f.getPoint({loc:O.start}):i.getPoint({loc:O.start}),b=f?f.getPoint({loc:O.end}):i.getPoint({loc:O.end});const $=O.end-O.start,j=new Ms({end:b.loc,len:$,gain:0,loss:0,alt:b.alt,grade:$>0?(b.alt-w.alt)/$/10*(b.alt-w.alt>0?i.gainScale:i.lossScale):0,delay:0,factorsSum:C0(0),point1:w,point2:b});C&&(j.actualTime=j.point2.actual.elapsed-j.point1.actual.elapsed,j.actualElapsed=j.point2.actual.elapsed),d.push(j)}const v=({seg:O,p1:$,p2:j})=>{const X=j.alt-$.alt;O[X>0?"gain":"loss"]+=X*(X>0?i.gainScale:i.lossScale),_s($,{plan:f,course:i});const nt=j.loc-$.loc;ys.forEach(bt=>{O.factorsSum[bt]+=$.factors[bt]*nt})};p=1;let T,D,N;for(let O=0;O<d.length;O++){for(T=d[O];Br(l[p].loc,T.point1.loc,4);)p++;for(D=T.point1;p<l.length&&Br(l[p].loc,T.point2.loc,4);)N=l[p],v({p1:D,p2:N,seg:T}),D=N,p++;v({p1:D,p2:T.point2,seg:T}),f&&(T.delay=f.delays.filter($=>zr(T.point1.loc,$.loc,4)&&gs(T.point2.loc,$.loc,4)).reduce(($,j)=>$+j,0))}return d.forEach(O=>{O.factors=new qn(Object.fromEntries(ys.map($=>[$,O.factorsSum[$]/O.len])))}),d}function gu(f){Cs("createSegments"),f.plan&&!f.course&&(f.course=f.plan.course);const i=f.course.waypoints.filter(o=>o.tier<3).sort((o,l)=>o.loc-l.loc);f.breaks=i.map(o=>o.loc);const r=Ss(f);if(!r.length)throw new Error("createSegments result is empty");return r.forEach((o,l)=>{o.waypoint=i[l+1]}),r}function Ur(f){Cs(`createSplits:${f.unit}`),f.plan&&!f.course&&(f.course=f.plan.course);const i=f.unit==="kilometers"?1:.621371,r=E.range(f.course.dist*i).map(l=>l/i);f.course.dist-E.last(r)>1e-4&&r.push(f.course.dist),Object.assign(f,{breaks:r});const o=Ss(f);if(!o.length)throw new Error("createSplits result is empty");return o}class su{constructor(i,r,o){Object.defineProperty(this,"course",{writable:!0}),this.point=r,this.course=i,this.loop=o}get lat(){return this.point.lat}get lon(){return this.point.lon}get alt(){return this.point.alt}get latlon(){return this.point.latlon}get grade(){return this.point.grade*(this.point.grade>0?this.course.gainScale:this.course.lossScale)}get loc(){let i=this.point.loc*this.course.distScale;return this.loop&&(i+=this.course.loopDist*this.loop),i}}var _u={exports:{}};(function(f,i){(function(){var r=Math.PI,o=Math.sin,l=Math.cos,d=Math.tan,p=Math.asin,_=Math.atan2,w=Math.acos,b=r/180,C=1e3*60*60*24,v=2440588,T=2451545;function D(L){return L.valueOf()/C-.5+v}function N(L){return new Date((L+.5-v)*C)}function I(L){return D(L)-T}var O=b*23.4397;function $(L,z){return _(o(L)*l(O)-d(z)*o(O),l(L))}function j(L,z){return p(o(z)*l(O)+l(z)*o(O)*o(L))}function X(L,z,q){return _(o(L),l(L)*o(z)-d(q)*l(z))}function nt(L,z,q){return p(o(z)*o(q)+l(z)*l(q)*l(L))}function bt(L,z){return b*(280.16+360.9856235*L)-z}function At(L){return L<0&&(L=0),2967e-7/Math.tan(L+.00312536/(L+.08901179))}function Pt(L){return b*(357.5291+.98560028*L)}function Gt(L){var z=b*(1.9148*o(L)+.02*o(2*L)+3e-4*o(3*L)),q=b*102.9372;return L+z+q+r}function te(L){var z=Pt(L),q=Gt(z);return{dec:j(q,0),ra:$(q,0)}}var Ht={};Ht.getPosition=function(L,z,q){var lt=b*-q,tt=b*z,ft=I(L),at=te(ft),ut=bt(ft,lt)-at.ra;return{azimuth:X(ut,tt,at.dec),altitude:nt(ut,tt,at.dec)}};var Mn=Ht.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];Ht.addTime=function(L,z,q){Mn.push([L,z,q])};var Gn=9e-4;function Gr(L,z){return Math.round(L-Gn-z/(2*r))}function Cn(L,z,q){return Gn+(L+z)/(2*r)+q}function Hn(L,z,q){return T+L+.0053*o(z)-.0069*o(2*q)}function Hr(L,z,q){return w((o(L)-o(z)*o(q))/(l(z)*l(q)))}function Ce(L){return-2.076*Math.sqrt(L)/60}function ge(L,z,q,lt,tt,ft,at){var ut=Hr(L,q,lt),yt=Cn(ut,z,tt);return Hn(yt,ft,at)}Ht.getTimes=function(L,z,q,lt){lt=lt||0;var tt=b*-q,ft=b*z,at=Ce(lt),ut=I(L),yt=Gr(ut,tt),Kt=Cn(0,tt,yt),Ft=Pt(Kt),Wt=Gt(Ft),_e=j(Wt,0),gt=Hn(Kt,Ft,Wt),Lt,Re,wt,Bt,le,ee,ht={solarNoon:N(gt),nadir:N(gt-.5)};for(Lt=0,Re=Mn.length;Lt<Re;Lt+=1)wt=Mn[Lt],Bt=(wt[0]+at)*b,le=ge(Bt,tt,ft,_e,yt,Ft,Wt),ee=gt-(le-gt),ht[wt[1]]=N(ee),ht[wt[2]]=N(le);return ht};function Kn(L){var z=b*(218.316+13.176396*L),q=b*(134.963+13.064993*L),lt=b*(93.272+13.22935*L),tt=z+b*6.289*o(q),ft=b*5.128*o(lt),at=385001-20905*l(q);return{ra:$(tt,ft),dec:j(tt,ft),dist:at}}Ht.getMoonPosition=function(L,z,q){var lt=b*-q,tt=b*z,ft=I(L),at=Kn(ft),ut=bt(ft,lt)-at.ra,yt=nt(ut,tt,at.dec),Kt=_(o(ut),d(tt)*l(at.dec)-o(at.dec)*l(ut));return yt=yt+At(yt),{azimuth:X(ut,tt,at.dec),altitude:yt,distance:at.dist,parallacticAngle:Kt}},Ht.getMoonIllumination=function(L){var z=I(L||new Date),q=te(z),lt=Kn(z),tt=149598e3,ft=w(o(q.dec)*o(lt.dec)+l(q.dec)*l(lt.dec)*l(q.ra-lt.ra)),at=_(tt*o(ft),lt.dist-tt*l(ft)),ut=_(l(q.dec)*o(q.ra-lt.ra),o(q.dec)*l(lt.dec)-l(q.dec)*o(lt.dec)*l(q.ra-lt.ra));return{fraction:(1+l(at))/2,phase:.5+.5*at*(ut<0?-1:1)/Math.PI,angle:ut}};function Se(L,z){return new Date(L.valueOf()+z*C/24)}Ht.getMoonTimes=function(L,z,q,lt){var tt=new Date(L);lt?tt.setUTCHours(0,0,0,0):tt.setHours(0,0,0,0);for(var ft=.133*b,at=Ht.getMoonPosition(tt,z,q).altitude-ft,ut,yt,Kt,Ft,Wt,_e,gt,Lt,Re,wt,Bt,le,ee,ht=1;ht<=24&&(ut=Ht.getMoonPosition(Se(tt,ht),z,q).altitude-ft,yt=Ht.getMoonPosition(Se(tt,ht+1),z,q).altitude-ft,Wt=(at+yt)/2-ut,_e=(yt-at)/2,gt=-_e/(2*Wt),Lt=(Wt*gt+_e)*gt+ut,Re=_e*_e-4*Wt*ut,wt=0,Re>=0&&(ee=Math.sqrt(Re)/(Math.abs(Wt)*2),Bt=gt-ee,le=gt+ee,Math.abs(Bt)<=1&&wt++,Math.abs(le)<=1&&wt++,Bt<-1&&(Bt=le)),wt===1?at<0?Kt=ht+Bt:Ft=ht+Bt:wt===2&&(Kt=ht+(Lt<0?le:Bt),Ft=ht+(Lt<0?Bt:le)),!(Kt&&Ft));ht+=2)at=yt;var ve={};return Kt&&(ve.rise=Se(tt,Kt)),Ft&&(ve.set=Se(tt,Ft)),!Kt&&!Ft&&(ve[Lt>0?"alwaysUp":"alwaysDown"]=!0),ve},f.exports=Ht})()})(_u);var S0=_u.exports;const x0=bs(S0),{getTimes:A0,getPosition:P0}=x0;class vu{constructor(i){Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,i)}set start(i){this._data.start=i,Object.keys(this._cache).forEach(r=>{delete this._cache[r]})}get start(){return this._data.start}get startTime(){return E.isNumber(this._cache.startTime)?this._cache.startTime:(this._cache.startTime=ms(this.start,this.timezone),this._cache.startTime)}get hasTOD(){return this.start instanceof Date&&!isNaN(this.start)}get sun(){if(this._cache.sun)return this._cache.sun;const i=A0(this.start,this.lat,this.lon),r=P0(i.nadir,this.lat,this.lon),o={},l=["nadir","dawn","sunrise","dusk","sunset","solarNoon"],d=["nadir","dawn","sunrise","dusk","sunset","noon"];return l.forEach((p,_)=>{isNaN(i[p])||(o[d[_]]=ms(i[p],this.timezone))}),o.nadirAltitude=r.altitude*180/Math.PI,this._cache.sun=o,this._cache.sun}dateAtElapsed(i){const r=new Date(this.start);return r.setTime(r.getTime()+i*1e3),r}elapsedToTimeOfDay(i){return(this.startTime+i)%86400}serialize(){return E.pick(this,["start","sun","lat","lon","timezone"])}}var bn={};(function(f){f.parseDMS=function(r){if(typeof l=="object")throw new TypeError("geo.parseDMS - dmsStr is [DOM?] object");if(typeof r=="number"&&isFinite(r))return Number(r);var o=String(r).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(o[o.length-1]==""&&o.splice(o.length-1),o=="")return NaN;switch(o.length){case 3:var l=o[0]/1+o[1]/60+o[2]/3600;break;case 2:var l=o[0]/1+o[1]/60;break;case 1:var l=o[0];break;default:return NaN}return/^-|[WS]$/i.test(r.trim())&&(l=-l),Number(l)},f.toDMS=function(r,o,l){if(typeof r=="object")throw new TypeError("geo.toDMS - deg is [DOM?] object");if(isNaN(r))return null;if(typeof o>"u"&&(o="dms"),typeof l>"u")switch(o){case"d":l=4;break;case"dm":l=2;break;case"dms":l=0;break;default:o="dms",l=0}switch(r=Math.abs(r),o){case"d":_=r.toFixed(l),_<100&&(_="0"+_),_<10&&(_="0"+_),dms=_+"°";break;case"dm":var d=(r*60).toFixed(l),_=Math.floor(d/60),w=(d%60).toFixed(l);_<100&&(_="0"+_),_<10&&(_="0"+_),w<10&&(w="0"+w),dms=_+"°"+w+"′";break;case"dms":var p=(r*3600).toFixed(l),_=Math.floor(p/3600),w=Math.floor(p/60)%60,b=(p%60).toFixed(l);_<100&&(_="0"+_),_<10&&(_="0"+_),w<10&&(w="0"+w),b<10&&(b="0"+b),dms=_+"°"+w+"′"+b+"″";break}return dms},f.toLat=function(r,o,l){var d=f.toDMS(r,o,l);return d==null?".":d.slice(1)+(r<0?"S":"N")},f.toLon=function(r,o,l){var d=f.toDMS(r,o,l);return d==null?".":d+(r<0?"W":"E")},f.toBrng=function(r,o,l){r=(Number(r)+360)%360;var d=f.toDMS(r,o,l);return d==null?".":d.replace("360","0")};var i=6371;f.latlon=function(r,o){this.lat=typeof r=="number"?r:typeof r=="string"&&r.trim()!=""?+r:NaN,this.lng=typeof o=="number"?o:typeof o=="string"&&o.trim()!=""?+o:NaN},f.latlon.prototype.distanceTo=function(r,o){typeof o>"u"&&(o=4);var l=this.distanceRadTo(r),d=i*l;return d.toPrecisionFixed(o)},f.latlon.prototype.distanceRadTo=function(r){var o=this.lat.toRad(),l=this.lng.toRad(),d=r.lat.toRad(),p=r.lng.toRad(),_=d-o,w=p-l,b=Math.sin(_/2)*Math.sin(_/2)+Math.cos(o)*Math.cos(d)*Math.sin(w/2)*Math.sin(w/2),C=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b));return C},f.latlon.prototype.bearingTo=function(r){var o=this.bearingRadTo(r);return(o.toDeg()+360)%360},f.latlon.prototype.bearingRadTo=function(r){var o=this.lat.toRad(),l=r.lat.toRad(),d=(r.lng-this.lng).toRad(),p=Math.cos(o)*Math.sin(l)-Math.sin(o)*Math.cos(l)*Math.cos(d),_=Math.cos(l)*Math.sin(d),w=Math.atan2(_,p);return w},f.latlon.prototype.finalBearingTo=function(r){var o=r.lat.toRad(),l=this.lat.toRad(),d=(this.lng-r.lng).toRad(),p=Math.sin(d)*Math.cos(l),_=Math.cos(o)*Math.sin(l)-Math.sin(o)*Math.cos(l)*Math.cos(d),w=Math.atan2(p,_);return(w.toDeg()+180)%360},f.latlon.prototype.midpointTo=function(r){var o=this.lat.toRad(),l=r.lat.toRad(),d=(r.lng-this.lng).toRad(),p=Math.cos(l)*Math.cos(d),_=Math.cos(l)*Math.sin(d),w=this.lng.toRad(),b=Math.atan2(Math.sin(o)+Math.sin(l),Math.sqrt((Math.cos(o)+p)*(Math.cos(o)+p)+_*_)),C=w+Math.atan2(_,Math.cos(o)+p);return C=(C+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(b.toDeg(),C.toDeg())},f.midpoint=function(r){var o=0,l=0,d=0;for(var p in r){var _=r[p],w=_.lat*Math.PI/180,b=_.lng*Math.PI/180,C=Math.cos(w)*Math.cos(b),v=Math.cos(w)*Math.sin(b),T=Math.sin(w);o+=C,l+=v,d+=T}o=o/r.length,l=l/r.length,d=d/r.length;var D=Math.atan2(l,o),N=Math.sqrt(o*o+l*l),I=Math.atan2(d,N);return new f.latlon(I*180/Math.PI,D*180/Math.PI)},f.latlon.prototype.interpolate=function(r,o){var l=this.distanceRadTo(r),d=this.bearingRadTo(r),p=this.lat.toRad(),_=this.lng.toRad();r.lat.toRad(),r.lng.toRad();for(var w=Math.sin(p),b=Math.cos(p),C=[],v=0;v<o;v++){var T=1/(o-1)*v,D=l*T,N=Math.sin(D),I=Math.cos(D),O=Math.asin(w*I+b*N*Math.cos(d)),$=_+Math.atan2(Math.sin(d)*N*b,I-w*Math.sin(O)),j=O.toDeg(),X=$.toDeg();for(j>90&&(j=90),j<-90&&(j=-90);X>180;)X-=360;for(;X<=-180;)X+=360;C.push(new f.latlon(j,X))}return C},f.latlon.prototype.destinationPoint=function(r,o){o=typeof o=="number"?o:typeof o=="string"&&o.trim()!=""?+o:NaN,o=o/i,r=r.toRad();var l=this.lat.toRad(),d=this.lng.toRad(),p=Math.asin(Math.sin(l)*Math.cos(o)+Math.cos(l)*Math.sin(o)*Math.cos(r)),_=d+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(l),Math.cos(o)-Math.sin(l)*Math.sin(p));return _=(_+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(p.toDeg(),_.toDeg())},f.latlon.intersection=function(r,o,l,d){o=typeof o=="number"?o:typeof o=="string"&&trim(o)!=""?+o:NaN,d=typeof d=="number"?d:typeof d=="string"&&trim(d)!=""?+d:NaN;var p=r.lat.toRad(),_=r.lng.toRad(),w=l.lat.toRad(),b=l.lng.toRad(),C=o.toRad(),v=d.toRad(),T=w-p,D=b-_,N=2*Math.asin(Math.sqrt(Math.sin(T/2)*Math.sin(T/2)+Math.cos(p)*Math.cos(w)*Math.sin(D/2)*Math.sin(D/2)));if(N==0)return null;var I=Math.acos((Math.sin(w)-Math.sin(p)*Math.cos(N))/(Math.sin(N)*Math.cos(p)));isNaN(I)&&(I=0);var O=Math.acos((Math.sin(p)-Math.sin(w)*Math.cos(N))/(Math.sin(N)*Math.cos(w)));if(Math.sin(b-_)>0)var $=I,j=2*Math.PI-O;else $=2*Math.PI-I,j=O;var X=(C-$+Math.PI)%(2*Math.PI)-Math.PI,nt=(j-v+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(X)==0&&Math.sin(nt)==0||Math.sin(X)*Math.sin(nt)<0)return null;var bt=Math.acos(-Math.cos(X)*Math.cos(nt)+Math.sin(X)*Math.sin(nt)*Math.cos(N)),At=Math.atan2(Math.sin(N)*Math.sin(X)*Math.sin(nt),Math.cos(nt)+Math.cos(X)*Math.cos(bt)),Pt=Math.asin(Math.sin(p)*Math.cos(At)+Math.cos(p)*Math.sin(At)*Math.cos(C)),Gt=Math.atan2(Math.sin(C)*Math.sin(At)*Math.cos(p),Math.cos(At)-Math.sin(p)*Math.sin(Pt)),te=_+Gt;return te=(te+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(Pt.toDeg(),te.toDeg())},f.latlon.prototype.rhumbDistanceTo=function(r){var o=i,l=this.lat.toRad(),d=r.lat.toRad(),p=(r.lat-this.lat).toRad(),_=Math.abs(r.lng-this.lng).toRad(),w=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(l/2+Math.PI/4)),b=isFinite(p/w)?p/w:Math.cos(l);Math.abs(_)>Math.PI&&(_=_>0?-(2*Math.PI-_):2*Math.PI+_);var C=Math.sqrt(p*p+b*b*_*_)*o;return C.toPrecisionFixed(4)},f.latlon.prototype.rhumbBearingTo=function(r){var o=this.lat.toRad(),l=r.lat.toRad(),d=(r.lng-this.lng).toRad(),p=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(o/2+Math.PI/4));Math.abs(d)>Math.PI&&(d=d>0?-(2*Math.PI-d):2*Math.PI+d);var _=Math.atan2(d,p);return(_.toDeg()+360)%360},f.latlon.prototype.rhumbDestinationPoint=function(r,o){var l=i,d=parseFloat(o)/l,p=this.lat.toRad(),_=this.lng.toRad();r=r.toRad();var w=d*Math.cos(r);Math.abs(w)<1e-10&&(w=0);var b=p+w,C=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(p/2+Math.PI/4)),v=isFinite(w/C)?w/C:Math.cos(p),T=d*Math.sin(r)/v;Math.abs(b)>Math.PI/2&&(b=b>0?Math.PI-b:-Math.PI-b);var D=(_+T+3*Math.PI)%(2*Math.PI)-Math.PI;return new f.latlon(b.toDeg(),D.toDeg())},f.latlon.prototype.rhumbMidpointTo=function(r){var o=this.lat.toRad(),l=this.lng.toRad(),d=r.lat.toRad(),p=r.lng.toRad();Math.abs(p-l)>Math.PI&&(l+=2*Math.PI);var _=(o+d)/2,w=Math.tan(Math.PI/4+o/2),b=Math.tan(Math.PI/4+d/2),C=Math.tan(Math.PI/4+_/2),v=((p-l)*Math.log(C)+l*Math.log(b)-p*Math.log(w))/Math.log(b/w);return isFinite(v)||(v=(l+p)/2),v=(v+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(_.toDeg(),v.toDeg())},f.latlon.prototype.lat=function(r,o){return typeof r>"u"?this.lat:f.toLat(this.lat,r,o)},f.latlon.prototype.lon=function(r,o){return typeof r>"u"?this.lng:f.toLon(this.lng,r,o)},f.latlon.prototype.toString=function(r,o){return typeof r>"u"&&(r="dms"),f.toLat(this.lat,r,o)+", "+f.toLon(this.lng,r,o)},typeof Number.prototype.toRad>"u"&&(Number.prototype.toRad=function(){return this*Math.PI/180}),typeof Number.prototype.toDeg>"u"&&(Number.prototype.toDeg=function(){return this*180/Math.PI}),typeof Number.prototype.toPrecisionFixed>"u"&&(Number.prototype.toPrecisionFixed=function(r){var o=this.toPrecision(r);return o=o.replace(/(.+)e\+(.+)/,function(l,d,p){d=d.replace(/\./,"");for(var _=d.length-1;p-- >_;)d=d+"0";return d}),o=o.replace(/(.+)e-(.+)/,function(l,d,p){for(d=d.replace(/\./,"");p-- >1;)d="0"+d;return"0."+d}),o}),typeof String.prototype.trim>"u"&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")})})(bn);class xs{constructor(i){if(i.length===3)[this.lat,this.lon,this.alt]=i;else if(i.length===5)[this.loc,this.lat,this.lon,this.alt,this.grade]=i;else throw new Error("Point data invalid")}get __class(){return"Point"}get latlon(){return new bn.latlon(this.lat,this.lon)}}function $r(f,i,r){const o=new xs([f.lat,f.lon,f.alt]);o.loc=r;const l=new bn.latlon(f.lat,f.lon),d=new bn.latlon(i.lat,i.lon),p=Math.abs(o.loc-f.loc),_=l.bearingTo(d),w=l.destinationPoint(_,p);return o.lat=Number(w.lat),o.lon=Number(w.lng),["grade"].forEach(v=>{o[v]=f[v]}),["alt"].forEach(v=>{o[v]=nn(f.loc,i.loc,f[v],i[v],o.loc)}),o}const T0=Ke("models:Waypoint");class ws{constructor(i){Object.defineProperty(this,"_data",{value:{}}),i=E.defaults(i,{loop:1}),Object.assign(this,i)}get __class(){return"Waypoint"}get site(){return this._data.site}set site(i){if(i.__class!=="Site")throw new TypeError('Waypoint "site" field must be of "Site" class.');this._data.site=i}get course(){return this.site.course}get name(){return this.loop>=2&&this.type!=="finish"?`${this.site.name} ${this.loop}`:this.site.name}get description(){return this.site.description}get loc(){return(this.site.percent+this.loop-1)*this.course.loopDist}set loc(i){if(!E.isNumber(i))throw new Error("Wrong format for Waypoint.loc");this.type==="start"?this.site.percent=0:this.type==="finish"?this.site.percent=1:this.site.percent=i/this.course.loopDist%1}get lat(){return E.isNumber(this.site.lat)||this.refreshLLA(),this.site.lat}get lon(){return E.isNumber(this.site.lon)||this.refreshLLA(),this.site.lon}get alt(){var i,r;return this.site.elevation===void 0&&((r=(i=this.course)==null?void 0:i.track)!=null&&r.points)&&this.refreshLLA(),this.site.elevation}set lat(i){this.site.lat=i}set lon(i){this.site.lon=i}set alt(i){this.site.elevation=i}get tier(){return this.site.tier||1}get type(){return this.site.type}get dropbags(){return this.site.dropbags||!1}set dropbags(i){this.site.dropbags=!!i}get crew(){return this.site.crew||!1}set crew(i){this.site.crew=!!i}get terrainFactor(){return this.site.terrainFactor}get terrainType(){return this.site.terrainType}len(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.len}gain(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.gain}loss(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.loss}time(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.time}pace(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.pace}elapsed(i){if(this.loc===0)return 0;const r=this.matchingSegment(i);if(r)return r.elapsed}get hasTypicalDelay(){return this.type==="aid"||this.type==="water"||this.loop>=2&&this.type==="start"}delay(i,r){console.warn('"Waypoint.delay" field is deprecated.');const o=r.find(l=>l.site===this.site._id&&this.loop===l.loop);return o?o.delay:this.hasTypicalDelay?i:0}get cutoff(){var i;if(this.tier===1){const r=(i=this.site.cutoffs)==null?void 0:i.find(o=>o.loop===this.loop);if(r)return r.time}return null}set cutoff(i){var o;const r=(o=this.site.cutoffs)==null?void 0:o.findIndex(l=>l.loop===this.loop);r>=0?i?this.site.cutoffs[r].time=i:this.site.cutoffs.splice(r,1):i&&(this.site.cutoffs||(this.site.cutoffs=[]),this.site.cutoffs.push({time:i,loop:this.loop}))}matchingSegment(i){return i.find(r=>r.waypoint.site._id===this.site._id&&r.waypoint.loop===this.loop)}refreshLLA(){var d,p,_;if(T0("refreshLLA"),!((_=(p=(d=this.course)==null?void 0:d.track)==null?void 0:p.points)!=null&&_.length))throw new rn("No track points defined","points");let i,r,o,l;this.type==="start"?{lat:i,lon:r,alt:o}=this.course.track.points[0]:this.type==="finish"?{lat:i,lon:r,alt:o}=E.last(this.course.track.points):{lat:i,lon:r,alt:o,ind:l}=this.course.track.getLLA(this.loc/this.course.distScale,{start:this.site.pointsIndex||0}),this.lat=i,this.lon=r,this.alt=o,l&&(this.site.pointsIndex=l),this.course.clearCache(1)}serialize(){const i=E.pick(this,["loop","name","type","cutoff","loc","lat","lon","alt","tier","crew","dropbags","terrainType","terrainFactor"]);return i.site=this.site._id,i}}const Dr=Ke("models:Waypoint");class Nr{constructor(i){if(Dr(`constructor: ${i.name||"unnamed"}`),Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),i=E.defaults(i,{cutoffs:[]}),!i.course)throw new Error('Site requires "course" field to be defined.');Object.assign(this,i)}clearCache(){Dr(`clearCache: ${this.name}`),Object.keys(this._cache).forEach(i=>{delete this._cache[i]})}get __class(){return"Site"}get course(){return this._data.course}set course(i){if(i.__class!=="Course")throw new TypeError('Site "course" field must be of "Course" class.');this._data.course=i}get percent(){switch(this.type){case"start":return 0;case"finish":return 1;default:return this._data.percent}}set percent(i){this._data.percent=i}get waypoints(){return this._cache.waypoints?this._cache.waypoints:(Dr(`generating waypoints array: ${this.name}`),this.type==="finish"?this._cache.waypoints=[new ws({site:this,loop:this.course.loops})]:this._cache.waypoints=E.range(this.course.loops).map(i=>new ws({site:this,loop:i+1})),this._cache.waypoints)}serialize(){Dr(`serialize: ${this.name}`);const i=Object.keys(this);return i.push("percent"),E.pick(this,i)}}const mu=({points:f,locs:i,gt:r})=>{const o=lu(f.map(d=>d.loc),f.map(d=>d.alt),i,r),l=[];return i.forEach((d,p)=>{let _=o[p][0]/10;_>50?_=50:_<-50&&(_=-50);const w=d*o[p][0]+o[p][1];l.push({grade:_,alt:w})}),l};function E0(f){const i=[];let r=0;for(r=0;r<f.length;r++)i.push(f[r].loc);const o=mu({points:f,locs:i,gt:.05});f.forEach((l,d)=>{l.grade=o[d].grade})}const yu=f=>{let i=0,r=0;f[0].loc=0;for(let o=1,l=f.length;o<l;o++)i=Number(f[o-1].latlon.distanceTo(f[o].latlon)),r+=i,f[o].loc=r},wn=Ke("models:Track");class qr{constructor(i){wn("Creating new Track object"),Object.defineProperty(this,"_data",{value:{stats:{}}}),Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"type",{value:"course",enumerable:!0,writable:!0}),i.type&&(this.type=i.type),wn(`Initializing fields: ${Object.keys(i).join(", ")}`),Object.assign(this,i)}get __class(){return"Track"}clearCache(){Object.keys(this._cache).forEach(i=>{delete this._cache[i]})}set points(i){wn("set-points"),this.clearCache(),Array.isArray(i)||(i=i.lat.map((r,o)=>[i.lat[o],i.lon[o],i.alt[o]])),i[0].__class!=="Point"&&(i=i.map(r=>new xs(r))),yu(i),E0(i),this._data.points=i,wn(`set-points - ${i.length} points`)}get points(){return this._data.points}set start(i){this._data.start=i}get start(){var r;const i=(r=this.points)!=null&&r[0]?E.pick(this.points[0],["lat","lon"]):this._data.start;if(!i)throw new rn("Neither start not track points are defined.","points");return i}set finish(i){this._data.finish=i}get finish(){var r;const i=(r=this.points)!=null&&r.length?E.pick(E.last(this.points),["lat","lon"]):this._data.finish;if(!i)throw new rn("Neither finish nor points points are defined.","points");return i}set stats(i){Object.assign(this._data,i)}get stats(){if(this._cache.stats)return this._cache.stats;if(this.points){wn("Calculating");const i=E.last(this.points).loc;let r=0,o=0,l=0,d=this.points[0].alt;return this.points.forEach(p=>{l=p.alt-d,l<0?o+=l:r+=l,d=p.alt}),this._cache.stats={gain:r,loss:o,dist:i},this._cache.stats}return this._data.stats}get dist(){return this.stats.dist}set dist(i){this._data.stats.dist=i}get gain(){return this.stats.gain}set gain(i){this._data.stats.gain=i}get loss(){return this.stats.loss}set loss(i){this._data.stats.loss=i}getLLA(i,r={}){const o=Array.isArray(i),l=o?[...i]:[i];l.forEach((C,v)=>{C>this.dist&&(l[v]=C%this.dist)});let d=l.length===1&&r.start&&r.start<this.points.length-1?r.start:0;const p=!!(d&&this.points[d].loc>l[0]),_=[],w=this.points.length-1;i=l.shift();function b(C){return p?C+1:C-1}for(;d<=w&&d>=0;){let C,v;if(i===0?(C=this.points[0],v=0):He(i,this.dist,4)?(C=E.last(this.points),v=this.points.length-1):!p&&(d===w||this.points[d].loc>=i)||p&&(d===0||this.points[d].loc<=i)?this.points[d].loc===i||!p&&d===w||p&&d===0?(C=this.points[d],v=d):(C=$r(this.points[b(d)],this.points[d],i),v=d):p?d--:d++,C){const{lat:T,lon:D,alt:N,grade:I}=C;if(_.push({lat:T,lon:D,alt:N,grade:I,ind:v}),i=l.shift(),i==null)break}}return o?_:_[0]}getNearestPoint(i,r,o){let d=this.points.findIndex(w=>w===r),p=this.points[d],_=0;for(;o>.025;){const w=o/5,b=[p];for(let T=1;T<=5;T++){const D=p.loc+w*T;if(D<=this.dist){for(;this.points[d+1].loc<D&&d<this.points.length-1;)d++;b.push(this.points[d])}}const C=b.map(T=>Number(i.distanceTo(T.latlon)));_=Math.min(...C);const v=C.findIndex(T=>T===_);p=b[v],o=o/5}return{point:p,delta:_}}getNearestLoc(i,r=null,o){const d=new bn.latlon(i[0],i[1]);let p,_;const w=(b,C)=>{for(_=b;C>.025;){const v=C/5;let T=[];for(let I=-5;I<=5;I++){const O=_+v*I;O>0&&O<=this.dist&&T.push(Math.max(0,Math.min(O,this.dist)))}T=T.filter((I,O,$)=>$.indexOf(I)===O);const D=this.getLLA(T);D.forEach(I=>{const O=new bn.latlon(I.lat,I.lon);I.dist=Number(d.distanceTo(O))}),p=D.reduce((I,O)=>Math.min(I,O.dist),D[0].dist);const N=D.findIndex(I=>I.dist===p);_=T[N],C=C/5}};if(r!==null){r=Math.min(r,this.dist);const b=Math.max(.5,.05*this.dist);if(w(r,b),p<.1)return _}return r=this.dist/2,o=Math.max(this.dist-r,r),w(r,o),_}reduceDensity({spacing:i,length:r}={}){const o=wn.extend("reduceDensity");if(i||(i=.025),r||(r=this.points.length/2),this.dist/i>r/2)return o("Does not meet criteria"),this;const l=this.dist,d=Math.floor(l/i)+1,p=Array(d).fill(0).map((v,T)=>Nt(T++*i,3));p[p.length-1]<l&&p.push(l);const _=mu({points:this.points,locs:p,gt:2*i}),w=this.getLLA(p,0).map((v,T)=>[Nt(v.lat,6),Nt(v.lon,6),Nt(_[T].alt,2)]),b=this.source,C=new qr({source:b,points:w});return o(`Reduced from ${this.points.length} to ${C.points.length} points.`),C}}const be=Ke("models:Course");class I0{constructor(i){Object.defineProperty(this,"_cache",{value:{}}),Object.assign(this,i)}get __class(){return"CourseSplits"}get segments(){var i;return(i=this._cache.segments)!=null&&i.length||(this._cache.segments=gu({course:this.course})),this._cache.segments}set segments(i){this._cache.segments=i}get miles(){var i;return(i=this._cache.miles)!=null&&i.length||(this._cache.miles=Ur({unit:"miles",course:this.course})),this._cache.miles}set miles(i){this._cache.miles=i}get kilometers(){var i;return(i=this._cache.kilometers)!=null&&i.length||(this._cache.kilometers=Ur({unit:"kilometers",course:this.course})),this._cache.kilometers}set kilometers(i){this._cache.kilometers=i}}const O0=["cache","distance"];class F0{constructor(i){Object.defineProperty(this,"_data",{value:i._data||{sites:[new Nr({course:this,_id:E.random(1e4,2e4),name:"Start",type:"start",percent:0}),new Nr({course:this,_id:E.random(3e4,4e4),name:"Finish",type:"finish",percent:1})]},enumerable:!0}),Object.defineProperty(this,"_cache",{value:{}});const r=Object.keys(i).filter(o=>!O0.includes(o));Object.assign(this,E.pick(i,r))}get __class(){return"Course"}get loops(){return this._data.loops||1}set loops(i){i!==this._data.loops&&(this._data.loops=i,this.clearCache(2))}get dist(){var i;return this._cache.dist||(this._cache.dist=this._data.dist||((i=this.track)!=null&&i.dist?this.track.dist*this.loops:void 0))}get gain(){var i;return this._cache.gain||(this._cache.gain=this._data.gain||((i=this.track)!=null&&i.gain?this.track.gain*this.loops:void 0))}get loss(){var i;return this._cache.loss||(this._cache.loss=this._data.loss||((i=this.track)!=null&&i.loss?this.track.loss*this.loops:void 0))}set dist(i){He(i,this._data.dist,6)||(be(`overriding dist to ${i}`),this._data.dist=i,this.clearCache(2))}set gain(i){He(i,this._data.gain,6)||(be(`overriding gain to ${i}`),this._data.gain=i,this.clearCache(2))}set loss(i){He(i,this._data.loss,6)||(be(`overriding loss to ${i}`),this._data.loss=i,this.clearCache(2))}get distScale(){return this._data.dist?this._data.dist/(this.track.dist*this.loops):1}get gainScale(){return this._data.gain?this._data.gain/(this.track.gain*this.loops):1}get lossScale(){return this._data.loss?this._data.loss/(this.track.loss*this.loops):1}get loopDist(){return this.dist/this.loops}get loopGain(){return this.gain/this.loops}get loopLoss(){return this.loss/this.loops}get sites(){return this._data.sites}set sites(i){this._data.sites=i.map(r=>r.__class==="Site"?r:new Nr(E.assign(r,{course:this}))),this.clearCache(1)}clearCache(i=1){be(`clearCache-${i}`),(i===1?["waypoints","terrainFactors","cutoffs","stats","splits"]:Object.keys(this._cache)).forEach(o=>{delete this._cache[o]}),i===2&&this.sites.forEach(o=>{o.clearCache()})}get waypoints(){var r;if(this._cache.waypoints)return this._cache.waypoints;if(!((r=this.track)!=null&&r.dist))return[];let i=[];return this.sites.forEach(o=>{i.push(...o.waypoints)}),i=i.sort((o,l)=>o.loc-l.loc),this._cache.waypoints=i,this._cache.waypoints}get track(){return this._data.track}set track(i){be("set-track"),i.__class==="Track"?this._data.track=i:this._data.track=new qr(i),this.clearCache(2)}get points(){var i,r;if(this._cache.points)return this._cache.points;if(be("generating points array"),!((r=(i=this.track)==null?void 0:i.points)!=null&&r.length))throw new rn("Track points are not defined.","points");this._cache.points=new Array(this.track.points.length*this.loops);for(let o=0;o<this.loops;o++)for(let l=0;l<this.track.points.length;l++)this.points[l+o*this.track.points.length]=new su(this,this.track.points[l],o);return this._cache.points}set points(i){throw new Error("cannot set points directly")}getPoint({loc:i,insert:r=!1}){const o=this.points.findIndex(b=>zr(b.loc,i,4)),l=this.points[o];if(He(l.loc,i,4))return l;be(`getPoint: ${r?"inserting":"creating"} new CoursePoint at ${i}`);const d=o-1,p=this.points[d],_=$r(p.point,l.point,i%this.loopDist/this.distScale),w=new su(this,_,Math.floor(i/this.loopDist));return p.actual&&l.actual&&(w.actual=$r(p.actual,l.actual,i),w.actual.elapsed=nn(p.loc,l.loc,p.actual.elapsed,l.actual.elapsed,w.loc)),r&&this.points.splice(o,0,w),w}refreshWaypointLLAs(){this.waypoints.filter(i=>i.loop===1||i.type==="finish").forEach(i=>{i.refreshLLA()})}get terrainFactors(){if(this._cache.terrainFactors)return this._cache.terrainFactors;be("regenerating terrainFactors");const i=this.waypoints.filter((r,o)=>{var l;return o===0||!E.isNil(r.terrainFactor)&&r.terrainFactor!==((l=this.waypoints[o-1])==null?void 0:l.terrainFactor)});return this._cache.terrainFactors=i.map((r,o)=>new R0({startWaypoint:r,endWaypoint:i[o+1]||E.last(this.waypoints),value:r.terrainFactor})),this._cache.terrainFactors}get terrainTypes(){if(this._cache.terrainTypes)return this._cache.terrainTypes;be("regenerating terrainTypes");const i=this.waypoints.filter((r,o)=>{var l;return!E.isNil(r.terrainType)&&r.terrainType!==((l=this.waypoints[o-1])==null?void 0:l.terrainType)});return this._cache.terrainTypes=i.map((r,o)=>new k0({startWaypoint:r,endWaypoint:i[o+1]||E.last(this.waypoints),value:r.terrainType})),this._cache.terrainTypes}get cutoffs(){return this._cache.cutoffs?this._cache.cutoffs:(this._cache.cutoffs=this.waypoints.filter(i=>i.cutoff).map(i=>new L0({waypoint:i})),this._cache.cutoffs)}get splits(){return this._cache.splits||(this._cache.splits=new I0({course:this})),this._cache.splits}get stats(){if(this._cache.stats)return this._cache.stats;be("stats:calculate");const i=this.track.points.map(p=>p.alt),r=this.track.points.map(p=>p.grade),o=this.terrainFactors.map(p=>p.value/100+1),l={altitude:{avg:E.sum(this.track.points.map((p,_)=>{var w;return p.alt*(p.loc-(((w=this.track.points[_-1])==null?void 0:w.loc)||0))}))/this.track.dist,max:E.max(i),min:E.min(i)},grade:{avg:(E.last(this.track.points).alt-this.track.points[0].alt)/this.track.dist/10,max:E.max(r),min:E.min(r)},terrain:{avg:(E.sumBy(this.terrainFactors,p=>(p.end-p.start)*p.value)/this.dist+100)/100,max:E.max(o),min:E.min(o)}},d=p=>this.terrainFactors.reduce((_,w)=>w.value/100+1===p?_+w.end-w.start:_,0);return Object.assign(l.terrain,{maxDist:d(l.terrain.max),minDist:d(l.terrain.min)}),this._cache.stats=l,l}set stats(i){this._cache.stats=i}set eventStart(i){i?this._data.eventStart=new Date(i):delete this._data.eventStart,delete this._cache.event}get eventStart(){return this._data.eventStart}set eventTimezone(i){i?this._data.eventTimezone=i:delete this._data.eventTimezone,delete this._cache.event}get eventTimezone(){return this._data.eventTimezone}get event(){var o;if(this._cache.event)return this._cache.event;const i=this.eventStart||void 0,r=this.eventTimezone||void 0;return this._cache.event=i&&r&&((o=this.track)!=null&&o.start)?new vu({...this.track.start,start:i,timezone:r}):void 0,this._cache.event}}class L0{constructor(i){Object.assign(this,i)}get loc(){return this.waypoint.loc}get time(){return this.waypoint.cutoff}}class R0{constructor(i){i=E.defaults(i,{value:0}),Object.assign(this,i)}get start(){return this.startWaypoint.loc}get end(){return this.endWaypoint.loc}}class k0{constructor(i){Object.assign(this,i)}get start(){return this.startWaypoint.loc}get end(){return this.endWaypoint.loc}}var zn={};(function(f){(function(){var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(_){return l(p(_),arguments)}function o(_,w){return r.apply(null,[_].concat(w||[]))}function l(_,w){var b=1,C=_.length,v,T="",D,N,I,O,$,j,X,nt;for(D=0;D<C;D++)if(typeof _[D]=="string")T+=_[D];else if(typeof _[D]=="object"){if(I=_[D],I.keys)for(v=w[b],N=0;N<I.keys.length;N++){if(v==null)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',I.keys[N],I.keys[N-1]));v=v[I.keys[N]]}else I.param_no?v=w[I.param_no]:v=w[b++];if(i.not_type.test(I.type)&&i.not_primitive.test(I.type)&&v instanceof Function&&(v=v()),i.numeric_arg.test(I.type)&&typeof v!="number"&&isNaN(v))throw new TypeError(r("[sprintf] expecting number but found %T",v));switch(i.number.test(I.type)&&(X=v>=0),I.type){case"b":v=parseInt(v,10).toString(2);break;case"c":v=String.fromCharCode(parseInt(v,10));break;case"d":case"i":v=parseInt(v,10);break;case"j":v=JSON.stringify(v,null,I.width?parseInt(I.width):0);break;case"e":v=I.precision?parseFloat(v).toExponential(I.precision):parseFloat(v).toExponential();break;case"f":v=I.precision?parseFloat(v).toFixed(I.precision):parseFloat(v);break;case"g":v=I.precision?String(Number(v.toPrecision(I.precision))):parseFloat(v);break;case"o":v=(parseInt(v,10)>>>0).toString(8);break;case"s":v=String(v),v=I.precision?v.substring(0,I.precision):v;break;case"t":v=String(!!v),v=I.precision?v.substring(0,I.precision):v;break;case"T":v=Object.prototype.toString.call(v).slice(8,-1).toLowerCase(),v=I.precision?v.substring(0,I.precision):v;break;case"u":v=parseInt(v,10)>>>0;break;case"v":v=v.valueOf(),v=I.precision?v.substring(0,I.precision):v;break;case"x":v=(parseInt(v,10)>>>0).toString(16);break;case"X":v=(parseInt(v,10)>>>0).toString(16).toUpperCase();break}i.json.test(I.type)?T+=v:(i.number.test(I.type)&&(!X||I.sign)?(nt=X?"+":"-",v=v.toString().replace(i.sign,"")):nt="",$=I.pad_char?I.pad_char==="0"?"0":I.pad_char.charAt(1):" ",j=I.width-(nt+v).length,O=I.width&&j>0?$.repeat(j):"",T+=I.align?nt+v+O:$==="0"?nt+O+v:O+nt+v)}return T}var d=Object.create(null);function p(_){if(d[_])return d[_];for(var w=_,b,C=[],v=0;w;){if((b=i.text.exec(w))!==null)C.push(b[0]);else if((b=i.modulo.exec(w))!==null)C.push("%");else if((b=i.placeholder.exec(w))!==null){if(b[2]){v|=1;var T=[],D=b[2],N=[];if((N=i.key.exec(D))!==null)for(T.push(N[1]);(D=D.substring(N[0].length))!=="";)if((N=i.key_access.exec(D))!==null)T.push(N[1]);else if((N=i.index_access.exec(D))!==null)T.push(N[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=T}else v|=2;if(v===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");C.push({placeholder:b[0],param_no:b[1],keys:b[2],sign:b[3],pad_char:b[4],align:b[5],width:b[6],precision:b[7],type:b[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");w=w.substring(b[0].length)}return d[_]=C}f.sprintf=r,f.vsprintf=o,typeof window<"u"&&(window.sprintf=r,window.vsprintf=o)})()})(zn);class wu{constructor(i,r){this._target=i,this._callbacks=E.fromPairs(r.map(o=>[o,[]]))}add(i,r){if(!this._callbacks[i])throw new Error(`${i} is not a valid callback for object`);this._callbacks[i].find(o=>o===r)?console.warn("callback already exists."):this._callbacks[i].push(r)}remove(i,r){if(!this._callbacks[i])throw new Error(`${i} is not a valid callback for object`);E.pull(this._callbacks[i],r)}clear(i){(i?[i]:Object.keys(this._callbacks)).forEach(o=>this._callbacks[o]=[])}execute(i){this._callbacks[i].forEach(r=>r(this._target))}}const D0=Ke("PaceChunk");class au{constructor(i={}){nu(this,"l");if(!E.has(i,"points"))throw new Error('"points" required.');if(!E.has(i,"constraints"))throw new Error('"constraints" required.');Object.assign(this,i)}set elapsed(i){this.constraints.elapsed=i}get elapsed(){return(E.isFunction(this.constraints[1])?this.constraints[1]():this.constraints[1])-this.constraints[0]}get dist(){return E.last(this.points).loc-E.first(this.points).loc}get pace(){return(this.elapsed-this.delay)/this.dist}get np(){return this.pace/this.factor}get moving(){return this.elapsed-this.delay}applyPacing(){delete this.plan.pacing._cache.factor;const i=this.points;i[0].elapsed=this.constraints[0],i[0].time=i[0].elapsed-E.sum(this.plan.pacing.chunks.filter(b=>b.points[0].loc<i[0].loc).map(b=>b.delay)),this.plan.event.start&&(i[0].tod=this.plan.event.elapsedToTimeOfDay(i[0].elapsed));let r=i[0].elapsed,o=i[0].delay||0,l=0,d=0,p=0;const _=this.factor?this.np:this.plan.pacing.pace,w=Object.fromEntries(Me.map(b=>[b,0]));for(let b=1,C=i.length;b<C;b++){l=i[b].loc-i[b-1].loc,_s(i[b-1],{plan:this.plan}),Me.forEach(T=>{w[T]+=i[b-1].factors[T]*l});const v=i[b-1].factors.combined;p+=v*l,d=_*v*l,i[b].time=i[b-1].time+d,o=i[b-1].delay||0,r+=d+o,i[b].elapsed=r,this.plan.event.start&&(i[b].tod=this.plan.event.elapsedToTimeOfDay(r))}_s(E.last(i),{plan:this.plan}),this.factors=new qn(Object.fromEntries(Me.map(b=>[b,w[b]/this.dist]))),this.factor=p/this.dist}calculate(){const o=D0.extend(zn.vsprintf("calculate:%.2f-%.2f",[E.first(this.points).loc,E.last(this.points).loc]));let l=this.factor||0,d;const p={};let _=!1;for(d=0;d<20&&(this.applyPacing(),p.iterations=d>=2,p.factor=!E.round(l-this.factor,10),l=this.factor,p.target=Math.abs((E.isFunction(this.constraints[1])?this.constraints[1]():this.constraints[1])-E.last(this.points).elapsed)<.1,o(zn.vsprintf("%i|%s",[d,Object.keys(p).map(w=>zn.vsprintf("%s=%s",[w,p[w]?"P":"F"])).join("|")])),_=!Object.keys(p).filter(w=>!p[w]).length,!_);d++);o("iteration complete"),this.status={tests:p,success:_,iterations:d+1}}}const Vt=Ke("Pacing");class N0{constructor(i={}){Object.defineProperty(this,"_cache",{value:{}}),this.callbacks=new wu(this,["onUpdated","onFail","onInvalidated"]),Object.assign(this,i)}get __class(){return"Pacing"}clearCache(){Vt("clearCache"),Object.keys(this._cache).forEach(i=>{delete this._cache[i]})}invalidate(){Vt("invalidate"),this.chunks=[],this.clearCache(),this.callbacks.execute("onInvalidated")}get elapsed(){return Vt("elapsed:get"),this._cache.elapsed?this._cache.elapsed:E.last(this.plan.points).elapsed}get pace(){return Vt("pace:get"),(this.elapsed-this.plan.delay)/this.plan.course.dist}get factor(){return this._cache.factor?this._cache.factor:(Vt("factor:update"),this.chunks&&(this._cache.factor=E.sum(this.chunks.map(i=>i.factor*i.dist))/this.plan.course.dist),this._cache.factor||1)}get factors(){if(Vt("factors:get"),!!this.chunks)return this._cache.factors?this._cache.factors:(Vt("factors:update"),new qn(Object.fromEntries(Me.map(i=>[i,E.sum(this.chunks.map(r=>r.factors[i]*r.dist))/this.plan.course.dist]))))}get np(){return Vt("np:get"),this.pace/this.factor}get moving(){return this.elapsed-this.plan.delay}get status(){var i,r,o;return{complete:((i=this.chunks)==null?void 0:i.length)>0,success:((r=this.chunks)==null?void 0:r.filter(l=>{var d;return!((d=l.status)!=null&&d.success)}).length)===0,chunks:((o=this.chunks)==null?void 0:o.length)||0}}calculate(){var o,l,d;const i=Vt.extend("calculate");if(i("exec"),!((o=this.plan.points)!=null&&o.length))throw i("calculate: error; no points"),new rn("Plan points are not defined.","points");i("clearing cache"),this.clearCache(),i("adding points at each terrain factor break"),(l=this.plan.course.terrainFactors)==null||l.forEach(p=>this.plan.getPoint({loc:p.start,insert:!0})),i("adding points at each cutoff"),this.plan.adjustForCutoffs&&this.plan.cutoffs.forEach(p=>{p.point=this.plan.getPoint({loc:p.loc,insert:!0})}),this.plan.points.filter(p=>p.delay).forEach(p=>{delete p.delay}),(d=this.plan.delays)==null||d.forEach(p=>{const _=this.plan.getPoint({loc:p.loc,insert:!0});_.delay=p.delay}),i("creating pace chunks"),this.initChunks();const r=E.reverse([...this.plan.cutoffs]);r.unshift(null),r.push(null),r.forEach(p=>{for(;this.chunks.find(_=>!_.status);)this.calcChunks(),this.validateChunks();if(!p)return!0;if(p.point.elapsed-p.time>.5){i(`cutoff at ${p.loc} missed`);const _=this.chunks[0];E.last(_.points)===p.point?(i(`setting cutoff at ${p.loc}`),_.constraints=[0,p.time],delete _.status):this.splitChunk(_,{point:p.point,elapsed:p.time})}}),E.isFunction(E.last(this.chunks).constraints[1])&&this.chunks.length>2&&(i("rerunning last chunk"),E.last(this.chunks).calculate()),Vt(`pacing status=${this.status.success?"PASS":"FAIL"}.`),this.status.success?this.callbacks.execute("onUpdated"):this.callbacks.execute("onFail")}initChunks(){let i;switch(this.plan.pacingMethod){case"time":i=this.plan.pacingTarget;break;case"pace":i=this.plan.pacingTarget*this.plan.course.dist+this.plan.delay;break;case"np":i=()=>this.plan.pacingTarget*(this.factor||1)*this.plan.course.dist+this.plan.delay;break;default:throw new Error(`Incorrect pacing method ${this.plan.pacingMethod}`)}this.chunks=[new au({plan:this.plan,points:this.plan.points,constraints:[0,i],delay:this.plan.delay})],this.plan.points.forEach(r=>{r._chunk=this.chunks[0]})}calcChunks(){Vt("calcChunks"),this.clearCache(),this.chunks.filter(i=>!i.status).forEach(i=>i.calculate())}validateChunks(){let i=1;for(;i<=this.chunks.length-1;)this.chunks[i].np<this.chunks[i-1].np?this.mergeChunks(this.chunks[i-1],this.chunks[i]):i++}splitChunk(i,{point:r,elapsed:o}){Vt.extend("split")(`breaking chunks at ${r.loc} km`);const d=i.points.findIndex(w=>w===r),p=E.round(r.elapsed-r.time),_=new au({plan:this.plan,points:i.points.slice(0,d+1),constraints:[0,o],delay:p});_.points.filter((w,b)=>b<_.points.length-1).forEach(w=>{w._chunk=_}),this.chunks.unshift(_),i.constraints[0]=o,i.delay-=p,i.points=i.points.slice(d),delete i.status}mergeChunks(i,r){const o=this.chunks.findIndex(d=>d===i),l=this.chunks.findIndex(d=>d===r);if(l-o!==1)throw new Error("chunks must be sequential");Vt(zn.sprintf("calcChunks: merging %i&%i (%.2f&%.2f)",o,l,i.np,r.np)),i.points.pop(),i.points.push(...r.points),i.delay+=r.delay,delete i.status,i.points.forEach(d=>{d._chunk=i}),i.constraints=[i.constraints[0],r.constraints[1]],this.chunks.splice(l,1)}}const W0=["lat","lon","alt","latlon","grade","loc","actual"];class ou{constructor(i,r){Object.defineProperty(this,"_plan",{value:i}),Object.defineProperty(this,"_point",{value:r}),Object.defineProperty(this,"_chunk",{writable:!0,enumerable:!1}),W0.forEach(o=>{Object.defineProperty(this,o,{get(){return this._point[o]}})})}get __class(){return"PlanPoint"}get np(){return this._chunk.np}get factor(){var i;return(i=this.factors)==null?void 0:i.combined}get pace(){const{np:i,factor:r}=this;if(r&&i)return r*i}}const St=Ke("models:Plan"),Ge=(f,i)=>v0(f.site,i.site)&&f.loop===i.loop;class B0{constructor(i){Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,i)}get __class(){return"PlanSplits"}get segments(){var i;return(i=this._cache.segments)!=null&&i.length||(St("calculating segments"),this.plan.checkPacing(),this._cache.segments=gu({plan:this.plan})),this._cache.segments}set segments(i){this._cache.segments=i}get miles(){var i;return(i=this._cache.miles)!=null&&i.length||(St("calculating miles"),this.plan.checkPacing(),this._cache.miles=Ur({unit:"miles",plan:this.plan})),this._cache.miles}set miles(i){this._cache.miles=i}get kilometers(){var i;return(i=this._cache.kilometers)!=null&&i.length||(St("calculating kilometers"),this.plan.checkPacing(),this._cache.kilometers=Ur({unit:"kilometers",plan:this.plan})),this._cache.kilometers}set kilometers(i){this._cache.kilometers=i}}class U0{constructor(i){if(Object.defineProperty(this,"pacing",{writable:!1,value:new N0({plan:this})}),Object.defineProperty(this,"_data",{value:{adjustForCutoffs:!0,delays:[],notes:[]},enumerable:!1}),Object.defineProperty(this,"_cache",{value:{},writable:!0}),i.course)Object.defineProperty(this,"course",{writable:!1,value:i.course});else throw new Error("Course required");const r=["course","_data","cache"];Object.keys(i).forEach(o=>{r.includes(o)||(this[o]=i[o])}),Object.defineProperty(this,"callbacks",{writable:!1,value:new wu(this,["onUpdated"])})}get __class(){return"Plan"}clearCache(){St("clearCache"),this._cache={}}set eventStart(i){i?this._data.eventStart=new Date(i):delete this._data.eventStart,delete this._cache.event}get eventStart(){return this._data.eventStart}set eventTimezone(i){i?this._data.eventTimezone=i:delete this._data.eventTimezone,delete this._cache.event}get eventTimezone(){return this._data.eventTimezone}get event(){if(this._cache.event)return this._cache.event;let i=this.eventStart||this.course.eventStart;i||(console.warn("eventStart not defined in either plan or course, defaulting to zero."),i=new Date(0));let r=this.eventTimezone||this.course.eventTimezone;return r||(console.warn("eventTimezone not defined in either plan or course, defaulting to UTC."),r="UTC"),this._cache.event=new vu({...this.course.track.start,start:i,timezone:r}),this._cache.event}get adjustForCutoffs(){return this._data.adjustForCutoffs}set adjustForCutoffs(i){St("set:adjustForCutoffs"),this._data.adjustForCutoffs=i,delete this._cache.cutoffs}get cutoffs(){if(this._cache.cutoffs)return this._cache.cutoffs;this._cache.cutoffs=this.adjustForCutoffs?this.course.cutoffs.map(r=>new z0({courseCutoff:r,plan:this,point:this.getPoint({loc:r.loc,insert:!0})})):[];let i=0;for(;this._cache.cutoffs.length-1>=i;){const r=this._cache.cutoffs[i];this._cache.cutoffs.find((o,l)=>l>i&&o.time<=r.time)?(St(`get cutoffs: deleting extraneous cutoff at ${r.loc} km`),this._cache.cutoffs.splice(i,1)):i++}return this._cache.cutoffs}get strategy(){return this._cache.strategy?this._cache.strategy:(this._cache.strategy=new du({values:this._data.strategy,length:this.course.dist}),this._cache.strategy)}set strategy(i){delete this._cache.strategy,E.isNil(i)?this._data.strategy=void 0:Array.isArray(i)&&i.length&&i.length===i.filter(r=>E.isNumber(r.onset)&&E.isNumber(r.value)&&E.isString(r.type)).length?this._data.strategy=i:(this._data.strategy=void 0,St('Plan "strategy" invalid.'))}get heatModel(){return this._cache.heatModel!==void 0?this._cache.heatModel:(this._data.heatModel?this._cache.heatModel=Object.assign({start:this.event.sun.sunrise+1800,stop:this.event.sun.sunset+7200},E.pick(this._data.heatModel,["baseline","max"])):this._cache.heatModel=null,this._cache.heatModel)}set heatModel(i){this._data.heatModel=i}get totalDelay(){return this.delays.reduce((i,r)=>i+r.delay,0)}get delays(){if(this._cache.delays)return this._cache.delays;const i=this.course.waypoints.map(o=>{var p;const l=(p=this._data.delays)==null?void 0:p.find(_=>Ge(_.waypoint,o)),d=l?l.delay:o.hasTypicalDelay?this.waypointDelay:0;return new $0({waypoint:o,delay:d})}).filter(o=>o.delay>0).sort((o,l)=>o.loc-l.loc);let r=0;for(;i.length-1>=r;)r>0&&i[r].loc===i[r-1].loc?(St(`get delays: merging delay at ${i[r].loc} km`),i[r-1].delay+=i[r].delay,i.splice(r,1)):r++;return this._cache.delays=i,this._cache.delays}set delays(i){if(E.isUndefined(i))i=[];else if(!E.isArray(i))throw new Error('"delays" must be an array');this._data.delays=i,delete this._cache.delays}get delay(){return this.totalDelay}get notes(){return this._cache.notes?this._cache.notes:(this._cache.notes=this._data.notes.map(i=>({waypoint:this.course.waypoints.find(r=>Ge(i.waypoint,r)),text:i.text})),this._cache.notes)}set notes(i){if(E.isUndefined(i))i=[];else if(!E.isArray(i))throw new Error('"notes" must be an array');this._data.notes=i,delete this._cache.notes}get splits(){return this._cache.splits||(St("creating splits"),this._cache.splits=new B0({plan:this})),this._cache.splits}getDelayAtWaypoint(i){var r;return((r=this.delays.find(o=>Ge(o.waypoint,i)))==null?void 0:r.delay)||0}getTypicalDelayAtWaypoint(i){return i.hasTypicalDelay?this.waypointDelay:0}getNoteAtWaypoint(i){var r;return((r=this.notes.find(o=>Ge(o.waypoint,i)))==null?void 0:r.text)||""}getPoint({loc:i,insert:r=!1}){const o=this.points.findIndex(w=>zr(w.loc,i,4)),l=this.points[o];if(He(l.loc,i,4))return l;St(`getPoint: ${r?"inserting":"creating"} new PlanPoint at ${i}`);const d=o-1,p=this.points[d],_=new ou(this,this.course.getPoint({loc:i,insert:r}));if(!isNaN(p.time)&&!isNaN(l.time)){const w=l.elapsed-l.time-(p.elapsed-p.time);_.time=nn(p.loc,l.loc,p.time+w,l.time,l.loc),_.elapsed=l.elapsed-(l.time-_.time),this.event.start&&(_.tod=this.event.elapsedToTimeOfDay(_.elapsed))}return r&&this.points.splice(o,0,_),_}get points(){var i,r;if(!this._cache.points){if(St("creating points array"),!((r=(i=this.course)==null?void 0:i.points)!=null&&r.length))throw St("cannot create points array; course points are not defined."),new rn("Course points are not defined.","points");this._cache.points=this.course.points.map(o=>new ou(this,o))}return this._cache.points}get events(){if(this._cache.events)return this._cache.events;St("calculating events.sun");const i=[],r=["dawn","sunrise","sunset","dusk"],o=this.event.elapsedToTimeOfDay(0),l=Math.ceil((o+E.last(this.points).elapsed)/86400);for(let d=0;d<l;d++)r.forEach(p=>{const _=this.event.sun[p]-o+86400*d;_>=0&&_<=E.last(this.points).elapsed&&i.push({event:p,elapsed:_})});return i.sort((d,p)=>d.elapsed-p.elapsed),i.length&&uu(this.points.map(p=>p.elapsed),this.points.map(p=>p.loc),i.map(p=>p.elapsed)).forEach((p,_)=>{i[_].loc=p}),this._cache.events={sun:i},this._cache.events}get stats(){if(this._cache.stats)return this._cache.stats;St("calculating stats.factors");const i=Object.fromEntries(Me.map(d=>{const p=this.points.map(_=>_.factors[d]);return[d,{min:E.min(p),max:E.max(p)}]}));St("calculating stats.sun");const r={day:{time:0,dist:0},twilight:{time:0,dist:0},dark:{time:0,dist:0}};let o=0,l=0;return this.points.forEach((d,p)=>{var _,w;o=d.loc-(((_=this.points[p-1])==null?void 0:_.loc)||0),l=d.elapsed-(((w=this.points[p-1])==null?void 0:w.elapsed)||0),!isNaN(this.event.sun.dawn)&&!isNaN(this.event.sun.dusk)&&(d.tod<=this.event.sun.dawn||d.tod>=this.event.sun.dusk)?(r.dark.time+=l,r.dark.dist+=o):d.tod<this.event.sun.sunrise||d.tod>this.event.sun.sunset?(r.twilight.time+=l,r.twilight.dist+=o):(r.day.time+=l,r.day.dist+=o)}),this._cache.stats={factors:i,sun:r},this._cache.stats}update(i){const r=St.extend("update");r(`fields: ${Object.keys(i).join(", ")}`),E.forOwn(i,(o,l)=>{switch(l){case"_id":case"name":case"description":this[l]=o;break;case"delays":{this._data.delays=o,delete this._cache.delays,this.invalidatePacing();break}case"delay":{let{delay:d,waypoint:p}=o;if(p=this.course.waypoints.find(w=>Ge(w,p)),!p)throw new Error("unknown waypoint");const _=this._data.delays.findIndex(w=>Ge(w.waypoint,p));d!==this.getTypicalDelayAtWaypoint(p)?_>=0?this._data.delays[_]={waypoint:p,delay:d}:this._data.delays.push({waypoint:p,delay:d}):_>=0&&this._data.delays.splice(_,1),delete this._cache.cutoffs,delete this._cache.delays,this.invalidatePacing();break}case"note":{let{text:d,waypoint:p}=o;if(p=this.course.waypoints.find(w=>Ge(w,p)),!p)throw new Error("unknown waypoint");const _=this._data.notes.findIndex(w=>Ge(w.waypoint,p));d?_>=0?this._data.notes[_]={waypoint:p,text:d}:this._data.notes.push({waypoint:p,text:d}):_>=0&&this._data.notes.splice(_,1),delete this._cache.notes;break}default:this[l]=o,r("clearCache, invalidatePacing"),this.clearCache(),this.invalidatePacing()}}),this.callbacks.execute("onUpdated")}invalidatePacing(){St("invalidatePacing"),this.pacing.invalidate(),delete this._cache.splits}checkPacing(){var i,r;if(St("checkPacing"),(i=this.pacing.status)!=null&&i.complete||(St("checkPacing: calculate"),this.pacing.calculate()),!((r=this.points)!=null&&r.length))throw new Error("No plan points");return!0}}class $0{constructor(i){Object.assign(this,i)}get loc(){return this.waypoint.loc}}class z0{constructor(i){Object.assign(this,i)}get waypoint(){return this.courseCutoff.waypoint}get loc(){return this.courseCutoff.loc}get time(){return this.courseCutoff.time-Math.max(this.plan.cutoffMargin||0,this.plan.getDelayAtWaypoint(this.waypoint))}}class q0 extends Ms{constructor(i=[]){super({}),this.segments=i}get first(){return this.segments[0]}get last(){return E.last(this.segments)}sum(i){if(!this.segments.find(r=>!E.isNumber(r[i])))return E.sumBy(this.segments,i)}get start(){return this.segments[0].start}get end(){return this.last.end}get len(){return this.sum("len")}get gain(){return this.sum("gain")}get loss(){return this.sum("loss")}set grade(i){this._data.grade=i}get grade(){return E.isNumber(this._data.grade)||(this._data.grade=this.segments.reduce((i,r)=>i+r.grade*r.len,0)/this.len),this._data.grade}get name(){return this.last.name}get time(){return this.sum("time")}get elapsed(){return this.last.elapsed}get actualElapsed(){return this.last.actualElapsed}get actualTime(){return this.sum("actualTime")}get tod(){return this.last.tod}get waypoint(){return this.last.waypoint}get factors(){const i={combined:1};return Me.forEach(r=>{const o=this.segments.reduce((l,d)=>l+d.len*d.factors[r],0);isNaN(o)||(i[r]=o/this.len),i.combined*=i[r]}),i}get status(){return this.last.status}get point1(){return this.first.point1}get point2(){return this.last.point2}}exports.Course=F0;exports.Factors=qn;exports.Plan=U0;exports.Point=xs;exports.Segment=Ms;exports.Site=Nr;exports.Strategy=du;exports.SuperSegment=q0;exports.Track=qr;exports.Waypoint=ws;exports.addLocations=yu;exports.adjustStrategy=pu;exports.calcSegments=Ss;exports.dateToTODSeconds=ms;exports.factorList=Me;exports.getHeatFactor=hu;exports.interpolatePoint=$r;exports.math=c0;exports.scaleDark=fu;
