"use strict";var h0=Object.defineProperty;var p0=(f,r,i)=>r in f?h0(f,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[r]=i;var cu=(f,r,i)=>p0(f,typeof r!="symbol"?r+"":r,i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var kr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ps(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Un={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var d0=Un.exports,lu;function g0(){return lu||(lu=1,function(f,r){(function(){var i,a="4.17.21",l=200,d="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",_="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,A="__lodash_placeholder__",v=1,P=2,R=4,D=1,E=2,O=1,W=2,Z=4,Y=8,it=16,dt=32,Wt=64,Mt=128,te=256,Ht=512,Ot=30,bn="...",zn=800,Hr=16,Mn=1,Gn=2,Kr=3,Ce=1/0,ge=9007199254740991,Hn=17976931348623157e292,xe=NaN,L=4294967295,q=L-1,z=L>>>1,lt=[["ary",Mt],["bind",O],["bindKey",W],["curry",Y],["curryRight",it],["flip",Ht],["partial",dt],["partialRight",Wt],["rearg",te]],tt="[object Arguments]",ft="[object Array]",at="[object AsyncFunction]",ut="[object Boolean]",wt="[object Date]",Kt="[object DOMException]",Ft="[object Error]",Bt="[object Function]",_e="[object GeneratorFunction]",_t="[object Map]",Rt="[object Number]",Le="[object Null]",bt="[object Object]",Ut="[object Promise]",le="[object Proxy]",ee="[object RegExp]",ht="[object Set]",ve="[object String]",Kn="[object Symbol]",Eu="[object Undefined]",Cn="[object WeakMap]",Ou="[object WeakSet]",xn="[object ArrayBuffer]",sn="[object DataView]",Jr="[object Float32Array]",Zr="[object Float64Array]",Yr="[object Int8Array]",jr="[object Int16Array]",Xr="[object Int32Array]",Qr="[object Uint8Array]",Vr="[object Uint8ClampedArray]",ti="[object Uint16Array]",ei="[object Uint32Array]",Fu=/\b__p \+= '';/g,Ru=/\b(__p \+=) '' \+/g,Lu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Rs=/&(?:amp|lt|gt|quot|#39);/g,Ls=/[&<>"']/g,ku=RegExp(Rs.source),Du=RegExp(Ls.source),Nu=/<%-([\s\S]+?)%>/g,Wu=/<%([\s\S]+?)%>/g,ks=/<%=([\s\S]+?)%>/g,Bu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Uu=/^\w*$/,$u=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ni=/[\\^$.*+?()[\]{}|]/g,qu=RegExp(ni.source),ri=/^\s+/,zu=/\s/,Gu=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Hu=/\{\n\/\* \[wrapped with (.+)\] \*/,Ku=/,? & /,Ju=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zu=/[()=,{}\[\]\/\s]/,Yu=/\\(\\)?/g,ju=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ds=/\w*$/,Xu=/^[-+]0x[0-9a-f]+$/i,Qu=/^0b[01]+$/i,Vu=/^\[object .+?Constructor\]$/,tc=/^0o[0-7]+$/i,ec=/^(?:0|[1-9]\d*)$/,nc=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Jn=/($^)/,rc=/['\n\r\u2028\u2029\\]/g,Zn="\\ud800-\\udfff",ic="\\u0300-\\u036f",sc="\\ufe20-\\ufe2f",ac="\\u20d0-\\u20ff",Ns=ic+sc+ac,Ws="\\u2700-\\u27bf",Bs="a-z\\xdf-\\xf6\\xf8-\\xff",oc="\\xac\\xb1\\xd7\\xf7",uc="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",cc="\\u2000-\\u206f",lc=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Us="A-Z\\xc0-\\xd6\\xd8-\\xde",$s="\\ufe0e\\ufe0f",qs=oc+uc+cc+lc,ii="['’]",fc="["+Zn+"]",zs="["+qs+"]",Yn="["+Ns+"]",Gs="\\d+",hc="["+Ws+"]",Hs="["+Bs+"]",Ks="[^"+Zn+qs+Gs+Ws+Bs+Us+"]",si="\\ud83c[\\udffb-\\udfff]",pc="(?:"+Yn+"|"+si+")",Js="[^"+Zn+"]",ai="(?:\\ud83c[\\udde6-\\uddff]){2}",oi="[\\ud800-\\udbff][\\udc00-\\udfff]",an="["+Us+"]",Zs="\\u200d",Ys="(?:"+Hs+"|"+Ks+")",dc="(?:"+an+"|"+Ks+")",js="(?:"+ii+"(?:d|ll|m|re|s|t|ve))?",Xs="(?:"+ii+"(?:D|LL|M|RE|S|T|VE))?",Qs=pc+"?",Vs="["+$s+"]?",gc="(?:"+Zs+"(?:"+[Js,ai,oi].join("|")+")"+Vs+Qs+")*",_c="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ta=Vs+Qs+gc,mc="(?:"+[hc,ai,oi].join("|")+")"+ta,yc="(?:"+[Js+Yn+"?",Yn,ai,oi,fc].join("|")+")",wc=RegExp(ii,"g"),bc=RegExp(Yn,"g"),ui=RegExp(si+"(?="+si+")|"+yc+ta,"g"),Mc=RegExp([an+"?"+Hs+"+"+js+"(?="+[zs,an,"$"].join("|")+")",dc+"+"+Xs+"(?="+[zs,an+Ys,"$"].join("|")+")",an+"?"+Ys+"+"+js,an+"+"+Xs,vc,_c,Gs,mc].join("|"),"g"),Cc=RegExp("["+Zs+Zn+Ns+$s+"]"),xc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Sc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ac=-1,ct={};ct[Jr]=ct[Zr]=ct[Yr]=ct[jr]=ct[Xr]=ct[Qr]=ct[Vr]=ct[ti]=ct[ei]=!0,ct[tt]=ct[ft]=ct[xn]=ct[ut]=ct[sn]=ct[wt]=ct[Ft]=ct[Bt]=ct[_t]=ct[Rt]=ct[bt]=ct[ee]=ct[ht]=ct[ve]=ct[Cn]=!1;var ot={};ot[tt]=ot[ft]=ot[xn]=ot[sn]=ot[ut]=ot[wt]=ot[Jr]=ot[Zr]=ot[Yr]=ot[jr]=ot[Xr]=ot[_t]=ot[Rt]=ot[bt]=ot[ee]=ot[ht]=ot[ve]=ot[Kn]=ot[Qr]=ot[Vr]=ot[ti]=ot[ei]=!0,ot[Ft]=ot[Bt]=ot[Cn]=!1;var Pc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Tc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ic={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ec={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Oc=parseFloat,Fc=parseInt,ea=typeof kr=="object"&&kr&&kr.Object===Object&&kr,Rc=typeof self=="object"&&self&&self.Object===Object&&self,Pt=ea||Rc||Function("return this")(),ci=r&&!r.nodeType&&r,Je=ci&&!0&&f&&!f.nodeType&&f,na=Je&&Je.exports===ci,li=na&&ea.process,ne=function(){try{var m=Je&&Je.require&&Je.require("util").types;return m||li&&li.binding&&li.binding("util")}catch{}}(),ra=ne&&ne.isArrayBuffer,ia=ne&&ne.isDate,sa=ne&&ne.isMap,aa=ne&&ne.isRegExp,oa=ne&&ne.isSet,ua=ne&&ne.isTypedArray;function Jt(m,C,M){switch(M.length){case 0:return m.call(C);case 1:return m.call(C,M[0]);case 2:return m.call(C,M[0],M[1]);case 3:return m.call(C,M[0],M[1],M[2])}return m.apply(C,M)}function Lc(m,C,M,k){for(var G=-1,et=m==null?0:m.length;++G<et;){var Ct=m[G];C(k,Ct,M(Ct),m)}return k}function re(m,C){for(var M=-1,k=m==null?0:m.length;++M<k&&C(m[M],M,m)!==!1;);return m}function kc(m,C){for(var M=m==null?0:m.length;M--&&C(m[M],M,m)!==!1;);return m}function ca(m,C){for(var M=-1,k=m==null?0:m.length;++M<k;)if(!C(m[M],M,m))return!1;return!0}function ke(m,C){for(var M=-1,k=m==null?0:m.length,G=0,et=[];++M<k;){var Ct=m[M];C(Ct,M,m)&&(et[G++]=Ct)}return et}function jn(m,C){var M=m==null?0:m.length;return!!M&&on(m,C,0)>-1}function fi(m,C,M){for(var k=-1,G=m==null?0:m.length;++k<G;)if(M(C,m[k]))return!0;return!1}function pt(m,C){for(var M=-1,k=m==null?0:m.length,G=Array(k);++M<k;)G[M]=C(m[M],M,m);return G}function De(m,C){for(var M=-1,k=C.length,G=m.length;++M<k;)m[G+M]=C[M];return m}function hi(m,C,M,k){var G=-1,et=m==null?0:m.length;for(k&&et&&(M=m[++G]);++G<et;)M=C(M,m[G],G,m);return M}function Dc(m,C,M,k){var G=m==null?0:m.length;for(k&&G&&(M=m[--G]);G--;)M=C(M,m[G],G,m);return M}function pi(m,C){for(var M=-1,k=m==null?0:m.length;++M<k;)if(C(m[M],M,m))return!0;return!1}var Nc=di("length");function Wc(m){return m.split("")}function Bc(m){return m.match(Ju)||[]}function la(m,C,M){var k;return M(m,function(G,et,Ct){if(C(G,et,Ct))return k=et,!1}),k}function Xn(m,C,M,k){for(var G=m.length,et=M+(k?1:-1);k?et--:++et<G;)if(C(m[et],et,m))return et;return-1}function on(m,C,M){return C===C?Xc(m,C,M):Xn(m,fa,M)}function Uc(m,C,M,k){for(var G=M-1,et=m.length;++G<et;)if(k(m[G],C))return G;return-1}function fa(m){return m!==m}function ha(m,C){var M=m==null?0:m.length;return M?_i(m,C)/M:xe}function di(m){return function(C){return C==null?i:C[m]}}function gi(m){return function(C){return m==null?i:m[C]}}function pa(m,C,M,k,G){return G(m,function(et,Ct,st){M=k?(k=!1,et):C(M,et,Ct,st)}),M}function $c(m,C){var M=m.length;for(m.sort(C);M--;)m[M]=m[M].value;return m}function _i(m,C){for(var M,k=-1,G=m.length;++k<G;){var et=C(m[k]);et!==i&&(M=M===i?et:M+et)}return M}function vi(m,C){for(var M=-1,k=Array(m);++M<m;)k[M]=C(M);return k}function qc(m,C){return pt(C,function(M){return[M,m[M]]})}function da(m){return m&&m.slice(0,ma(m)+1).replace(ri,"")}function Zt(m){return function(C){return m(C)}}function mi(m,C){return pt(C,function(M){return m[M]})}function Sn(m,C){return m.has(C)}function ga(m,C){for(var M=-1,k=m.length;++M<k&&on(C,m[M],0)>-1;);return M}function _a(m,C){for(var M=m.length;M--&&on(C,m[M],0)>-1;);return M}function zc(m,C){for(var M=m.length,k=0;M--;)m[M]===C&&++k;return k}var Gc=gi(Pc),Hc=gi(Tc);function Kc(m){return"\\"+Ec[m]}function Jc(m,C){return m==null?i:m[C]}function un(m){return Cc.test(m)}function Zc(m){return xc.test(m)}function Yc(m){for(var C,M=[];!(C=m.next()).done;)M.push(C.value);return M}function yi(m){var C=-1,M=Array(m.size);return m.forEach(function(k,G){M[++C]=[G,k]}),M}function va(m,C){return function(M){return m(C(M))}}function Ne(m,C){for(var M=-1,k=m.length,G=0,et=[];++M<k;){var Ct=m[M];(Ct===C||Ct===A)&&(m[M]=A,et[G++]=M)}return et}function Qn(m){var C=-1,M=Array(m.size);return m.forEach(function(k){M[++C]=k}),M}function jc(m){var C=-1,M=Array(m.size);return m.forEach(function(k){M[++C]=[k,k]}),M}function Xc(m,C,M){for(var k=M-1,G=m.length;++k<G;)if(m[k]===C)return k;return-1}function Qc(m,C,M){for(var k=M+1;k--;)if(m[k]===C)return k;return k}function cn(m){return un(m)?tl(m):Nc(m)}function fe(m){return un(m)?el(m):Wc(m)}function ma(m){for(var C=m.length;C--&&zu.test(m.charAt(C)););return C}var Vc=gi(Ic);function tl(m){for(var C=ui.lastIndex=0;ui.test(m);)++C;return C}function el(m){return m.match(ui)||[]}function nl(m){return m.match(Mc)||[]}var rl=function m(C){C=C==null?Pt:ln.defaults(Pt.Object(),C,ln.pick(Pt,Sc));var M=C.Array,k=C.Date,G=C.Error,et=C.Function,Ct=C.Math,st=C.Object,wi=C.RegExp,il=C.String,ie=C.TypeError,Vn=M.prototype,sl=et.prototype,fn=st.prototype,tr=C["__core-js_shared__"],er=sl.toString,rt=fn.hasOwnProperty,al=0,ya=function(){var t=/[^.]+$/.exec(tr&&tr.keys&&tr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),nr=fn.toString,ol=er.call(st),ul=Pt._,cl=wi("^"+er.call(rt).replace(ni,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rr=na?C.Buffer:i,We=C.Symbol,ir=C.Uint8Array,wa=rr?rr.allocUnsafe:i,sr=va(st.getPrototypeOf,st),ba=st.create,Ma=fn.propertyIsEnumerable,ar=Vn.splice,Ca=We?We.isConcatSpreadable:i,An=We?We.iterator:i,Ze=We?We.toStringTag:i,or=function(){try{var t=Ve(st,"defineProperty");return t({},"",{}),t}catch{}}(),ll=C.clearTimeout!==Pt.clearTimeout&&C.clearTimeout,fl=k&&k.now!==Pt.Date.now&&k.now,hl=C.setTimeout!==Pt.setTimeout&&C.setTimeout,ur=Ct.ceil,cr=Ct.floor,bi=st.getOwnPropertySymbols,pl=rr?rr.isBuffer:i,xa=C.isFinite,dl=Vn.join,gl=va(st.keys,st),xt=Ct.max,It=Ct.min,_l=k.now,vl=C.parseInt,Sa=Ct.random,ml=Vn.reverse,Mi=Ve(C,"DataView"),Pn=Ve(C,"Map"),Ci=Ve(C,"Promise"),hn=Ve(C,"Set"),Tn=Ve(C,"WeakMap"),In=Ve(st,"create"),lr=Tn&&new Tn,pn={},yl=tn(Mi),wl=tn(Pn),bl=tn(Ci),Ml=tn(hn),Cl=tn(Tn),fr=We?We.prototype:i,En=fr?fr.valueOf:i,Aa=fr?fr.toString:i;function u(t){if(vt(t)&&!H(t)&&!(t instanceof Q)){if(t instanceof se)return t;if(rt.call(t,"__wrapped__"))return To(t)}return new se(t)}var dn=function(){function t(){}return function(e){if(!gt(e))return{};if(ba)return ba(e);t.prototype=e;var n=new t;return t.prototype=i,n}}();function hr(){}function se(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=i}u.templateSettings={escape:Nu,evaluate:Wu,interpolate:ks,variable:"",imports:{_:u}},u.prototype=hr.prototype,u.prototype.constructor=u,se.prototype=dn(hr.prototype),se.prototype.constructor=se;function Q(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=L,this.__views__=[]}function xl(){var t=new Q(this.__wrapped__);return t.__actions__=$t(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=$t(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=$t(this.__views__),t}function Sl(){if(this.__filtered__){var t=new Q(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Al(){var t=this.__wrapped__.value(),e=this.__dir__,n=H(t),s=e<0,o=n?t.length:0,c=Bf(0,o,this.__views__),p=c.start,g=c.end,y=g-p,x=s?g:p-1,S=this.__iteratees__,T=S.length,F=0,N=It(y,this.__takeCount__);if(!n||!s&&o==y&&N==y)return ja(t,this.__actions__);var U=[];t:for(;y--&&F<N;){x+=e;for(var J=-1,$=t[x];++J<T;){var X=S[J],V=X.iteratee,Xt=X.type,Dt=V($);if(Xt==Gn)$=Dt;else if(!Dt){if(Xt==Mn)continue t;break t}}U[F++]=$}return U}Q.prototype=dn(hr.prototype),Q.prototype.constructor=Q;function Ye(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Pl(){this.__data__=In?In(null):{},this.size=0}function Tl(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Il(t){var e=this.__data__;if(In){var n=e[t];return n===w?i:n}return rt.call(e,t)?e[t]:i}function El(t){var e=this.__data__;return In?e[t]!==i:rt.call(e,t)}function Ol(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=In&&e===i?w:e,this}Ye.prototype.clear=Pl,Ye.prototype.delete=Tl,Ye.prototype.get=Il,Ye.prototype.has=El,Ye.prototype.set=Ol;function Se(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Fl(){this.__data__=[],this.size=0}function Rl(t){var e=this.__data__,n=pr(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():ar.call(e,n,1),--this.size,!0}function Ll(t){var e=this.__data__,n=pr(e,t);return n<0?i:e[n][1]}function kl(t){return pr(this.__data__,t)>-1}function Dl(t,e){var n=this.__data__,s=pr(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}Se.prototype.clear=Fl,Se.prototype.delete=Rl,Se.prototype.get=Ll,Se.prototype.has=kl,Se.prototype.set=Dl;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Nl(){this.size=0,this.__data__={hash:new Ye,map:new(Pn||Se),string:new Ye}}function Wl(t){var e=Sr(this,t).delete(t);return this.size-=e?1:0,e}function Bl(t){return Sr(this,t).get(t)}function Ul(t){return Sr(this,t).has(t)}function $l(t,e){var n=Sr(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}Ae.prototype.clear=Nl,Ae.prototype.delete=Wl,Ae.prototype.get=Bl,Ae.prototype.has=Ul,Ae.prototype.set=$l;function je(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ae;++e<n;)this.add(t[e])}function ql(t){return this.__data__.set(t,w),this}function zl(t){return this.__data__.has(t)}je.prototype.add=je.prototype.push=ql,je.prototype.has=zl;function he(t){var e=this.__data__=new Se(t);this.size=e.size}function Gl(){this.__data__=new Se,this.size=0}function Hl(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Kl(t){return this.__data__.get(t)}function Jl(t){return this.__data__.has(t)}function Zl(t,e){var n=this.__data__;if(n instanceof Se){var s=n.__data__;if(!Pn||s.length<l-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ae(s)}return n.set(t,e),this.size=n.size,this}he.prototype.clear=Gl,he.prototype.delete=Hl,he.prototype.get=Kl,he.prototype.has=Jl,he.prototype.set=Zl;function Pa(t,e){var n=H(t),s=!n&&en(t),o=!n&&!s&&ze(t),c=!n&&!s&&!o&&mn(t),p=n||s||o||c,g=p?vi(t.length,il):[],y=g.length;for(var x in t)(e||rt.call(t,x))&&!(p&&(x=="length"||o&&(x=="offset"||x=="parent")||c&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||Ee(x,y)))&&g.push(x);return g}function Ta(t){var e=t.length;return e?t[Li(0,e-1)]:i}function Yl(t,e){return Ar($t(t),Xe(e,0,t.length))}function jl(t){return Ar($t(t))}function xi(t,e,n){(n!==i&&!pe(t[e],n)||n===i&&!(e in t))&&Pe(t,e,n)}function On(t,e,n){var s=t[e];(!(rt.call(t,e)&&pe(s,n))||n===i&&!(e in t))&&Pe(t,e,n)}function pr(t,e){for(var n=t.length;n--;)if(pe(t[n][0],e))return n;return-1}function Xl(t,e,n,s){return Be(t,function(o,c,p){e(s,o,n(o),p)}),s}function Ia(t,e){return t&&ye(e,At(e),t)}function Ql(t,e){return t&&ye(e,zt(e),t)}function Pe(t,e,n){e=="__proto__"&&or?or(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Si(t,e){for(var n=-1,s=e.length,o=M(s),c=t==null;++n<s;)o[n]=c?i:ss(t,e[n]);return o}function Xe(t,e,n){return t===t&&(n!==i&&(t=t<=n?t:n),e!==i&&(t=t>=e?t:e)),t}function ae(t,e,n,s,o,c){var p,g=e&v,y=e&P,x=e&R;if(n&&(p=o?n(t,s,o,c):n(t)),p!==i)return p;if(!gt(t))return t;var S=H(t);if(S){if(p=$f(t),!g)return $t(t,p)}else{var T=Et(t),F=T==Bt||T==_e;if(ze(t))return Va(t,g);if(T==bt||T==tt||F&&!o){if(p=y||F?{}:yo(t),!g)return y?Ef(t,Ql(p,t)):If(t,Ia(p,t))}else{if(!ot[T])return o?t:{};p=qf(t,T,g)}}c||(c=new he);var N=c.get(t);if(N)return N;c.set(t,p),Zo(t)?t.forEach(function($){p.add(ae($,e,n,$,t,c))}):Ko(t)&&t.forEach(function($,X){p.set(X,ae($,e,n,X,t,c))});var U=x?y?Hi:Gi:y?zt:At,J=S?i:U(t);return re(J||t,function($,X){J&&(X=$,$=t[X]),On(p,X,ae($,e,n,X,t,c))}),p}function Vl(t){var e=At(t);return function(n){return Ea(n,t,e)}}function Ea(t,e,n){var s=n.length;if(t==null)return!s;for(t=st(t);s--;){var o=n[s],c=e[o],p=t[o];if(p===i&&!(o in t)||!c(p))return!1}return!0}function Oa(t,e,n){if(typeof t!="function")throw new ie(h);return Wn(function(){t.apply(i,n)},e)}function Fn(t,e,n,s){var o=-1,c=jn,p=!0,g=t.length,y=[],x=e.length;if(!g)return y;n&&(e=pt(e,Zt(n))),s?(c=fi,p=!1):e.length>=l&&(c=Sn,p=!1,e=new je(e));t:for(;++o<g;){var S=t[o],T=n==null?S:n(S);if(S=s||S!==0?S:0,p&&T===T){for(var F=x;F--;)if(e[F]===T)continue t;y.push(S)}else c(e,T,s)||y.push(S)}return y}var Be=io(me),Fa=io(Pi,!0);function tf(t,e){var n=!0;return Be(t,function(s,o,c){return n=!!e(s,o,c),n}),n}function dr(t,e,n){for(var s=-1,o=t.length;++s<o;){var c=t[s],p=e(c);if(p!=null&&(g===i?p===p&&!jt(p):n(p,g)))var g=p,y=c}return y}function ef(t,e,n,s){var o=t.length;for(n=K(n),n<0&&(n=-n>o?0:o+n),s=s===i||s>o?o:K(s),s<0&&(s+=o),s=n>s?0:jo(s);n<s;)t[n++]=e;return t}function Ra(t,e){var n=[];return Be(t,function(s,o,c){e(s,o,c)&&n.push(s)}),n}function Tt(t,e,n,s,o){var c=-1,p=t.length;for(n||(n=Gf),o||(o=[]);++c<p;){var g=t[c];e>0&&n(g)?e>1?Tt(g,e-1,n,s,o):De(o,g):s||(o[o.length]=g)}return o}var Ai=so(),La=so(!0);function me(t,e){return t&&Ai(t,e,At)}function Pi(t,e){return t&&La(t,e,At)}function gr(t,e){return ke(e,function(n){return Oe(t[n])})}function Qe(t,e){e=$e(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[we(e[n++])];return n&&n==s?t:i}function ka(t,e,n){var s=e(t);return H(t)?s:De(s,n(t))}function Lt(t){return t==null?t===i?Eu:Le:Ze&&Ze in st(t)?Wf(t):Xf(t)}function Ti(t,e){return t>e}function nf(t,e){return t!=null&&rt.call(t,e)}function rf(t,e){return t!=null&&e in st(t)}function sf(t,e,n){return t>=It(e,n)&&t<xt(e,n)}function Ii(t,e,n){for(var s=n?fi:jn,o=t[0].length,c=t.length,p=c,g=M(c),y=1/0,x=[];p--;){var S=t[p];p&&e&&(S=pt(S,Zt(e))),y=It(S.length,y),g[p]=!n&&(e||o>=120&&S.length>=120)?new je(p&&S):i}S=t[0];var T=-1,F=g[0];t:for(;++T<o&&x.length<y;){var N=S[T],U=e?e(N):N;if(N=n||N!==0?N:0,!(F?Sn(F,U):s(x,U,n))){for(p=c;--p;){var J=g[p];if(!(J?Sn(J,U):s(t[p],U,n)))continue t}F&&F.push(U),x.push(N)}}return x}function af(t,e,n,s){return me(t,function(o,c,p){e(s,n(o),c,p)}),s}function Rn(t,e,n){e=$e(e,t),t=Co(t,e);var s=t==null?t:t[we(ue(e))];return s==null?i:Jt(s,t,n)}function Da(t){return vt(t)&&Lt(t)==tt}function of(t){return vt(t)&&Lt(t)==xn}function uf(t){return vt(t)&&Lt(t)==wt}function Ln(t,e,n,s,o){return t===e?!0:t==null||e==null||!vt(t)&&!vt(e)?t!==t&&e!==e:cf(t,e,n,s,Ln,o)}function cf(t,e,n,s,o,c){var p=H(t),g=H(e),y=p?ft:Et(t),x=g?ft:Et(e);y=y==tt?bt:y,x=x==tt?bt:x;var S=y==bt,T=x==bt,F=y==x;if(F&&ze(t)){if(!ze(e))return!1;p=!0,S=!1}if(F&&!S)return c||(c=new he),p||mn(t)?_o(t,e,n,s,o,c):Df(t,e,y,n,s,o,c);if(!(n&D)){var N=S&&rt.call(t,"__wrapped__"),U=T&&rt.call(e,"__wrapped__");if(N||U){var J=N?t.value():t,$=U?e.value():e;return c||(c=new he),o(J,$,n,s,c)}}return F?(c||(c=new he),Nf(t,e,n,s,o,c)):!1}function lf(t){return vt(t)&&Et(t)==_t}function Ei(t,e,n,s){var o=n.length,c=o,p=!s;if(t==null)return!c;for(t=st(t);o--;){var g=n[o];if(p&&g[2]?g[1]!==t[g[0]]:!(g[0]in t))return!1}for(;++o<c;){g=n[o];var y=g[0],x=t[y],S=g[1];if(p&&g[2]){if(x===i&&!(y in t))return!1}else{var T=new he;if(s)var F=s(x,S,y,t,e,T);if(!(F===i?Ln(S,x,D|E,s,T):F))return!1}}return!0}function Na(t){if(!gt(t)||Kf(t))return!1;var e=Oe(t)?cl:Vu;return e.test(tn(t))}function ff(t){return vt(t)&&Lt(t)==ee}function hf(t){return vt(t)&&Et(t)==ht}function pf(t){return vt(t)&&Fr(t.length)&&!!ct[Lt(t)]}function Wa(t){return typeof t=="function"?t:t==null?Gt:typeof t=="object"?H(t)?$a(t[0],t[1]):Ua(t):ou(t)}function Oi(t){if(!Nn(t))return gl(t);var e=[];for(var n in st(t))rt.call(t,n)&&n!="constructor"&&e.push(n);return e}function df(t){if(!gt(t))return jf(t);var e=Nn(t),n=[];for(var s in t)s=="constructor"&&(e||!rt.call(t,s))||n.push(s);return n}function Fi(t,e){return t<e}function Ba(t,e){var n=-1,s=qt(t)?M(t.length):[];return Be(t,function(o,c,p){s[++n]=e(o,c,p)}),s}function Ua(t){var e=Ji(t);return e.length==1&&e[0][2]?bo(e[0][0],e[0][1]):function(n){return n===t||Ei(n,t,e)}}function $a(t,e){return Yi(t)&&wo(e)?bo(we(t),e):function(n){var s=ss(n,t);return s===i&&s===e?as(n,t):Ln(e,s,D|E)}}function _r(t,e,n,s,o){t!==e&&Ai(e,function(c,p){if(o||(o=new he),gt(c))gf(t,e,p,n,_r,s,o);else{var g=s?s(Xi(t,p),c,p+"",t,e,o):i;g===i&&(g=c),xi(t,p,g)}},zt)}function gf(t,e,n,s,o,c,p){var g=Xi(t,n),y=Xi(e,n),x=p.get(y);if(x){xi(t,n,x);return}var S=c?c(g,y,n+"",t,e,p):i,T=S===i;if(T){var F=H(y),N=!F&&ze(y),U=!F&&!N&&mn(y);S=y,F||N||U?H(g)?S=g:mt(g)?S=$t(g):N?(T=!1,S=Va(y,!0)):U?(T=!1,S=to(y,!0)):S=[]:Bn(y)||en(y)?(S=g,en(g)?S=Xo(g):(!gt(g)||Oe(g))&&(S=yo(y))):T=!1}T&&(p.set(y,S),o(S,y,s,c,p),p.delete(y)),xi(t,n,S)}function qa(t,e){var n=t.length;if(n)return e+=e<0?n:0,Ee(e,n)?t[e]:i}function za(t,e,n){e.length?e=pt(e,function(c){return H(c)?function(p){return Qe(p,c.length===1?c[0]:c)}:c}):e=[Gt];var s=-1;e=pt(e,Zt(B()));var o=Ba(t,function(c,p,g){var y=pt(e,function(x){return x(c)});return{criteria:y,index:++s,value:c}});return $c(o,function(c,p){return Tf(c,p,n)})}function _f(t,e){return Ga(t,e,function(n,s){return as(t,s)})}function Ga(t,e,n){for(var s=-1,o=e.length,c={};++s<o;){var p=e[s],g=Qe(t,p);n(g,p)&&kn(c,$e(p,t),g)}return c}function vf(t){return function(e){return Qe(e,t)}}function Ri(t,e,n,s){var o=s?Uc:on,c=-1,p=e.length,g=t;for(t===e&&(e=$t(e)),n&&(g=pt(t,Zt(n)));++c<p;)for(var y=0,x=e[c],S=n?n(x):x;(y=o(g,S,y,s))>-1;)g!==t&&ar.call(g,y,1),ar.call(t,y,1);return t}function Ha(t,e){for(var n=t?e.length:0,s=n-1;n--;){var o=e[n];if(n==s||o!==c){var c=o;Ee(o)?ar.call(t,o,1):Ni(t,o)}}return t}function Li(t,e){return t+cr(Sa()*(e-t+1))}function mf(t,e,n,s){for(var o=-1,c=xt(ur((e-t)/(n||1)),0),p=M(c);c--;)p[s?c:++o]=t,t+=n;return p}function ki(t,e){var n="";if(!t||e<1||e>ge)return n;do e%2&&(n+=t),e=cr(e/2),e&&(t+=t);while(e);return n}function j(t,e){return Qi(Mo(t,e,Gt),t+"")}function yf(t){return Ta(yn(t))}function wf(t,e){var n=yn(t);return Ar(n,Xe(e,0,n.length))}function kn(t,e,n,s){if(!gt(t))return t;e=$e(e,t);for(var o=-1,c=e.length,p=c-1,g=t;g!=null&&++o<c;){var y=we(e[o]),x=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return t;if(o!=p){var S=g[y];x=s?s(S,y,g):i,x===i&&(x=gt(S)?S:Ee(e[o+1])?[]:{})}On(g,y,x),g=g[y]}return t}var Ka=lr?function(t,e){return lr.set(t,e),t}:Gt,bf=or?function(t,e){return or(t,"toString",{configurable:!0,enumerable:!1,value:us(e),writable:!0})}:Gt;function Mf(t){return Ar(yn(t))}function oe(t,e,n){var s=-1,o=t.length;e<0&&(e=-e>o?0:o+e),n=n>o?o:n,n<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var c=M(o);++s<o;)c[s]=t[s+e];return c}function Cf(t,e){var n;return Be(t,function(s,o,c){return n=e(s,o,c),!n}),!!n}function vr(t,e,n){var s=0,o=t==null?s:t.length;if(typeof e=="number"&&e===e&&o<=z){for(;s<o;){var c=s+o>>>1,p=t[c];p!==null&&!jt(p)&&(n?p<=e:p<e)?s=c+1:o=c}return o}return Di(t,e,Gt,n)}function Di(t,e,n,s){var o=0,c=t==null?0:t.length;if(c===0)return 0;e=n(e);for(var p=e!==e,g=e===null,y=jt(e),x=e===i;o<c;){var S=cr((o+c)/2),T=n(t[S]),F=T!==i,N=T===null,U=T===T,J=jt(T);if(p)var $=s||U;else x?$=U&&(s||F):g?$=U&&F&&(s||!N):y?$=U&&F&&!N&&(s||!J):N||J?$=!1:$=s?T<=e:T<e;$?o=S+1:c=S}return It(c,q)}function Ja(t,e){for(var n=-1,s=t.length,o=0,c=[];++n<s;){var p=t[n],g=e?e(p):p;if(!n||!pe(g,y)){var y=g;c[o++]=p===0?0:p}}return c}function Za(t){return typeof t=="number"?t:jt(t)?xe:+t}function Yt(t){if(typeof t=="string")return t;if(H(t))return pt(t,Yt)+"";if(jt(t))return Aa?Aa.call(t):"";var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function Ue(t,e,n){var s=-1,o=jn,c=t.length,p=!0,g=[],y=g;if(n)p=!1,o=fi;else if(c>=l){var x=e?null:Lf(t);if(x)return Qn(x);p=!1,o=Sn,y=new je}else y=e?[]:g;t:for(;++s<c;){var S=t[s],T=e?e(S):S;if(S=n||S!==0?S:0,p&&T===T){for(var F=y.length;F--;)if(y[F]===T)continue t;e&&y.push(T),g.push(S)}else o(y,T,n)||(y!==g&&y.push(T),g.push(S))}return g}function Ni(t,e){return e=$e(e,t),t=Co(t,e),t==null||delete t[we(ue(e))]}function Ya(t,e,n,s){return kn(t,e,n(Qe(t,e)),s)}function mr(t,e,n,s){for(var o=t.length,c=s?o:-1;(s?c--:++c<o)&&e(t[c],c,t););return n?oe(t,s?0:c,s?c+1:o):oe(t,s?c+1:0,s?o:c)}function ja(t,e){var n=t;return n instanceof Q&&(n=n.value()),hi(e,function(s,o){return o.func.apply(o.thisArg,De([s],o.args))},n)}function Wi(t,e,n){var s=t.length;if(s<2)return s?Ue(t[0]):[];for(var o=-1,c=M(s);++o<s;)for(var p=t[o],g=-1;++g<s;)g!=o&&(c[o]=Fn(c[o]||p,t[g],e,n));return Ue(Tt(c,1),e,n)}function Xa(t,e,n){for(var s=-1,o=t.length,c=e.length,p={};++s<o;){var g=s<c?e[s]:i;n(p,t[s],g)}return p}function Bi(t){return mt(t)?t:[]}function Ui(t){return typeof t=="function"?t:Gt}function $e(t,e){return H(t)?t:Yi(t,e)?[t]:Po(nt(t))}var xf=j;function qe(t,e,n){var s=t.length;return n=n===i?s:n,!e&&n>=s?t:oe(t,e,n)}var Qa=ll||function(t){return Pt.clearTimeout(t)};function Va(t,e){if(e)return t.slice();var n=t.length,s=wa?wa(n):new t.constructor(n);return t.copy(s),s}function $i(t){var e=new t.constructor(t.byteLength);return new ir(e).set(new ir(t)),e}function Sf(t,e){var n=e?$i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Af(t){var e=new t.constructor(t.source,Ds.exec(t));return e.lastIndex=t.lastIndex,e}function Pf(t){return En?st(En.call(t)):{}}function to(t,e){var n=e?$i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function eo(t,e){if(t!==e){var n=t!==i,s=t===null,o=t===t,c=jt(t),p=e!==i,g=e===null,y=e===e,x=jt(e);if(!g&&!x&&!c&&t>e||c&&p&&y&&!g&&!x||s&&p&&y||!n&&y||!o)return 1;if(!s&&!c&&!x&&t<e||x&&n&&o&&!s&&!c||g&&n&&o||!p&&o||!y)return-1}return 0}function Tf(t,e,n){for(var s=-1,o=t.criteria,c=e.criteria,p=o.length,g=n.length;++s<p;){var y=eo(o[s],c[s]);if(y){if(s>=g)return y;var x=n[s];return y*(x=="desc"?-1:1)}}return t.index-e.index}function no(t,e,n,s){for(var o=-1,c=t.length,p=n.length,g=-1,y=e.length,x=xt(c-p,0),S=M(y+x),T=!s;++g<y;)S[g]=e[g];for(;++o<p;)(T||o<c)&&(S[n[o]]=t[o]);for(;x--;)S[g++]=t[o++];return S}function ro(t,e,n,s){for(var o=-1,c=t.length,p=-1,g=n.length,y=-1,x=e.length,S=xt(c-g,0),T=M(S+x),F=!s;++o<S;)T[o]=t[o];for(var N=o;++y<x;)T[N+y]=e[y];for(;++p<g;)(F||o<c)&&(T[N+n[p]]=t[o++]);return T}function $t(t,e){var n=-1,s=t.length;for(e||(e=M(s));++n<s;)e[n]=t[n];return e}function ye(t,e,n,s){var o=!n;n||(n={});for(var c=-1,p=e.length;++c<p;){var g=e[c],y=s?s(n[g],t[g],g,n,t):i;y===i&&(y=t[g]),o?Pe(n,g,y):On(n,g,y)}return n}function If(t,e){return ye(t,Zi(t),e)}function Ef(t,e){return ye(t,vo(t),e)}function yr(t,e){return function(n,s){var o=H(n)?Lc:Xl,c=e?e():{};return o(n,t,B(s,2),c)}}function gn(t){return j(function(e,n){var s=-1,o=n.length,c=o>1?n[o-1]:i,p=o>2?n[2]:i;for(c=t.length>3&&typeof c=="function"?(o--,c):i,p&&kt(n[0],n[1],p)&&(c=o<3?i:c,o=1),e=st(e);++s<o;){var g=n[s];g&&t(e,g,s,c)}return e})}function io(t,e){return function(n,s){if(n==null)return n;if(!qt(n))return t(n,s);for(var o=n.length,c=e?o:-1,p=st(n);(e?c--:++c<o)&&s(p[c],c,p)!==!1;);return n}}function so(t){return function(e,n,s){for(var o=-1,c=st(e),p=s(e),g=p.length;g--;){var y=p[t?g:++o];if(n(c[y],y,c)===!1)break}return e}}function Of(t,e,n){var s=e&O,o=Dn(t);function c(){var p=this&&this!==Pt&&this instanceof c?o:t;return p.apply(s?n:this,arguments)}return c}function ao(t){return function(e){e=nt(e);var n=un(e)?fe(e):i,s=n?n[0]:e.charAt(0),o=n?qe(n,1).join(""):e.slice(1);return s[t]()+o}}function _n(t){return function(e){return hi(su(iu(e).replace(wc,"")),t,"")}}function Dn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=dn(t.prototype),s=t.apply(n,e);return gt(s)?s:n}}function Ff(t,e,n){var s=Dn(t);function o(){for(var c=arguments.length,p=M(c),g=c,y=vn(o);g--;)p[g]=arguments[g];var x=c<3&&p[0]!==y&&p[c-1]!==y?[]:Ne(p,y);if(c-=x.length,c<n)return fo(t,e,wr,o.placeholder,i,p,x,i,i,n-c);var S=this&&this!==Pt&&this instanceof o?s:t;return Jt(S,this,p)}return o}function oo(t){return function(e,n,s){var o=st(e);if(!qt(e)){var c=B(n,3);e=At(e),n=function(g){return c(o[g],g,o)}}var p=t(e,n,s);return p>-1?o[c?e[p]:p]:i}}function uo(t){return Ie(function(e){var n=e.length,s=n,o=se.prototype.thru;for(t&&e.reverse();s--;){var c=e[s];if(typeof c!="function")throw new ie(h);if(o&&!p&&xr(c)=="wrapper")var p=new se([],!0)}for(s=p?s:n;++s<n;){c=e[s];var g=xr(c),y=g=="wrapper"?Ki(c):i;y&&ji(y[0])&&y[1]==(Mt|Y|dt|te)&&!y[4].length&&y[9]==1?p=p[xr(y[0])].apply(p,y[3]):p=c.length==1&&ji(c)?p[g]():p.thru(c)}return function(){var x=arguments,S=x[0];if(p&&x.length==1&&H(S))return p.plant(S).value();for(var T=0,F=n?e[T].apply(this,x):S;++T<n;)F=e[T].call(this,F);return F}})}function wr(t,e,n,s,o,c,p,g,y,x){var S=e&Mt,T=e&O,F=e&W,N=e&(Y|it),U=e&Ht,J=F?i:Dn(t);function $(){for(var X=arguments.length,V=M(X),Xt=X;Xt--;)V[Xt]=arguments[Xt];if(N)var Dt=vn($),Qt=zc(V,Dt);if(s&&(V=no(V,s,o,N)),c&&(V=ro(V,c,p,N)),X-=Qt,N&&X<x){var yt=Ne(V,Dt);return fo(t,e,wr,$.placeholder,n,V,yt,g,y,x-X)}var de=T?n:this,Re=F?de[t]:t;return X=V.length,g?V=Qf(V,g):U&&X>1&&V.reverse(),S&&y<X&&(V.length=y),this&&this!==Pt&&this instanceof $&&(Re=J||Dn(Re)),Re.apply(de,V)}return $}function co(t,e){return function(n,s){return af(n,t,e(s),{})}}function br(t,e){return function(n,s){var o;if(n===i&&s===i)return e;if(n!==i&&(o=n),s!==i){if(o===i)return s;typeof n=="string"||typeof s=="string"?(n=Yt(n),s=Yt(s)):(n=Za(n),s=Za(s)),o=t(n,s)}return o}}function qi(t){return Ie(function(e){return e=pt(e,Zt(B())),j(function(n){var s=this;return t(e,function(o){return Jt(o,s,n)})})})}function Mr(t,e){e=e===i?" ":Yt(e);var n=e.length;if(n<2)return n?ki(e,t):e;var s=ki(e,ur(t/cn(e)));return un(e)?qe(fe(s),0,t).join(""):s.slice(0,t)}function Rf(t,e,n,s){var o=e&O,c=Dn(t);function p(){for(var g=-1,y=arguments.length,x=-1,S=s.length,T=M(S+y),F=this&&this!==Pt&&this instanceof p?c:t;++x<S;)T[x]=s[x];for(;y--;)T[x++]=arguments[++g];return Jt(F,o?n:this,T)}return p}function lo(t){return function(e,n,s){return s&&typeof s!="number"&&kt(e,n,s)&&(n=s=i),e=Fe(e),n===i?(n=e,e=0):n=Fe(n),s=s===i?e<n?1:-1:Fe(s),mf(e,n,s,t)}}function Cr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=ce(e),n=ce(n)),t(e,n)}}function fo(t,e,n,s,o,c,p,g,y,x){var S=e&Y,T=S?p:i,F=S?i:p,N=S?c:i,U=S?i:c;e|=S?dt:Wt,e&=~(S?Wt:dt),e&Z||(e&=~(O|W));var J=[t,e,o,N,T,U,F,g,y,x],$=n.apply(i,J);return ji(t)&&xo($,J),$.placeholder=s,So($,t,e)}function zi(t){var e=Ct[t];return function(n,s){if(n=ce(n),s=s==null?0:It(K(s),292),s&&xa(n)){var o=(nt(n)+"e").split("e"),c=e(o[0]+"e"+(+o[1]+s));return o=(nt(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-s))}return e(n)}}var Lf=hn&&1/Qn(new hn([,-0]))[1]==Ce?function(t){return new hn(t)}:fs;function ho(t){return function(e){var n=Et(e);return n==_t?yi(e):n==ht?jc(e):qc(e,t(e))}}function Te(t,e,n,s,o,c,p,g){var y=e&W;if(!y&&typeof t!="function")throw new ie(h);var x=s?s.length:0;if(x||(e&=~(dt|Wt),s=o=i),p=p===i?p:xt(K(p),0),g=g===i?g:K(g),x-=o?o.length:0,e&Wt){var S=s,T=o;s=o=i}var F=y?i:Ki(t),N=[t,e,n,s,o,S,T,c,p,g];if(F&&Yf(N,F),t=N[0],e=N[1],n=N[2],s=N[3],o=N[4],g=N[9]=N[9]===i?y?0:t.length:xt(N[9]-x,0),!g&&e&(Y|it)&&(e&=~(Y|it)),!e||e==O)var U=Of(t,e,n);else e==Y||e==it?U=Ff(t,e,g):(e==dt||e==(O|dt))&&!o.length?U=Rf(t,e,n,s):U=wr.apply(i,N);var J=F?Ka:xo;return So(J(U,N),t,e)}function po(t,e,n,s){return t===i||pe(t,fn[n])&&!rt.call(s,n)?e:t}function go(t,e,n,s,o,c){return gt(t)&&gt(e)&&(c.set(e,t),_r(t,e,i,go,c),c.delete(e)),t}function kf(t){return Bn(t)?i:t}function _o(t,e,n,s,o,c){var p=n&D,g=t.length,y=e.length;if(g!=y&&!(p&&y>g))return!1;var x=c.get(t),S=c.get(e);if(x&&S)return x==e&&S==t;var T=-1,F=!0,N=n&E?new je:i;for(c.set(t,e),c.set(e,t);++T<g;){var U=t[T],J=e[T];if(s)var $=p?s(J,U,T,e,t,c):s(U,J,T,t,e,c);if($!==i){if($)continue;F=!1;break}if(N){if(!pi(e,function(X,V){if(!Sn(N,V)&&(U===X||o(U,X,n,s,c)))return N.push(V)})){F=!1;break}}else if(!(U===J||o(U,J,n,s,c))){F=!1;break}}return c.delete(t),c.delete(e),F}function Df(t,e,n,s,o,c,p){switch(n){case sn:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case xn:return!(t.byteLength!=e.byteLength||!c(new ir(t),new ir(e)));case ut:case wt:case Rt:return pe(+t,+e);case Ft:return t.name==e.name&&t.message==e.message;case ee:case ve:return t==e+"";case _t:var g=yi;case ht:var y=s&D;if(g||(g=Qn),t.size!=e.size&&!y)return!1;var x=p.get(t);if(x)return x==e;s|=E,p.set(t,e);var S=_o(g(t),g(e),s,o,c,p);return p.delete(t),S;case Kn:if(En)return En.call(t)==En.call(e)}return!1}function Nf(t,e,n,s,o,c){var p=n&D,g=Gi(t),y=g.length,x=Gi(e),S=x.length;if(y!=S&&!p)return!1;for(var T=y;T--;){var F=g[T];if(!(p?F in e:rt.call(e,F)))return!1}var N=c.get(t),U=c.get(e);if(N&&U)return N==e&&U==t;var J=!0;c.set(t,e),c.set(e,t);for(var $=p;++T<y;){F=g[T];var X=t[F],V=e[F];if(s)var Xt=p?s(V,X,F,e,t,c):s(X,V,F,t,e,c);if(!(Xt===i?X===V||o(X,V,n,s,c):Xt)){J=!1;break}$||($=F=="constructor")}if(J&&!$){var Dt=t.constructor,Qt=e.constructor;Dt!=Qt&&"constructor"in t&&"constructor"in e&&!(typeof Dt=="function"&&Dt instanceof Dt&&typeof Qt=="function"&&Qt instanceof Qt)&&(J=!1)}return c.delete(t),c.delete(e),J}function Ie(t){return Qi(Mo(t,i,Oo),t+"")}function Gi(t){return ka(t,At,Zi)}function Hi(t){return ka(t,zt,vo)}var Ki=lr?function(t){return lr.get(t)}:fs;function xr(t){for(var e=t.name+"",n=pn[e],s=rt.call(pn,e)?n.length:0;s--;){var o=n[s],c=o.func;if(c==null||c==t)return o.name}return e}function vn(t){var e=rt.call(u,"placeholder")?u:t;return e.placeholder}function B(){var t=u.iteratee||cs;return t=t===cs?Wa:t,arguments.length?t(arguments[0],arguments[1]):t}function Sr(t,e){var n=t.__data__;return Hf(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ji(t){for(var e=At(t),n=e.length;n--;){var s=e[n],o=t[s];e[n]=[s,o,wo(o)]}return e}function Ve(t,e){var n=Jc(t,e);return Na(n)?n:i}function Wf(t){var e=rt.call(t,Ze),n=t[Ze];try{t[Ze]=i;var s=!0}catch{}var o=nr.call(t);return s&&(e?t[Ze]=n:delete t[Ze]),o}var Zi=bi?function(t){return t==null?[]:(t=st(t),ke(bi(t),function(e){return Ma.call(t,e)}))}:hs,vo=bi?function(t){for(var e=[];t;)De(e,Zi(t)),t=sr(t);return e}:hs,Et=Lt;(Mi&&Et(new Mi(new ArrayBuffer(1)))!=sn||Pn&&Et(new Pn)!=_t||Ci&&Et(Ci.resolve())!=Ut||hn&&Et(new hn)!=ht||Tn&&Et(new Tn)!=Cn)&&(Et=function(t){var e=Lt(t),n=e==bt?t.constructor:i,s=n?tn(n):"";if(s)switch(s){case yl:return sn;case wl:return _t;case bl:return Ut;case Ml:return ht;case Cl:return Cn}return e});function Bf(t,e,n){for(var s=-1,o=n.length;++s<o;){var c=n[s],p=c.size;switch(c.type){case"drop":t+=p;break;case"dropRight":e-=p;break;case"take":e=It(e,t+p);break;case"takeRight":t=xt(t,e-p);break}}return{start:t,end:e}}function Uf(t){var e=t.match(Hu);return e?e[1].split(Ku):[]}function mo(t,e,n){e=$e(e,t);for(var s=-1,o=e.length,c=!1;++s<o;){var p=we(e[s]);if(!(c=t!=null&&n(t,p)))break;t=t[p]}return c||++s!=o?c:(o=t==null?0:t.length,!!o&&Fr(o)&&Ee(p,o)&&(H(t)||en(t)))}function $f(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&rt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function yo(t){return typeof t.constructor=="function"&&!Nn(t)?dn(sr(t)):{}}function qf(t,e,n){var s=t.constructor;switch(e){case xn:return $i(t);case ut:case wt:return new s(+t);case sn:return Sf(t,n);case Jr:case Zr:case Yr:case jr:case Xr:case Qr:case Vr:case ti:case ei:return to(t,n);case _t:return new s;case Rt:case ve:return new s(t);case ee:return Af(t);case ht:return new s;case Kn:return Pf(t)}}function zf(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(Gu,`{
/* [wrapped with `+e+`] */
`)}function Gf(t){return H(t)||en(t)||!!(Ca&&t&&t[Ca])}function Ee(t,e){var n=typeof t;return e=e??ge,!!e&&(n=="number"||n!="symbol"&&ec.test(t))&&t>-1&&t%1==0&&t<e}function kt(t,e,n){if(!gt(n))return!1;var s=typeof e;return(s=="number"?qt(n)&&Ee(e,n.length):s=="string"&&e in n)?pe(n[e],t):!1}function Yi(t,e){if(H(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||jt(t)?!0:Uu.test(t)||!Bu.test(t)||e!=null&&t in st(e)}function Hf(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ji(t){var e=xr(t),n=u[e];if(typeof n!="function"||!(e in Q.prototype))return!1;if(t===n)return!0;var s=Ki(n);return!!s&&t===s[0]}function Kf(t){return!!ya&&ya in t}var Jf=tr?Oe:ps;function Nn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||fn;return t===n}function wo(t){return t===t&&!gt(t)}function bo(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==i||t in st(n))}}function Zf(t){var e=Er(t,function(s){return n.size===b&&n.clear(),s}),n=e.cache;return e}function Yf(t,e){var n=t[1],s=e[1],o=n|s,c=o<(O|W|Mt),p=s==Mt&&n==Y||s==Mt&&n==te&&t[7].length<=e[8]||s==(Mt|te)&&e[7].length<=e[8]&&n==Y;if(!(c||p))return t;s&O&&(t[2]=e[2],o|=n&O?0:Z);var g=e[3];if(g){var y=t[3];t[3]=y?no(y,g,e[4]):g,t[4]=y?Ne(t[3],A):e[4]}return g=e[5],g&&(y=t[5],t[5]=y?ro(y,g,e[6]):g,t[6]=y?Ne(t[5],A):e[6]),g=e[7],g&&(t[7]=g),s&Mt&&(t[8]=t[8]==null?e[8]:It(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=o,t}function jf(t){var e=[];if(t!=null)for(var n in st(t))e.push(n);return e}function Xf(t){return nr.call(t)}function Mo(t,e,n){return e=xt(e===i?t.length-1:e,0),function(){for(var s=arguments,o=-1,c=xt(s.length-e,0),p=M(c);++o<c;)p[o]=s[e+o];o=-1;for(var g=M(e+1);++o<e;)g[o]=s[o];return g[e]=n(p),Jt(t,this,g)}}function Co(t,e){return e.length<2?t:Qe(t,oe(e,0,-1))}function Qf(t,e){for(var n=t.length,s=It(e.length,n),o=$t(t);s--;){var c=e[s];t[s]=Ee(c,n)?o[c]:i}return t}function Xi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var xo=Ao(Ka),Wn=hl||function(t,e){return Pt.setTimeout(t,e)},Qi=Ao(bf);function So(t,e,n){var s=e+"";return Qi(t,zf(s,Vf(Uf(s),n)))}function Ao(t){var e=0,n=0;return function(){var s=_l(),o=Hr-(s-n);if(n=s,o>0){if(++e>=zn)return arguments[0]}else e=0;return t.apply(i,arguments)}}function Ar(t,e){var n=-1,s=t.length,o=s-1;for(e=e===i?s:e;++n<e;){var c=Li(n,o),p=t[c];t[c]=t[n],t[n]=p}return t.length=e,t}var Po=Zf(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($u,function(n,s,o,c){e.push(o?c.replace(Yu,"$1"):s||n)}),e});function we(t){if(typeof t=="string"||jt(t))return t;var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function tn(t){if(t!=null){try{return er.call(t)}catch{}try{return t+""}catch{}}return""}function Vf(t,e){return re(lt,function(n){var s="_."+n[0];e&n[1]&&!jn(t,s)&&t.push(s)}),t.sort()}function To(t){if(t instanceof Q)return t.clone();var e=new se(t.__wrapped__,t.__chain__);return e.__actions__=$t(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function th(t,e,n){(n?kt(t,e,n):e===i)?e=1:e=xt(K(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var o=0,c=0,p=M(ur(s/e));o<s;)p[c++]=oe(t,o,o+=e);return p}function eh(t){for(var e=-1,n=t==null?0:t.length,s=0,o=[];++e<n;){var c=t[e];c&&(o[s++]=c)}return o}function nh(){var t=arguments.length;if(!t)return[];for(var e=M(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return De(H(n)?$t(n):[n],Tt(e,1))}var rh=j(function(t,e){return mt(t)?Fn(t,Tt(e,1,mt,!0)):[]}),ih=j(function(t,e){var n=ue(e);return mt(n)&&(n=i),mt(t)?Fn(t,Tt(e,1,mt,!0),B(n,2)):[]}),sh=j(function(t,e){var n=ue(e);return mt(n)&&(n=i),mt(t)?Fn(t,Tt(e,1,mt,!0),i,n):[]});function ah(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===i?1:K(e),oe(t,e<0?0:e,s)):[]}function oh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===i?1:K(e),e=s-e,oe(t,0,e<0?0:e)):[]}function uh(t,e){return t&&t.length?mr(t,B(e,3),!0,!0):[]}function ch(t,e){return t&&t.length?mr(t,B(e,3),!0):[]}function lh(t,e,n,s){var o=t==null?0:t.length;return o?(n&&typeof n!="number"&&kt(t,e,n)&&(n=0,s=o),ef(t,e,n,s)):[]}function Io(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var o=n==null?0:K(n);return o<0&&(o=xt(s+o,0)),Xn(t,B(e,3),o)}function Eo(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var o=s-1;return n!==i&&(o=K(n),o=n<0?xt(s+o,0):It(o,s-1)),Xn(t,B(e,3),o,!0)}function Oo(t){var e=t==null?0:t.length;return e?Tt(t,1):[]}function fh(t){var e=t==null?0:t.length;return e?Tt(t,Ce):[]}function hh(t,e){var n=t==null?0:t.length;return n?(e=e===i?1:K(e),Tt(t,e)):[]}function ph(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var o=t[e];s[o[0]]=o[1]}return s}function Fo(t){return t&&t.length?t[0]:i}function dh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var o=n==null?0:K(n);return o<0&&(o=xt(s+o,0)),on(t,e,o)}function gh(t){var e=t==null?0:t.length;return e?oe(t,0,-1):[]}var _h=j(function(t){var e=pt(t,Bi);return e.length&&e[0]===t[0]?Ii(e):[]}),vh=j(function(t){var e=ue(t),n=pt(t,Bi);return e===ue(n)?e=i:n.pop(),n.length&&n[0]===t[0]?Ii(n,B(e,2)):[]}),mh=j(function(t){var e=ue(t),n=pt(t,Bi);return e=typeof e=="function"?e:i,e&&n.pop(),n.length&&n[0]===t[0]?Ii(n,i,e):[]});function yh(t,e){return t==null?"":dl.call(t,e)}function ue(t){var e=t==null?0:t.length;return e?t[e-1]:i}function wh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var o=s;return n!==i&&(o=K(n),o=o<0?xt(s+o,0):It(o,s-1)),e===e?Qc(t,e,o):Xn(t,fa,o,!0)}function bh(t,e){return t&&t.length?qa(t,K(e)):i}var Mh=j(Ro);function Ro(t,e){return t&&t.length&&e&&e.length?Ri(t,e):t}function Ch(t,e,n){return t&&t.length&&e&&e.length?Ri(t,e,B(n,2)):t}function xh(t,e,n){return t&&t.length&&e&&e.length?Ri(t,e,i,n):t}var Sh=Ie(function(t,e){var n=t==null?0:t.length,s=Si(t,e);return Ha(t,pt(e,function(o){return Ee(o,n)?+o:o}).sort(eo)),s});function Ah(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,o=[],c=t.length;for(e=B(e,3);++s<c;){var p=t[s];e(p,s,t)&&(n.push(p),o.push(s))}return Ha(t,o),n}function Vi(t){return t==null?t:ml.call(t)}function Ph(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&kt(t,e,n)?(e=0,n=s):(e=e==null?0:K(e),n=n===i?s:K(n)),oe(t,e,n)):[]}function Th(t,e){return vr(t,e)}function Ih(t,e,n){return Di(t,e,B(n,2))}function Eh(t,e){var n=t==null?0:t.length;if(n){var s=vr(t,e);if(s<n&&pe(t[s],e))return s}return-1}function Oh(t,e){return vr(t,e,!0)}function Fh(t,e,n){return Di(t,e,B(n,2),!0)}function Rh(t,e){var n=t==null?0:t.length;if(n){var s=vr(t,e,!0)-1;if(pe(t[s],e))return s}return-1}function Lh(t){return t&&t.length?Ja(t):[]}function kh(t,e){return t&&t.length?Ja(t,B(e,2)):[]}function Dh(t){var e=t==null?0:t.length;return e?oe(t,1,e):[]}function Nh(t,e,n){return t&&t.length?(e=n||e===i?1:K(e),oe(t,0,e<0?0:e)):[]}function Wh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===i?1:K(e),e=s-e,oe(t,e<0?0:e,s)):[]}function Bh(t,e){return t&&t.length?mr(t,B(e,3),!1,!0):[]}function Uh(t,e){return t&&t.length?mr(t,B(e,3)):[]}var $h=j(function(t){return Ue(Tt(t,1,mt,!0))}),qh=j(function(t){var e=ue(t);return mt(e)&&(e=i),Ue(Tt(t,1,mt,!0),B(e,2))}),zh=j(function(t){var e=ue(t);return e=typeof e=="function"?e:i,Ue(Tt(t,1,mt,!0),i,e)});function Gh(t){return t&&t.length?Ue(t):[]}function Hh(t,e){return t&&t.length?Ue(t,B(e,2)):[]}function Kh(t,e){return e=typeof e=="function"?e:i,t&&t.length?Ue(t,i,e):[]}function ts(t){if(!(t&&t.length))return[];var e=0;return t=ke(t,function(n){if(mt(n))return e=xt(n.length,e),!0}),vi(e,function(n){return pt(t,di(n))})}function Lo(t,e){if(!(t&&t.length))return[];var n=ts(t);return e==null?n:pt(n,function(s){return Jt(e,i,s)})}var Jh=j(function(t,e){return mt(t)?Fn(t,e):[]}),Zh=j(function(t){return Wi(ke(t,mt))}),Yh=j(function(t){var e=ue(t);return mt(e)&&(e=i),Wi(ke(t,mt),B(e,2))}),jh=j(function(t){var e=ue(t);return e=typeof e=="function"?e:i,Wi(ke(t,mt),i,e)}),Xh=j(ts);function Qh(t,e){return Xa(t||[],e||[],On)}function Vh(t,e){return Xa(t||[],e||[],kn)}var tp=j(function(t){var e=t.length,n=e>1?t[e-1]:i;return n=typeof n=="function"?(t.pop(),n):i,Lo(t,n)});function ko(t){var e=u(t);return e.__chain__=!0,e}function ep(t,e){return e(t),t}function Pr(t,e){return e(t)}var np=Ie(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,o=function(c){return Si(c,t)};return e>1||this.__actions__.length||!(s instanceof Q)||!Ee(n)?this.thru(o):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:Pr,args:[o],thisArg:i}),new se(s,this.__chain__).thru(function(c){return e&&!c.length&&c.push(i),c}))});function rp(){return ko(this)}function ip(){return new se(this.value(),this.__chain__)}function sp(){this.__values__===i&&(this.__values__=Yo(this.value()));var t=this.__index__>=this.__values__.length,e=t?i:this.__values__[this.__index__++];return{done:t,value:e}}function ap(){return this}function op(t){for(var e,n=this;n instanceof hr;){var s=To(n);s.__index__=0,s.__values__=i,e?o.__wrapped__=s:e=s;var o=s;n=n.__wrapped__}return o.__wrapped__=t,e}function up(){var t=this.__wrapped__;if(t instanceof Q){var e=t;return this.__actions__.length&&(e=new Q(this)),e=e.reverse(),e.__actions__.push({func:Pr,args:[Vi],thisArg:i}),new se(e,this.__chain__)}return this.thru(Vi)}function cp(){return ja(this.__wrapped__,this.__actions__)}var lp=yr(function(t,e,n){rt.call(t,n)?++t[n]:Pe(t,n,1)});function fp(t,e,n){var s=H(t)?ca:tf;return n&&kt(t,e,n)&&(e=i),s(t,B(e,3))}function hp(t,e){var n=H(t)?ke:Ra;return n(t,B(e,3))}var pp=oo(Io),dp=oo(Eo);function gp(t,e){return Tt(Tr(t,e),1)}function _p(t,e){return Tt(Tr(t,e),Ce)}function vp(t,e,n){return n=n===i?1:K(n),Tt(Tr(t,e),n)}function Do(t,e){var n=H(t)?re:Be;return n(t,B(e,3))}function No(t,e){var n=H(t)?kc:Fa;return n(t,B(e,3))}var mp=yr(function(t,e,n){rt.call(t,n)?t[n].push(e):Pe(t,n,[e])});function yp(t,e,n,s){t=qt(t)?t:yn(t),n=n&&!s?K(n):0;var o=t.length;return n<0&&(n=xt(o+n,0)),Rr(t)?n<=o&&t.indexOf(e,n)>-1:!!o&&on(t,e,n)>-1}var wp=j(function(t,e,n){var s=-1,o=typeof e=="function",c=qt(t)?M(t.length):[];return Be(t,function(p){c[++s]=o?Jt(e,p,n):Rn(p,e,n)}),c}),bp=yr(function(t,e,n){Pe(t,n,e)});function Tr(t,e){var n=H(t)?pt:Ba;return n(t,B(e,3))}function Mp(t,e,n,s){return t==null?[]:(H(e)||(e=e==null?[]:[e]),n=s?i:n,H(n)||(n=n==null?[]:[n]),za(t,e,n))}var Cp=yr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function xp(t,e,n){var s=H(t)?hi:pa,o=arguments.length<3;return s(t,B(e,4),n,o,Be)}function Sp(t,e,n){var s=H(t)?Dc:pa,o=arguments.length<3;return s(t,B(e,4),n,o,Fa)}function Ap(t,e){var n=H(t)?ke:Ra;return n(t,Or(B(e,3)))}function Pp(t){var e=H(t)?Ta:yf;return e(t)}function Tp(t,e,n){(n?kt(t,e,n):e===i)?e=1:e=K(e);var s=H(t)?Yl:wf;return s(t,e)}function Ip(t){var e=H(t)?jl:Mf;return e(t)}function Ep(t){if(t==null)return 0;if(qt(t))return Rr(t)?cn(t):t.length;var e=Et(t);return e==_t||e==ht?t.size:Oi(t).length}function Op(t,e,n){var s=H(t)?pi:Cf;return n&&kt(t,e,n)&&(e=i),s(t,B(e,3))}var Fp=j(function(t,e){if(t==null)return[];var n=e.length;return n>1&&kt(t,e[0],e[1])?e=[]:n>2&&kt(e[0],e[1],e[2])&&(e=[e[0]]),za(t,Tt(e,1),[])}),Ir=fl||function(){return Pt.Date.now()};function Rp(t,e){if(typeof e!="function")throw new ie(h);return t=K(t),function(){if(--t<1)return e.apply(this,arguments)}}function Wo(t,e,n){return e=n?i:e,e=t&&e==null?t.length:e,Te(t,Mt,i,i,i,i,e)}function Bo(t,e){var n;if(typeof e!="function")throw new ie(h);return t=K(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=i),n}}var es=j(function(t,e,n){var s=O;if(n.length){var o=Ne(n,vn(es));s|=dt}return Te(t,s,e,n,o)}),Uo=j(function(t,e,n){var s=O|W;if(n.length){var o=Ne(n,vn(Uo));s|=dt}return Te(e,s,t,n,o)});function $o(t,e,n){e=n?i:e;var s=Te(t,Y,i,i,i,i,i,e);return s.placeholder=$o.placeholder,s}function qo(t,e,n){e=n?i:e;var s=Te(t,it,i,i,i,i,i,e);return s.placeholder=qo.placeholder,s}function zo(t,e,n){var s,o,c,p,g,y,x=0,S=!1,T=!1,F=!0;if(typeof t!="function")throw new ie(h);e=ce(e)||0,gt(n)&&(S=!!n.leading,T="maxWait"in n,c=T?xt(ce(n.maxWait)||0,e):c,F="trailing"in n?!!n.trailing:F);function N(yt){var de=s,Re=o;return s=o=i,x=yt,p=t.apply(Re,de),p}function U(yt){return x=yt,g=Wn(X,e),S?N(yt):p}function J(yt){var de=yt-y,Re=yt-x,uu=e-de;return T?It(uu,c-Re):uu}function $(yt){var de=yt-y,Re=yt-x;return y===i||de>=e||de<0||T&&Re>=c}function X(){var yt=Ir();if($(yt))return V(yt);g=Wn(X,J(yt))}function V(yt){return g=i,F&&s?N(yt):(s=o=i,p)}function Xt(){g!==i&&Qa(g),x=0,s=y=o=g=i}function Dt(){return g===i?p:V(Ir())}function Qt(){var yt=Ir(),de=$(yt);if(s=arguments,o=this,y=yt,de){if(g===i)return U(y);if(T)return Qa(g),g=Wn(X,e),N(y)}return g===i&&(g=Wn(X,e)),p}return Qt.cancel=Xt,Qt.flush=Dt,Qt}var Lp=j(function(t,e){return Oa(t,1,e)}),kp=j(function(t,e,n){return Oa(t,ce(e)||0,n)});function Dp(t){return Te(t,Ht)}function Er(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new ie(h);var n=function(){var s=arguments,o=e?e.apply(this,s):s[0],c=n.cache;if(c.has(o))return c.get(o);var p=t.apply(this,s);return n.cache=c.set(o,p)||c,p};return n.cache=new(Er.Cache||Ae),n}Er.Cache=Ae;function Or(t){if(typeof t!="function")throw new ie(h);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Np(t){return Bo(2,t)}var Wp=xf(function(t,e){e=e.length==1&&H(e[0])?pt(e[0],Zt(B())):pt(Tt(e,1),Zt(B()));var n=e.length;return j(function(s){for(var o=-1,c=It(s.length,n);++o<c;)s[o]=e[o].call(this,s[o]);return Jt(t,this,s)})}),ns=j(function(t,e){var n=Ne(e,vn(ns));return Te(t,dt,i,e,n)}),Go=j(function(t,e){var n=Ne(e,vn(Go));return Te(t,Wt,i,e,n)}),Bp=Ie(function(t,e){return Te(t,te,i,i,i,e)});function Up(t,e){if(typeof t!="function")throw new ie(h);return e=e===i?e:K(e),j(t,e)}function $p(t,e){if(typeof t!="function")throw new ie(h);return e=e==null?0:xt(K(e),0),j(function(n){var s=n[e],o=qe(n,0,e);return s&&De(o,s),Jt(t,this,o)})}function qp(t,e,n){var s=!0,o=!0;if(typeof t!="function")throw new ie(h);return gt(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),zo(t,e,{leading:s,maxWait:e,trailing:o})}function zp(t){return Wo(t,1)}function Gp(t,e){return ns(Ui(e),t)}function Hp(){if(!arguments.length)return[];var t=arguments[0];return H(t)?t:[t]}function Kp(t){return ae(t,R)}function Jp(t,e){return e=typeof e=="function"?e:i,ae(t,R,e)}function Zp(t){return ae(t,v|R)}function Yp(t,e){return e=typeof e=="function"?e:i,ae(t,v|R,e)}function jp(t,e){return e==null||Ea(t,e,At(e))}function pe(t,e){return t===e||t!==t&&e!==e}var Xp=Cr(Ti),Qp=Cr(function(t,e){return t>=e}),en=Da(function(){return arguments}())?Da:function(t){return vt(t)&&rt.call(t,"callee")&&!Ma.call(t,"callee")},H=M.isArray,Vp=ra?Zt(ra):of;function qt(t){return t!=null&&Fr(t.length)&&!Oe(t)}function mt(t){return vt(t)&&qt(t)}function td(t){return t===!0||t===!1||vt(t)&&Lt(t)==ut}var ze=pl||ps,ed=ia?Zt(ia):uf;function nd(t){return vt(t)&&t.nodeType===1&&!Bn(t)}function rd(t){if(t==null)return!0;if(qt(t)&&(H(t)||typeof t=="string"||typeof t.splice=="function"||ze(t)||mn(t)||en(t)))return!t.length;var e=Et(t);if(e==_t||e==ht)return!t.size;if(Nn(t))return!Oi(t).length;for(var n in t)if(rt.call(t,n))return!1;return!0}function id(t,e){return Ln(t,e)}function sd(t,e,n){n=typeof n=="function"?n:i;var s=n?n(t,e):i;return s===i?Ln(t,e,i,n):!!s}function rs(t){if(!vt(t))return!1;var e=Lt(t);return e==Ft||e==Kt||typeof t.message=="string"&&typeof t.name=="string"&&!Bn(t)}function ad(t){return typeof t=="number"&&xa(t)}function Oe(t){if(!gt(t))return!1;var e=Lt(t);return e==Bt||e==_e||e==at||e==le}function Ho(t){return typeof t=="number"&&t==K(t)}function Fr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ge}function gt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function vt(t){return t!=null&&typeof t=="object"}var Ko=sa?Zt(sa):lf;function od(t,e){return t===e||Ei(t,e,Ji(e))}function ud(t,e,n){return n=typeof n=="function"?n:i,Ei(t,e,Ji(e),n)}function cd(t){return Jo(t)&&t!=+t}function ld(t){if(Jf(t))throw new G(d);return Na(t)}function fd(t){return t===null}function hd(t){return t==null}function Jo(t){return typeof t=="number"||vt(t)&&Lt(t)==Rt}function Bn(t){if(!vt(t)||Lt(t)!=bt)return!1;var e=sr(t);if(e===null)return!0;var n=rt.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&er.call(n)==ol}var is=aa?Zt(aa):ff;function pd(t){return Ho(t)&&t>=-ge&&t<=ge}var Zo=oa?Zt(oa):hf;function Rr(t){return typeof t=="string"||!H(t)&&vt(t)&&Lt(t)==ve}function jt(t){return typeof t=="symbol"||vt(t)&&Lt(t)==Kn}var mn=ua?Zt(ua):pf;function dd(t){return t===i}function gd(t){return vt(t)&&Et(t)==Cn}function _d(t){return vt(t)&&Lt(t)==Ou}var vd=Cr(Fi),md=Cr(function(t,e){return t<=e});function Yo(t){if(!t)return[];if(qt(t))return Rr(t)?fe(t):$t(t);if(An&&t[An])return Yc(t[An]());var e=Et(t),n=e==_t?yi:e==ht?Qn:yn;return n(t)}function Fe(t){if(!t)return t===0?t:0;if(t=ce(t),t===Ce||t===-Ce){var e=t<0?-1:1;return e*Hn}return t===t?t:0}function K(t){var e=Fe(t),n=e%1;return e===e?n?e-n:e:0}function jo(t){return t?Xe(K(t),0,L):0}function ce(t){if(typeof t=="number")return t;if(jt(t))return xe;if(gt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=gt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=da(t);var n=Qu.test(t);return n||tc.test(t)?Fc(t.slice(2),n?2:8):Xu.test(t)?xe:+t}function Xo(t){return ye(t,zt(t))}function yd(t){return t?Xe(K(t),-ge,ge):t===0?t:0}function nt(t){return t==null?"":Yt(t)}var wd=gn(function(t,e){if(Nn(e)||qt(e)){ye(e,At(e),t);return}for(var n in e)rt.call(e,n)&&On(t,n,e[n])}),Qo=gn(function(t,e){ye(e,zt(e),t)}),Lr=gn(function(t,e,n,s){ye(e,zt(e),t,s)}),bd=gn(function(t,e,n,s){ye(e,At(e),t,s)}),Md=Ie(Si);function Cd(t,e){var n=dn(t);return e==null?n:Ia(n,e)}var xd=j(function(t,e){t=st(t);var n=-1,s=e.length,o=s>2?e[2]:i;for(o&&kt(e[0],e[1],o)&&(s=1);++n<s;)for(var c=e[n],p=zt(c),g=-1,y=p.length;++g<y;){var x=p[g],S=t[x];(S===i||pe(S,fn[x])&&!rt.call(t,x))&&(t[x]=c[x])}return t}),Sd=j(function(t){return t.push(i,go),Jt(Vo,i,t)});function Ad(t,e){return la(t,B(e,3),me)}function Pd(t,e){return la(t,B(e,3),Pi)}function Td(t,e){return t==null?t:Ai(t,B(e,3),zt)}function Id(t,e){return t==null?t:La(t,B(e,3),zt)}function Ed(t,e){return t&&me(t,B(e,3))}function Od(t,e){return t&&Pi(t,B(e,3))}function Fd(t){return t==null?[]:gr(t,At(t))}function Rd(t){return t==null?[]:gr(t,zt(t))}function ss(t,e,n){var s=t==null?i:Qe(t,e);return s===i?n:s}function Ld(t,e){return t!=null&&mo(t,e,nf)}function as(t,e){return t!=null&&mo(t,e,rf)}var kd=co(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=nr.call(e)),t[e]=n},us(Gt)),Dd=co(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=nr.call(e)),rt.call(t,e)?t[e].push(n):t[e]=[n]},B),Nd=j(Rn);function At(t){return qt(t)?Pa(t):Oi(t)}function zt(t){return qt(t)?Pa(t,!0):df(t)}function Wd(t,e){var n={};return e=B(e,3),me(t,function(s,o,c){Pe(n,e(s,o,c),s)}),n}function Bd(t,e){var n={};return e=B(e,3),me(t,function(s,o,c){Pe(n,o,e(s,o,c))}),n}var Ud=gn(function(t,e,n){_r(t,e,n)}),Vo=gn(function(t,e,n,s){_r(t,e,n,s)}),$d=Ie(function(t,e){var n={};if(t==null)return n;var s=!1;e=pt(e,function(c){return c=$e(c,t),s||(s=c.length>1),c}),ye(t,Hi(t),n),s&&(n=ae(n,v|P|R,kf));for(var o=e.length;o--;)Ni(n,e[o]);return n});function qd(t,e){return tu(t,Or(B(e)))}var zd=Ie(function(t,e){return t==null?{}:_f(t,e)});function tu(t,e){if(t==null)return{};var n=pt(Hi(t),function(s){return[s]});return e=B(e),Ga(t,n,function(s,o){return e(s,o[0])})}function Gd(t,e,n){e=$e(e,t);var s=-1,o=e.length;for(o||(o=1,t=i);++s<o;){var c=t==null?i:t[we(e[s])];c===i&&(s=o,c=n),t=Oe(c)?c.call(t):c}return t}function Hd(t,e,n){return t==null?t:kn(t,e,n)}function Kd(t,e,n,s){return s=typeof s=="function"?s:i,t==null?t:kn(t,e,n,s)}var eu=ho(At),nu=ho(zt);function Jd(t,e,n){var s=H(t),o=s||ze(t)||mn(t);if(e=B(e,4),n==null){var c=t&&t.constructor;o?n=s?new c:[]:gt(t)?n=Oe(c)?dn(sr(t)):{}:n={}}return(o?re:me)(t,function(p,g,y){return e(n,p,g,y)}),n}function Zd(t,e){return t==null?!0:Ni(t,e)}function Yd(t,e,n){return t==null?t:Ya(t,e,Ui(n))}function jd(t,e,n,s){return s=typeof s=="function"?s:i,t==null?t:Ya(t,e,Ui(n),s)}function yn(t){return t==null?[]:mi(t,At(t))}function Xd(t){return t==null?[]:mi(t,zt(t))}function Qd(t,e,n){return n===i&&(n=e,e=i),n!==i&&(n=ce(n),n=n===n?n:0),e!==i&&(e=ce(e),e=e===e?e:0),Xe(ce(t),e,n)}function Vd(t,e,n){return e=Fe(e),n===i?(n=e,e=0):n=Fe(n),t=ce(t),sf(t,e,n)}function tg(t,e,n){if(n&&typeof n!="boolean"&&kt(t,e,n)&&(e=n=i),n===i&&(typeof e=="boolean"?(n=e,e=i):typeof t=="boolean"&&(n=t,t=i)),t===i&&e===i?(t=0,e=1):(t=Fe(t),e===i?(e=t,t=0):e=Fe(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var o=Sa();return It(t+o*(e-t+Oc("1e-"+((o+"").length-1))),e)}return Li(t,e)}var eg=_n(function(t,e,n){return e=e.toLowerCase(),t+(n?ru(e):e)});function ru(t){return os(nt(t).toLowerCase())}function iu(t){return t=nt(t),t&&t.replace(nc,Gc).replace(bc,"")}function ng(t,e,n){t=nt(t),e=Yt(e);var s=t.length;n=n===i?s:Xe(K(n),0,s);var o=n;return n-=e.length,n>=0&&t.slice(n,o)==e}function rg(t){return t=nt(t),t&&Du.test(t)?t.replace(Ls,Hc):t}function ig(t){return t=nt(t),t&&qu.test(t)?t.replace(ni,"\\$&"):t}var sg=_n(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),ag=_n(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),og=ao("toLowerCase");function ug(t,e,n){t=nt(t),e=K(e);var s=e?cn(t):0;if(!e||s>=e)return t;var o=(e-s)/2;return Mr(cr(o),n)+t+Mr(ur(o),n)}function cg(t,e,n){t=nt(t),e=K(e);var s=e?cn(t):0;return e&&s<e?t+Mr(e-s,n):t}function lg(t,e,n){t=nt(t),e=K(e);var s=e?cn(t):0;return e&&s<e?Mr(e-s,n)+t:t}function fg(t,e,n){return n||e==null?e=0:e&&(e=+e),vl(nt(t).replace(ri,""),e||0)}function hg(t,e,n){return(n?kt(t,e,n):e===i)?e=1:e=K(e),ki(nt(t),e)}function pg(){var t=arguments,e=nt(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var dg=_n(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function gg(t,e,n){return n&&typeof n!="number"&&kt(t,e,n)&&(e=n=i),n=n===i?L:n>>>0,n?(t=nt(t),t&&(typeof e=="string"||e!=null&&!is(e))&&(e=Yt(e),!e&&un(t))?qe(fe(t),0,n):t.split(e,n)):[]}var _g=_n(function(t,e,n){return t+(n?" ":"")+os(e)});function vg(t,e,n){return t=nt(t),n=n==null?0:Xe(K(n),0,t.length),e=Yt(e),t.slice(n,n+e.length)==e}function mg(t,e,n){var s=u.templateSettings;n&&kt(t,e,n)&&(e=i),t=nt(t),e=Lr({},e,s,po);var o=Lr({},e.imports,s.imports,po),c=At(o),p=mi(o,c),g,y,x=0,S=e.interpolate||Jn,T="__p += '",F=wi((e.escape||Jn).source+"|"+S.source+"|"+(S===ks?ju:Jn).source+"|"+(e.evaluate||Jn).source+"|$","g"),N="//# sourceURL="+(rt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ac+"]")+`
`;t.replace(F,function($,X,V,Xt,Dt,Qt){return V||(V=Xt),T+=t.slice(x,Qt).replace(rc,Kc),X&&(g=!0,T+=`' +
__e(`+X+`) +
'`),Dt&&(y=!0,T+=`';
`+Dt+`;
__p += '`),V&&(T+=`' +
((__t = (`+V+`)) == null ? '' : __t) +
'`),x=Qt+$.length,$}),T+=`';
`;var U=rt.call(e,"variable")&&e.variable;if(!U)T=`with (obj) {
`+T+`
}
`;else if(Zu.test(U))throw new G(_);T=(y?T.replace(Fu,""):T).replace(Ru,"$1").replace(Lu,"$1;"),T="function("+(U||"obj")+`) {
`+(U?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+T+`return __p
}`;var J=au(function(){return et(c,N+"return "+T).apply(i,p)});if(J.source=T,rs(J))throw J;return J}function yg(t){return nt(t).toLowerCase()}function wg(t){return nt(t).toUpperCase()}function bg(t,e,n){if(t=nt(t),t&&(n||e===i))return da(t);if(!t||!(e=Yt(e)))return t;var s=fe(t),o=fe(e),c=ga(s,o),p=_a(s,o)+1;return qe(s,c,p).join("")}function Mg(t,e,n){if(t=nt(t),t&&(n||e===i))return t.slice(0,ma(t)+1);if(!t||!(e=Yt(e)))return t;var s=fe(t),o=_a(s,fe(e))+1;return qe(s,0,o).join("")}function Cg(t,e,n){if(t=nt(t),t&&(n||e===i))return t.replace(ri,"");if(!t||!(e=Yt(e)))return t;var s=fe(t),o=ga(s,fe(e));return qe(s,o).join("")}function xg(t,e){var n=Ot,s=bn;if(gt(e)){var o="separator"in e?e.separator:o;n="length"in e?K(e.length):n,s="omission"in e?Yt(e.omission):s}t=nt(t);var c=t.length;if(un(t)){var p=fe(t);c=p.length}if(n>=c)return t;var g=n-cn(s);if(g<1)return s;var y=p?qe(p,0,g).join(""):t.slice(0,g);if(o===i)return y+s;if(p&&(g+=y.length-g),is(o)){if(t.slice(g).search(o)){var x,S=y;for(o.global||(o=wi(o.source,nt(Ds.exec(o))+"g")),o.lastIndex=0;x=o.exec(S);)var T=x.index;y=y.slice(0,T===i?g:T)}}else if(t.indexOf(Yt(o),g)!=g){var F=y.lastIndexOf(o);F>-1&&(y=y.slice(0,F))}return y+s}function Sg(t){return t=nt(t),t&&ku.test(t)?t.replace(Rs,Vc):t}var Ag=_n(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),os=ao("toUpperCase");function su(t,e,n){return t=nt(t),e=n?i:e,e===i?Zc(t)?nl(t):Bc(t):t.match(e)||[]}var au=j(function(t,e){try{return Jt(t,i,e)}catch(n){return rs(n)?n:new G(n)}}),Pg=Ie(function(t,e){return re(e,function(n){n=we(n),Pe(t,n,es(t[n],t))}),t});function Tg(t){var e=t==null?0:t.length,n=B();return t=e?pt(t,function(s){if(typeof s[1]!="function")throw new ie(h);return[n(s[0]),s[1]]}):[],j(function(s){for(var o=-1;++o<e;){var c=t[o];if(Jt(c[0],this,s))return Jt(c[1],this,s)}})}function Ig(t){return Vl(ae(t,v))}function us(t){return function(){return t}}function Eg(t,e){return t==null||t!==t?e:t}var Og=uo(),Fg=uo(!0);function Gt(t){return t}function cs(t){return Wa(typeof t=="function"?t:ae(t,v))}function Rg(t){return Ua(ae(t,v))}function Lg(t,e){return $a(t,ae(e,v))}var kg=j(function(t,e){return function(n){return Rn(n,t,e)}}),Dg=j(function(t,e){return function(n){return Rn(t,n,e)}});function ls(t,e,n){var s=At(e),o=gr(e,s);n==null&&!(gt(e)&&(o.length||!s.length))&&(n=e,e=t,t=this,o=gr(e,At(e)));var c=!(gt(n)&&"chain"in n)||!!n.chain,p=Oe(t);return re(o,function(g){var y=e[g];t[g]=y,p&&(t.prototype[g]=function(){var x=this.__chain__;if(c||x){var S=t(this.__wrapped__),T=S.__actions__=$t(this.__actions__);return T.push({func:y,args:arguments,thisArg:t}),S.__chain__=x,S}return y.apply(t,De([this.value()],arguments))})}),t}function Ng(){return Pt._===this&&(Pt._=ul),this}function fs(){}function Wg(t){return t=K(t),j(function(e){return qa(e,t)})}var Bg=qi(pt),Ug=qi(ca),$g=qi(pi);function ou(t){return Yi(t)?di(we(t)):vf(t)}function qg(t){return function(e){return t==null?i:Qe(t,e)}}var zg=lo(),Gg=lo(!0);function hs(){return[]}function ps(){return!1}function Hg(){return{}}function Kg(){return""}function Jg(){return!0}function Zg(t,e){if(t=K(t),t<1||t>ge)return[];var n=L,s=It(t,L);e=B(e),t-=L;for(var o=vi(s,e);++n<t;)e(n);return o}function Yg(t){return H(t)?pt(t,we):jt(t)?[t]:$t(Po(nt(t)))}function jg(t){var e=++al;return nt(t)+e}var Xg=br(function(t,e){return t+e},0),Qg=zi("ceil"),Vg=br(function(t,e){return t/e},1),t0=zi("floor");function e0(t){return t&&t.length?dr(t,Gt,Ti):i}function n0(t,e){return t&&t.length?dr(t,B(e,2),Ti):i}function r0(t){return ha(t,Gt)}function i0(t,e){return ha(t,B(e,2))}function s0(t){return t&&t.length?dr(t,Gt,Fi):i}function a0(t,e){return t&&t.length?dr(t,B(e,2),Fi):i}var o0=br(function(t,e){return t*e},1),u0=zi("round"),c0=br(function(t,e){return t-e},0);function l0(t){return t&&t.length?_i(t,Gt):0}function f0(t,e){return t&&t.length?_i(t,B(e,2)):0}return u.after=Rp,u.ary=Wo,u.assign=wd,u.assignIn=Qo,u.assignInWith=Lr,u.assignWith=bd,u.at=Md,u.before=Bo,u.bind=es,u.bindAll=Pg,u.bindKey=Uo,u.castArray=Hp,u.chain=ko,u.chunk=th,u.compact=eh,u.concat=nh,u.cond=Tg,u.conforms=Ig,u.constant=us,u.countBy=lp,u.create=Cd,u.curry=$o,u.curryRight=qo,u.debounce=zo,u.defaults=xd,u.defaultsDeep=Sd,u.defer=Lp,u.delay=kp,u.difference=rh,u.differenceBy=ih,u.differenceWith=sh,u.drop=ah,u.dropRight=oh,u.dropRightWhile=uh,u.dropWhile=ch,u.fill=lh,u.filter=hp,u.flatMap=gp,u.flatMapDeep=_p,u.flatMapDepth=vp,u.flatten=Oo,u.flattenDeep=fh,u.flattenDepth=hh,u.flip=Dp,u.flow=Og,u.flowRight=Fg,u.fromPairs=ph,u.functions=Fd,u.functionsIn=Rd,u.groupBy=mp,u.initial=gh,u.intersection=_h,u.intersectionBy=vh,u.intersectionWith=mh,u.invert=kd,u.invertBy=Dd,u.invokeMap=wp,u.iteratee=cs,u.keyBy=bp,u.keys=At,u.keysIn=zt,u.map=Tr,u.mapKeys=Wd,u.mapValues=Bd,u.matches=Rg,u.matchesProperty=Lg,u.memoize=Er,u.merge=Ud,u.mergeWith=Vo,u.method=kg,u.methodOf=Dg,u.mixin=ls,u.negate=Or,u.nthArg=Wg,u.omit=$d,u.omitBy=qd,u.once=Np,u.orderBy=Mp,u.over=Bg,u.overArgs=Wp,u.overEvery=Ug,u.overSome=$g,u.partial=ns,u.partialRight=Go,u.partition=Cp,u.pick=zd,u.pickBy=tu,u.property=ou,u.propertyOf=qg,u.pull=Mh,u.pullAll=Ro,u.pullAllBy=Ch,u.pullAllWith=xh,u.pullAt=Sh,u.range=zg,u.rangeRight=Gg,u.rearg=Bp,u.reject=Ap,u.remove=Ah,u.rest=Up,u.reverse=Vi,u.sampleSize=Tp,u.set=Hd,u.setWith=Kd,u.shuffle=Ip,u.slice=Ph,u.sortBy=Fp,u.sortedUniq=Lh,u.sortedUniqBy=kh,u.split=gg,u.spread=$p,u.tail=Dh,u.take=Nh,u.takeRight=Wh,u.takeRightWhile=Bh,u.takeWhile=Uh,u.tap=ep,u.throttle=qp,u.thru=Pr,u.toArray=Yo,u.toPairs=eu,u.toPairsIn=nu,u.toPath=Yg,u.toPlainObject=Xo,u.transform=Jd,u.unary=zp,u.union=$h,u.unionBy=qh,u.unionWith=zh,u.uniq=Gh,u.uniqBy=Hh,u.uniqWith=Kh,u.unset=Zd,u.unzip=ts,u.unzipWith=Lo,u.update=Yd,u.updateWith=jd,u.values=yn,u.valuesIn=Xd,u.without=Jh,u.words=su,u.wrap=Gp,u.xor=Zh,u.xorBy=Yh,u.xorWith=jh,u.zip=Xh,u.zipObject=Qh,u.zipObjectDeep=Vh,u.zipWith=tp,u.entries=eu,u.entriesIn=nu,u.extend=Qo,u.extendWith=Lr,ls(u,u),u.add=Xg,u.attempt=au,u.camelCase=eg,u.capitalize=ru,u.ceil=Qg,u.clamp=Qd,u.clone=Kp,u.cloneDeep=Zp,u.cloneDeepWith=Yp,u.cloneWith=Jp,u.conformsTo=jp,u.deburr=iu,u.defaultTo=Eg,u.divide=Vg,u.endsWith=ng,u.eq=pe,u.escape=rg,u.escapeRegExp=ig,u.every=fp,u.find=pp,u.findIndex=Io,u.findKey=Ad,u.findLast=dp,u.findLastIndex=Eo,u.findLastKey=Pd,u.floor=t0,u.forEach=Do,u.forEachRight=No,u.forIn=Td,u.forInRight=Id,u.forOwn=Ed,u.forOwnRight=Od,u.get=ss,u.gt=Xp,u.gte=Qp,u.has=Ld,u.hasIn=as,u.head=Fo,u.identity=Gt,u.includes=yp,u.indexOf=dh,u.inRange=Vd,u.invoke=Nd,u.isArguments=en,u.isArray=H,u.isArrayBuffer=Vp,u.isArrayLike=qt,u.isArrayLikeObject=mt,u.isBoolean=td,u.isBuffer=ze,u.isDate=ed,u.isElement=nd,u.isEmpty=rd,u.isEqual=id,u.isEqualWith=sd,u.isError=rs,u.isFinite=ad,u.isFunction=Oe,u.isInteger=Ho,u.isLength=Fr,u.isMap=Ko,u.isMatch=od,u.isMatchWith=ud,u.isNaN=cd,u.isNative=ld,u.isNil=hd,u.isNull=fd,u.isNumber=Jo,u.isObject=gt,u.isObjectLike=vt,u.isPlainObject=Bn,u.isRegExp=is,u.isSafeInteger=pd,u.isSet=Zo,u.isString=Rr,u.isSymbol=jt,u.isTypedArray=mn,u.isUndefined=dd,u.isWeakMap=gd,u.isWeakSet=_d,u.join=yh,u.kebabCase=sg,u.last=ue,u.lastIndexOf=wh,u.lowerCase=ag,u.lowerFirst=og,u.lt=vd,u.lte=md,u.max=e0,u.maxBy=n0,u.mean=r0,u.meanBy=i0,u.min=s0,u.minBy=a0,u.stubArray=hs,u.stubFalse=ps,u.stubObject=Hg,u.stubString=Kg,u.stubTrue=Jg,u.multiply=o0,u.nth=bh,u.noConflict=Ng,u.noop=fs,u.now=Ir,u.pad=ug,u.padEnd=cg,u.padStart=lg,u.parseInt=fg,u.random=tg,u.reduce=xp,u.reduceRight=Sp,u.repeat=hg,u.replace=pg,u.result=Gd,u.round=u0,u.runInContext=m,u.sample=Pp,u.size=Ep,u.snakeCase=dg,u.some=Op,u.sortedIndex=Th,u.sortedIndexBy=Ih,u.sortedIndexOf=Eh,u.sortedLastIndex=Oh,u.sortedLastIndexBy=Fh,u.sortedLastIndexOf=Rh,u.startCase=_g,u.startsWith=vg,u.subtract=c0,u.sum=l0,u.sumBy=f0,u.template=mg,u.times=Zg,u.toFinite=Fe,u.toInteger=K,u.toLength=jo,u.toLower=yg,u.toNumber=ce,u.toSafeInteger=yd,u.toString=nt,u.toUpper=wg,u.trim=bg,u.trimEnd=Mg,u.trimStart=Cg,u.truncate=xg,u.unescape=Sg,u.uniqueId=jg,u.upperCase=Ag,u.upperFirst=os,u.each=Do,u.eachRight=No,u.first=Fo,ls(u,function(){var t={};return me(u,function(e,n){rt.call(u.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),u.VERSION=a,re(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){u[t].placeholder=u}),re(["drop","take"],function(t,e){Q.prototype[t]=function(n){n=n===i?1:xt(K(n),0);var s=this.__filtered__&&!e?new Q(this):this.clone();return s.__filtered__?s.__takeCount__=It(n,s.__takeCount__):s.__views__.push({size:It(n,L),type:t+(s.__dir__<0?"Right":"")}),s},Q.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),re(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==Mn||n==Kr;Q.prototype[t]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:B(o,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),re(["head","last"],function(t,e){var n="take"+(e?"Right":"");Q.prototype[t]=function(){return this[n](1).value()[0]}}),re(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Q.prototype[t]=function(){return this.__filtered__?new Q(this):this[n](1)}}),Q.prototype.compact=function(){return this.filter(Gt)},Q.prototype.find=function(t){return this.filter(t).head()},Q.prototype.findLast=function(t){return this.reverse().find(t)},Q.prototype.invokeMap=j(function(t,e){return typeof t=="function"?new Q(this):this.map(function(n){return Rn(n,t,e)})}),Q.prototype.reject=function(t){return this.filter(Or(B(t)))},Q.prototype.slice=function(t,e){t=K(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Q(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==i&&(e=K(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},Q.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Q.prototype.toArray=function(){return this.take(L)},me(Q.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),o=u[s?"take"+(e=="last"?"Right":""):e],c=s||/^find/.test(e);o&&(u.prototype[e]=function(){var p=this.__wrapped__,g=s?[1]:arguments,y=p instanceof Q,x=g[0],S=y||H(p),T=function(X){var V=o.apply(u,De([X],g));return s&&F?V[0]:V};S&&n&&typeof x=="function"&&x.length!=1&&(y=S=!1);var F=this.__chain__,N=!!this.__actions__.length,U=c&&!F,J=y&&!N;if(!c&&S){p=J?p:new Q(this);var $=t.apply(p,g);return $.__actions__.push({func:Pr,args:[T],thisArg:i}),new se($,F)}return U&&J?t.apply(this,g):($=this.thru(T),U?s?$.value()[0]:$.value():$)})}),re(["pop","push","shift","sort","splice","unshift"],function(t){var e=Vn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);u.prototype[t]=function(){var o=arguments;if(s&&!this.__chain__){var c=this.value();return e.apply(H(c)?c:[],o)}return this[n](function(p){return e.apply(H(p)?p:[],o)})}}),me(Q.prototype,function(t,e){var n=u[e];if(n){var s=n.name+"";rt.call(pn,s)||(pn[s]=[]),pn[s].push({name:e,func:n})}}),pn[wr(i,W).name]=[{name:"wrapper",func:i}],Q.prototype.clone=xl,Q.prototype.reverse=Sl,Q.prototype.value=Al,u.prototype.at=np,u.prototype.chain=rp,u.prototype.commit=ip,u.prototype.next=sp,u.prototype.plant=op,u.prototype.reverse=up,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=cp,u.prototype.first=u.prototype.head,An&&(u.prototype[An]=ap),u},ln=rl();Je?((Je.exports=ln)._=ln,ci._=ln):Pt._=ln}).call(d0)}(Un,Un.exports)),Un.exports}var _0=g0();const I=Ps(_0),v0={rate:6,span:1e3,th:750};function m0(f,r){(r===null||typeof r>"u")&&(r=v0);let i=0;return Array.isArray(f)?i=(f[0]+f[1])/2:i=f,i<=r.th?1:(1+r.rate/r.span/100)**(i-r.th)}const fu={baseline:0,terrainScale:1};function Nt(f,r=0){return Math.round(f*10**r)/10**r}function nn(f,r,i,a,l){return i+(l-f)/(r-f)*(a-i)}function yu(f,r,i){let a=0,l=0;const d=[];for(a=0;a<i.length;a++)if(i[a]<f[l])d.push(r[l]);else{for(;l<f.length-1&&f[l+1]<=i[a];)l++;l===f.length-1||i[a]===f[l]?d.push(r[l]):d.push(nn(f[l],f[l+1],r[l],r[l+1],i[a]))}return d}function wu(f){let r,i,a,l,d=0,h=0,_=0,w=0,b=0;for(r=0;r<f.length;r++)i=f[r][0],a=f[r][1],l=f[r][2],b+=l,d+=l*i,_+=l*(i*i),h+=l*a,w+=l*(i*a);const A=(h*_-d*w)/(b*_-d*d);return[(b*w-d*h)/(b*_-d*d),A]}function bu(f,r,i,a){let l=0,d=0;const h=[];return i.forEach(_=>{for(;f[l]<_-a;)l++;for(l>0&&f[l]>=_&&l--;d<f.length-1&&f[d+1]<=_+a;)d++;d<f.length-1&&f[d]<=_&&d++;const w=Math.max(a,Math.abs(_-f[l])+.001,Math.abs(_-f[d])+.001),b=[];let A=0;for(let v=l;v<=d;v++)A=(1-(Math.abs(_-f[v])/w)**3)**3,b.push([f[v],r[v],A]);h.push(wu(b))}),h}function ws(f,r,i){return Nt(f,i)<Nt(r,i)}function y0(f,r,i){return Nt(f,i)>Nt(r,i)}function Ur(f,r,i){return Nt(f,i)<=Nt(r,i)}function zr(f,r,i){return Nt(f,i)>=Nt(r,i)}function He(f,r,i){return Nt(f,i)===Nt(r,i)}const w0=Object.freeze(Object.defineProperty({__proto__:null,interp:nn,interpArray:yu,linearRegression:wu,req:He,rgt:y0,rgte:zr,rlt:ws,rlte:Ur,round:Nt,wlslr:bu},Symbol.toStringTag,{value:"Module"}));function Mu(f,r){function i(a){return a<f.noon?a+86400:a}return r>=f.sunrise&&r<=f.sunset?0:!isNaN(f.dawn)&&!isNaN(f.dusk)&&(r<=f.dawn||r>=f.dusk)?1:i(r)>=i(f.nadir)?nn(i(isNaN(f.dawn)?f.nadir:f.dawn),i(f.sunrise),1,0,i(r)):nn(i(f.sunset),i(isNaN(f.dusk)?f.nadir:f.dusk),0,1,i(r))}function b0({timeOfDaySeconds:f,terrainFactor:r,sun:i,model:a=fu}){if(r===1||f>=i.sunrise&&f<=i.sunset)return 1;(a===null||typeof a>"u")&&(a=fu);const l=i.nadirAltitude<-6?1:-(i.nadirAltitude/6),d=(a.terrainScale*(r-1)+a.baseline)*l,h=Mu(i,f);return 1+d*h}const Me=["altitude","grade","terrain","heat","dark","fatigue","strategy"];class qn{constructor(r){Object.defineProperty(this,"_data",{value:{}}),Object.defineProperty(this,"_cache",{value:{}}),Me.forEach(i=>{Object.defineProperty(this,i,{enumerable:!0,get(){return this._data[i]||1},set(a){a!==1?this._data[i]=a:delete this._data[i],delete this._cache.combined}})}),Object.assign(this,r)}get combined(){return I.has(this._cache,"combined")||(this._cache.combined=Me.reduce((r,i)=>r*this[i],1)),this._cache.combined}}const M0={a:.0021,b:.034,lower:{lim:-22,m:-.0584,b:-.0164},upper:{lim:16,m:.1012,b:.4624}};function C0(f,r){return(r===null||typeof r>"u")&&(r=M0),f<r.lower.lim?r.lower.m*f+r.lower.b:f>r.upper.lim?r.upper.m*f+r.upper.b:r.a*f**2+r.b*f+1}function Cu({point:f,model:r}={}){if(!r)return 1;const i=f.tod;let a=1;if(i>r.start&&i<r.stop){const l=(i-r.start)/(r.stop-r.start)*Math.PI;a+=(r.max-r.baseline)*Math.sin(l)/100}return a+=r.baseline/100,a}function x0({point:f,course:r}){const i=I.findLast(r.terrainFactors,a=>Ur(a.start,f.loc,4));return i?i.value/100+1:1}function xu(f,r){let i=0,a=0;return f.forEach((l,d)=>{const h=d===f.length-1?r:f[d+1].onset,_=l.type==="linear"?l.value/2:l.value;a+=(i+_)*(h-l.onset),i+=l.value}),a/r}function S0(f){return f<30?2:f<60?5:f<90?10:f<120?15:20}function A0(f,r,i){let a=-xu(r,i);return r.forEach((l,d)=>{if(f>=l.onset){if(l.type==="step")a+=l.value;else if(l.type==="linear"){const h=d===r.length-1?i:r[d+1].onset;f>h?a+=l.value:a+=l.value*(f-l.onset)/(h-l.onset)}}}),a}class Su{constructor(r={}){if(Object.defineProperty(this,"__class",{value:"Strategy",enumerable:!1}),r.__class==="Strategy")Object.assign(this,I.cloneDeep(r));else{if(!r.length)throw new Error("length required");if(this.length=r.length,I.isNumber(r.values))this.values=[{onset:0,value:r.values,type:"linear"}];else if(I.isArray(r.values))this.values=I.cloneDeep(r.values);else{if(r.values)throw new Error(`bad values input: ${JSON.stringify(r.values)}`);this.values=[{onset:0,value:S0(this.length),type:"linear"}]}}}at(r){return 1+A0(r,this.values,this.length)/100}addValue(r){const i=this.values.findIndex(a=>a.onset>=r.onset);i>=0?this.values.splice(i,0,r):this.values.push(r)}}function P0(f,r){return(f-1)*r+1}function bs(f,{plan:r,course:i}){i||(i=r.course),f.factors||(f.factors=new qn),Object.assign(f.factors,{grade:C0(f.grade),altitude:m0(f.alt),terrain:x0({point:f,course:i})}),r&&(Object.assign(f.factors,{strategy:r.strategy.at(f.loc)}),typeof f.tod<"u"&&Object.assign(f.factors,{heat:r.heatModel?Cu({point:f,model:r.heatModel}):1,dark:r.event.sun?b0({timeOfDaySeconds:f.tod,terrainFactor:f.factors.terrain,sun:r.event.sun}):1}));const a={};i!=null&&i.scales&&Object.assign(a,i.scales),r!=null&&r.scales&&Object.assign(a,r.scales),Object.keys(a).filter(l=>l!==1&&f.factors[l]).forEach(l=>{f.factors[l]=P0(f.factors[l],a[l])})}class Ts{constructor(r){Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,r)}set name(r){this._data.name=r}get name(){var r;return this._data.name||((r=this.waypoint)==null?void 0:r.name)||void 0}get start(){return this.end-this.len}get pace(){if(I.isNumber(this.time))return this.time?this.time/this.len:0}get delay(){var r,i,a,l;if(!(!I.isNumber((r=this.point1)==null?void 0:r.elapsed)||!I.isNumber((i=this.point2)==null?void 0:i.elapsed)||!I.isNumber((a=this.point1)==null?void 0:a.time)||!I.isNumber((l=this.point2)==null?void 0:l.time)))return this.point2.elapsed-this.point1.elapsed-(this.point2.time-this.point1.time)}get elapsed(){var r;return(r=this.point2)==null?void 0:r.elapsed}get time(){var r,i;if(!(!I.isNumber((r=this.point1)==null?void 0:r.time)||!I.isNumber((i=this.point2)==null?void 0:i.time)))return this.point2.time-this.point1.time}get tod(){var r;return(r=this.point2)==null?void 0:r.tod}set delay(r){}set pace(r){}set elapsed(r){}set time(r){}set tod(r){}}function T0(f,r){return(typeof f=="object"?String(f._id):f)===(typeof r=="object"?String(r._id):r)}var Dr={exports:{}},ds,hu;function I0(){if(hu)return ds;hu=1;var f=1e3,r=f*60,i=r*60,a=i*24,l=a*7,d=a*365.25;ds=function(A,v){v=v||{};var P=typeof A;if(P==="string"&&A.length>0)return h(A);if(P==="number"&&isFinite(A))return v.long?w(A):_(A);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(A))};function h(A){if(A=String(A),!(A.length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(A);if(v){var P=parseFloat(v[1]),R=(v[2]||"ms").toLowerCase();switch(R){case"years":case"year":case"yrs":case"yr":case"y":return P*d;case"weeks":case"week":case"w":return P*l;case"days":case"day":case"d":return P*a;case"hours":case"hour":case"hrs":case"hr":case"h":return P*i;case"minutes":case"minute":case"mins":case"min":case"m":return P*r;case"seconds":case"second":case"secs":case"sec":case"s":return P*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return P;default:return}}}}function _(A){var v=Math.abs(A);return v>=a?Math.round(A/a)+"d":v>=i?Math.round(A/i)+"h":v>=r?Math.round(A/r)+"m":v>=f?Math.round(A/f)+"s":A+"ms"}function w(A){var v=Math.abs(A);return v>=a?b(A,v,a,"day"):v>=i?b(A,v,i,"hour"):v>=r?b(A,v,r,"minute"):v>=f?b(A,v,f,"second"):A+" ms"}function b(A,v,P,R){var D=v>=P*1.5;return Math.round(A/P)+" "+R+(D?"s":"")}return ds}var gs,pu;function E0(){if(pu)return gs;pu=1;function f(r){a.debug=a,a.default=a,a.coerce=b,a.disable=_,a.enable=d,a.enabled=w,a.humanize=I0(),a.destroy=A,Object.keys(r).forEach(v=>{a[v]=r[v]}),a.names=[],a.skips=[],a.formatters={};function i(v){let P=0;for(let R=0;R<v.length;R++)P=(P<<5)-P+v.charCodeAt(R),P|=0;return a.colors[Math.abs(P)%a.colors.length]}a.selectColor=i;function a(v){let P,R=null,D,E;function O(...W){if(!O.enabled)return;const Z=O,Y=Number(new Date),it=Y-(P||Y);Z.diff=it,Z.prev=P,Z.curr=Y,P=Y,W[0]=a.coerce(W[0]),typeof W[0]!="string"&&W.unshift("%O");let dt=0;W[0]=W[0].replace(/%([a-zA-Z%])/g,(Mt,te)=>{if(Mt==="%%")return"%";dt++;const Ht=a.formatters[te];if(typeof Ht=="function"){const Ot=W[dt];Mt=Ht.call(Z,Ot),W.splice(dt,1),dt--}return Mt}),a.formatArgs.call(Z,W),(Z.log||a.log).apply(Z,W)}return O.namespace=v,O.useColors=a.useColors(),O.color=a.selectColor(v),O.extend=l,O.destroy=a.destroy,Object.defineProperty(O,"enabled",{enumerable:!0,configurable:!1,get:()=>R!==null?R:(D!==a.namespaces&&(D=a.namespaces,E=a.enabled(v)),E),set:W=>{R=W}}),typeof a.init=="function"&&a.init(O),O}function l(v,P){const R=a(this.namespace+(typeof P>"u"?":":P)+v);return R.log=this.log,R}function d(v){a.save(v),a.namespaces=v,a.names=[],a.skips=[];const P=(typeof v=="string"?v:"").trim().replace(" ",",").split(",").filter(Boolean);for(const R of P)R[0]==="-"?a.skips.push(R.slice(1)):a.names.push(R)}function h(v,P){let R=0,D=0,E=-1,O=0;for(;R<v.length;)if(D<P.length&&(P[D]===v[R]||P[D]==="*"))P[D]==="*"?(E=D,O=R,D++):(R++,D++);else if(E!==-1)D=E+1,O++,R=O;else return!1;for(;D<P.length&&P[D]==="*";)D++;return D===P.length}function _(){const v=[...a.names,...a.skips.map(P=>"-"+P)].join(",");return a.enable(""),v}function w(v){for(const P of a.skips)if(h(v,P))return!1;for(const P of a.names)if(h(v,P))return!0;return!1}function b(v){return v instanceof Error?v.stack||v.message:v}function A(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}return gs=f,gs}var du;function O0(){return du||(du=1,function(f,r){r.formatArgs=a,r.save=l,r.load=d,r.useColors=i,r.storage=h(),r.destroy=(()=>{let w=!1;return()=>{w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let w;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(w=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(w[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+f.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;w.splice(1,0,b,"color: inherit");let A=0,v=0;w[0].replace(/%[a-zA-Z%]/g,P=>{P!=="%%"&&(A++,P==="%c"&&(v=A))}),w.splice(v,0,b)}r.log=console.debug||console.log||(()=>{});function l(w){try{w?r.storage.setItem("debug",w):r.storage.removeItem("debug")}catch{}}function d(){let w;try{w=r.storage.getItem("debug")}catch{}return!w&&typeof process<"u"&&"env"in process&&(w=process.env.DEBUG),w}function h(){try{return localStorage}catch{}}f.exports=E0()(r);const{formatters:_}=f.exports;_.j=function(w){try{return JSON.stringify(w)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}}(Dr,Dr.exports)),Dr.exports}var F0=O0();const R0=Ps(F0),_s={};function Ke(f){if(!_s[f]){const r=R0("ultraPacer:core");r(`loading debug for namespace "${f}"`),_s[f]=r.extend(f)}return _s[f]}function Ms(f,r){const i=f.toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:r}).split(":").map(a=>Number(a));return i[0]*60*60+i[1]*60+i[2]}class rn extends Error{constructor(r,i){super(r),this.name="MissingDataError",this.field=i}}const Is=Ke("geo"),Cs=Me;function L0(f){const r={};return Cs.forEach(i=>{const a={};a[i]=f,Object.assign(r,a)}),r}function Es({plan:f,course:r,breaks:i}){var E;const a=Is.extend("calcSegments");a("exec"),I.isNumber(i[0])&&(i=i.filter(O=>O>0&&ws(O,r.dist,4)),i.unshift(0),i=i.map((O,W)=>({start:O,end:i[W+1]||r.dist})));const l=f?f.points:r.points;if(!(l!=null&&l.length))throw a(`${f?"Plan":"Course"} points are not defined.`),new rn((f?"Plan":"Course")+" points are not defined.","points");const d=[];let h,_,w,b;const A=l[0].actual!==void 0&&l[l.length-1].actual!==void 0;for(h=0,_=i.length;h<_;h++){const O=i[h];He((E=i[h-1])==null?void 0:E.end,O.start,4)?w=b:w=f?f.getPoint({loc:O.start}):r.getPoint({loc:O.start}),b=f?f.getPoint({loc:O.end}):r.getPoint({loc:O.end});const W=O.end-O.start,Z=new Ts({end:b.loc,len:W,gain:0,loss:0,alt:b.alt,grade:W>0?(b.alt-w.alt)/W/10*(b.alt-w.alt>0?r.gainScale:r.lossScale):0,delay:0,factorsSum:L0(0),point1:w,point2:b});A&&(Z.actualTime=Z.point2.actual.elapsed-Z.point1.actual.elapsed,Z.actualElapsed=Z.point2.actual.elapsed),d.push(Z)}const v=({seg:O,p1:W,p2:Z})=>{const Y=Z.alt-W.alt;O[Y>0?"gain":"loss"]+=Y*(Y>0?r.gainScale:r.lossScale),bs(W,{plan:f,course:r});const it=Z.loc-W.loc;Cs.forEach(dt=>{O.factorsSum[dt]+=W.factors[dt]*it})};h=1;let P,R,D;for(let O=0;O<d.length;O++){for(P=d[O];Ur(l[h].loc,P.point1.loc,4);)h++;for(R=P.point1;h<l.length&&Ur(l[h].loc,P.point2.loc,4);)D=l[h],v({p1:R,p2:D,seg:P}),R=D,h++;v({p1:R,p2:P.point2,seg:P}),f&&(P.delay=f.delays.filter(W=>zr(P.point1.loc,W.loc,4)&&ws(P.point2.loc,W.loc,4)).reduce((W,Z)=>W+Z,0))}return d.forEach(O=>{O.factors=new qn(Object.fromEntries(Cs.map(W=>[W,O.factorsSum[W]/O.len])))}),d}function Au(f){Is("createSegments"),f.plan&&!f.course&&(f.course=f.plan.course);const r=f.course.waypoints.filter(a=>a.tier<3).sort((a,l)=>a.loc-l.loc);f.breaks=r.map(a=>a.loc);const i=Es(f);if(!i.length)throw new Error("createSegments result is empty");return i.forEach((a,l)=>{a.waypoint=r[l+1]}),i}function $r(f){Is(`createSplits:${f.unit}`),f.plan&&!f.course&&(f.course=f.plan.course);const r=f.unit==="kilometers"?1:.621371,i=I.range(f.course.dist*r).map(l=>l/r);f.course.dist-I.last(i)>1e-4&&i.push(f.course.dist),Object.assign(f,{breaks:i});const a=Es(f);if(!a.length)throw new Error("createSplits result is empty");return a}class xs{constructor(r,i,a){Object.defineProperty(this,"course",{writable:!0}),this.point=i,this.course=r,this.loop=a}get lat(){return this.point.lat}get lon(){return this.point.lon}get alt(){return this.point.alt}get latlon(){return this.point.latlon}get grade(){return this.point.grade*(this.point.grade>0?this.course.gainScale:this.course.lossScale)}get loc(){let r=this.point.loc*this.course.distScale;return this.loop&&(r+=this.course.loopDist*this.loop),r}}var vs={exports:{}},gu;function k0(){return gu||(gu=1,function(f,r){(function(){var i=Math.PI,a=Math.sin,l=Math.cos,d=Math.tan,h=Math.asin,_=Math.atan2,w=Math.acos,b=i/180,A=1e3*60*60*24,v=2440588,P=2451545;function R(L){return L.valueOf()/A-.5+v}function D(L){return new Date((L+.5-v)*A)}function E(L){return R(L)-P}var O=b*23.4397;function W(L,q){return _(a(L)*l(O)-d(q)*a(O),l(L))}function Z(L,q){return h(a(q)*l(O)+l(q)*a(O)*a(L))}function Y(L,q,z){return _(a(L),l(L)*a(q)-d(z)*l(q))}function it(L,q,z){return h(a(q)*a(z)+l(q)*l(z)*l(L))}function dt(L,q){return b*(280.16+360.9856235*L)-q}function Wt(L){return L<0&&(L=0),2967e-7/Math.tan(L+.00312536/(L+.08901179))}function Mt(L){return b*(357.5291+.98560028*L)}function te(L){var q=b*(1.9148*a(L)+.02*a(2*L)+3e-4*a(3*L)),z=b*102.9372;return L+q+z+i}function Ht(L){var q=Mt(L),z=te(q);return{dec:Z(z,0),ra:W(z,0)}}var Ot={};Ot.getPosition=function(L,q,z){var lt=b*-z,tt=b*q,ft=E(L),at=Ht(ft),ut=dt(ft,lt)-at.ra;return{azimuth:Y(ut,tt,at.dec),altitude:it(ut,tt,at.dec)}};var bn=Ot.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];Ot.addTime=function(L,q,z){bn.push([L,q,z])};var zn=9e-4;function Hr(L,q){return Math.round(L-zn-q/(2*i))}function Mn(L,q,z){return zn+(L+q)/(2*i)+z}function Gn(L,q,z){return P+L+.0053*a(q)-.0069*a(2*z)}function Kr(L,q,z){return w((a(L)-a(q)*a(z))/(l(q)*l(z)))}function Ce(L){return-2.076*Math.sqrt(L)/60}function ge(L,q,z,lt,tt,ft,at){var ut=Kr(L,z,lt),wt=Mn(ut,q,tt);return Gn(wt,ft,at)}Ot.getTimes=function(L,q,z,lt){lt=lt||0;var tt=b*-z,ft=b*q,at=Ce(lt),ut=E(L),wt=Hr(ut,tt),Kt=Mn(0,tt,wt),Ft=Mt(Kt),Bt=te(Ft),_e=Z(Bt,0),_t=Gn(Kt,Ft,Bt),Rt,Le,bt,Ut,le,ee,ht={solarNoon:D(_t),nadir:D(_t-.5)};for(Rt=0,Le=bn.length;Rt<Le;Rt+=1)bt=bn[Rt],Ut=(bt[0]+at)*b,le=ge(Ut,tt,ft,_e,wt,Ft,Bt),ee=_t-(le-_t),ht[bt[1]]=D(ee),ht[bt[2]]=D(le);return ht};function Hn(L){var q=b*(218.316+13.176396*L),z=b*(134.963+13.064993*L),lt=b*(93.272+13.22935*L),tt=q+b*6.289*a(z),ft=b*5.128*a(lt),at=385001-20905*l(z);return{ra:W(tt,ft),dec:Z(tt,ft),dist:at}}Ot.getMoonPosition=function(L,q,z){var lt=b*-z,tt=b*q,ft=E(L),at=Hn(ft),ut=dt(ft,lt)-at.ra,wt=it(ut,tt,at.dec),Kt=_(a(ut),d(tt)*l(at.dec)-a(at.dec)*l(ut));return wt=wt+Wt(wt),{azimuth:Y(ut,tt,at.dec),altitude:wt,distance:at.dist,parallacticAngle:Kt}},Ot.getMoonIllumination=function(L){var q=E(L||new Date),z=Ht(q),lt=Hn(q),tt=149598e3,ft=w(a(z.dec)*a(lt.dec)+l(z.dec)*l(lt.dec)*l(z.ra-lt.ra)),at=_(tt*a(ft),lt.dist-tt*l(ft)),ut=_(l(z.dec)*a(z.ra-lt.ra),a(z.dec)*l(lt.dec)-l(z.dec)*a(lt.dec)*l(z.ra-lt.ra));return{fraction:(1+l(at))/2,phase:.5+.5*at*(ut<0?-1:1)/Math.PI,angle:ut}};function xe(L,q){return new Date(L.valueOf()+q*A/24)}Ot.getMoonTimes=function(L,q,z,lt){var tt=new Date(L);lt?tt.setUTCHours(0,0,0,0):tt.setHours(0,0,0,0);for(var ft=.133*b,at=Ot.getMoonPosition(tt,q,z).altitude-ft,ut,wt,Kt,Ft,Bt,_e,_t,Rt,Le,bt,Ut,le,ee,ht=1;ht<=24&&(ut=Ot.getMoonPosition(xe(tt,ht),q,z).altitude-ft,wt=Ot.getMoonPosition(xe(tt,ht+1),q,z).altitude-ft,Bt=(at+wt)/2-ut,_e=(wt-at)/2,_t=-_e/(2*Bt),Rt=(Bt*_t+_e)*_t+ut,Le=_e*_e-4*Bt*ut,bt=0,Le>=0&&(ee=Math.sqrt(Le)/(Math.abs(Bt)*2),Ut=_t-ee,le=_t+ee,Math.abs(Ut)<=1&&bt++,Math.abs(le)<=1&&bt++,Ut<-1&&(Ut=le)),bt===1?at<0?Kt=ht+Ut:Ft=ht+Ut:bt===2&&(Kt=ht+(Rt<0?le:Ut),Ft=ht+(Rt<0?Ut:le)),!(Kt&&Ft));ht+=2)at=wt;var ve={};return Kt&&(ve.rise=xe(tt,Kt)),Ft&&(ve.set=xe(tt,Ft)),!Kt&&!Ft&&(ve[Rt>0?"alwaysUp":"alwaysDown"]=!0),ve},f.exports=Ot})()}(vs)),vs.exports}var D0=k0();const N0=Ps(D0),{getTimes:W0,getPosition:B0}=N0;class Os{constructor(r){Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,r)}set start(r){this._data.start=r,Object.keys(this._cache).forEach(i=>{delete this._cache[i]})}get start(){return this._data.start}get startTime(){return I.isNumber(this._cache.startTime)?this._cache.startTime:(this._cache.startTime=Ms(this.start,this.timezone),this._cache.startTime)}get hasTOD(){return this.start instanceof Date&&!isNaN(this.start)}get sun(){if(this._cache.sun)return this._cache.sun;const r=W0(this.start,this.lat,this.lon),i=B0(r.nadir,this.lat,this.lon),a={},l=["nadir","dawn","sunrise","dusk","sunset","solarNoon"],d=["nadir","dawn","sunrise","dusk","sunset","noon"];return l.forEach((h,_)=>{isNaN(r[h])||(a[d[_]]=Ms(r[h],this.timezone))}),a.nadirAltitude=i.altitude*180/Math.PI,this._cache.sun=a,this._cache.sun}dateAtElapsed(r){const i=new Date(this.start);return i.setTime(i.getTime()+r*1e3),i}elapsedToTimeOfDay(r){return(this.startTime+r)%86400}serialize(){return I.pick(this,["start","sun","lat","lon","timezone"])}}var ms={},_u;function U0(){return _u||(_u=1,function(f){f.parseDMS=function(i){if(typeof l=="object")throw new TypeError("geo.parseDMS - dmsStr is [DOM?] object");if(typeof i=="number"&&isFinite(i))return Number(i);var a=String(i).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(a[a.length-1]==""&&a.splice(a.length-1),a=="")return NaN;switch(a.length){case 3:var l=a[0]/1+a[1]/60+a[2]/3600;break;case 2:var l=a[0]/1+a[1]/60;break;case 1:var l=a[0];break;default:return NaN}return/^-|[WS]$/i.test(i.trim())&&(l=-l),Number(l)},f.toDMS=function(i,a,l){if(typeof i=="object")throw new TypeError("geo.toDMS - deg is [DOM?] object");if(isNaN(i))return null;if(typeof a>"u"&&(a="dms"),typeof l>"u")switch(a){case"d":l=4;break;case"dm":l=2;break;case"dms":l=0;break;default:a="dms",l=0}switch(i=Math.abs(i),a){case"d":_=i.toFixed(l),_<100&&(_="0"+_),_<10&&(_="0"+_),dms=_+"°";break;case"dm":var d=(i*60).toFixed(l),_=Math.floor(d/60),w=(d%60).toFixed(l);_<100&&(_="0"+_),_<10&&(_="0"+_),w<10&&(w="0"+w),dms=_+"°"+w+"′";break;case"dms":var h=(i*3600).toFixed(l),_=Math.floor(h/3600),w=Math.floor(h/60)%60,b=(h%60).toFixed(l);_<100&&(_="0"+_),_<10&&(_="0"+_),w<10&&(w="0"+w),b<10&&(b="0"+b),dms=_+"°"+w+"′"+b+"″";break}return dms},f.toLat=function(i,a,l){var d=f.toDMS(i,a,l);return d==null?".":d.slice(1)+(i<0?"S":"N")},f.toLon=function(i,a,l){var d=f.toDMS(i,a,l);return d==null?".":d+(i<0?"W":"E")},f.toBrng=function(i,a,l){i=(Number(i)+360)%360;var d=f.toDMS(i,a,l);return d==null?".":d.replace("360","0")};var r=6371;f.latlon=function(i,a){this.lat=typeof i=="number"?i:typeof i=="string"&&i.trim()!=""?+i:NaN,this.lng=typeof a=="number"?a:typeof a=="string"&&a.trim()!=""?+a:NaN},f.latlon.prototype.distanceTo=function(i,a){typeof a>"u"&&(a=4);var l=this.distanceRadTo(i),d=r*l;return d.toPrecisionFixed(a)},f.latlon.prototype.distanceRadTo=function(i){var a=this.lat.toRad(),l=this.lng.toRad(),d=i.lat.toRad(),h=i.lng.toRad(),_=d-a,w=h-l,b=Math.sin(_/2)*Math.sin(_/2)+Math.cos(a)*Math.cos(d)*Math.sin(w/2)*Math.sin(w/2),A=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b));return A},f.latlon.prototype.bearingTo=function(i){var a=this.bearingRadTo(i);return(a.toDeg()+360)%360},f.latlon.prototype.bearingRadTo=function(i){var a=this.lat.toRad(),l=i.lat.toRad(),d=(i.lng-this.lng).toRad(),h=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(d),_=Math.cos(l)*Math.sin(d),w=Math.atan2(_,h);return w},f.latlon.prototype.finalBearingTo=function(i){var a=i.lat.toRad(),l=this.lat.toRad(),d=(this.lng-i.lng).toRad(),h=Math.sin(d)*Math.cos(l),_=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(d),w=Math.atan2(h,_);return(w.toDeg()+180)%360},f.latlon.prototype.midpointTo=function(i){var a=this.lat.toRad(),l=i.lat.toRad(),d=(i.lng-this.lng).toRad(),h=Math.cos(l)*Math.cos(d),_=Math.cos(l)*Math.sin(d),w=this.lng.toRad(),b=Math.atan2(Math.sin(a)+Math.sin(l),Math.sqrt((Math.cos(a)+h)*(Math.cos(a)+h)+_*_)),A=w+Math.atan2(_,Math.cos(a)+h);return A=(A+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(b.toDeg(),A.toDeg())},f.midpoint=function(i){var a=0,l=0,d=0;for(var h in i){var _=i[h],w=_.lat*Math.PI/180,b=_.lng*Math.PI/180,A=Math.cos(w)*Math.cos(b),v=Math.cos(w)*Math.sin(b),P=Math.sin(w);a+=A,l+=v,d+=P}a=a/i.length,l=l/i.length,d=d/i.length;var R=Math.atan2(l,a),D=Math.sqrt(a*a+l*l),E=Math.atan2(d,D);return new f.latlon(E*180/Math.PI,R*180/Math.PI)},f.latlon.prototype.interpolate=function(i,a){var l=this.distanceRadTo(i),d=this.bearingRadTo(i),h=this.lat.toRad(),_=this.lng.toRad();i.lat.toRad(),i.lng.toRad();for(var w=Math.sin(h),b=Math.cos(h),A=[],v=0;v<a;v++){var P=1/(a-1)*v,R=l*P,D=Math.sin(R),E=Math.cos(R),O=Math.asin(w*E+b*D*Math.cos(d)),W=_+Math.atan2(Math.sin(d)*D*b,E-w*Math.sin(O)),Z=O.toDeg(),Y=W.toDeg();for(Z>90&&(Z=90),Z<-90&&(Z=-90);Y>180;)Y-=360;for(;Y<=-180;)Y+=360;A.push(new f.latlon(Z,Y))}return A},f.latlon.prototype.destinationPoint=function(i,a){a=typeof a=="number"?a:typeof a=="string"&&a.trim()!=""?+a:NaN,a=a/r,i=i.toRad();var l=this.lat.toRad(),d=this.lng.toRad(),h=Math.asin(Math.sin(l)*Math.cos(a)+Math.cos(l)*Math.sin(a)*Math.cos(i)),_=d+Math.atan2(Math.sin(i)*Math.sin(a)*Math.cos(l),Math.cos(a)-Math.sin(l)*Math.sin(h));return _=(_+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(h.toDeg(),_.toDeg())},f.latlon.intersection=function(i,a,l,d){a=typeof a=="number"?a:typeof a=="string"&&trim(a)!=""?+a:NaN,d=typeof d=="number"?d:typeof d=="string"&&trim(d)!=""?+d:NaN;var h=i.lat.toRad(),_=i.lng.toRad(),w=l.lat.toRad(),b=l.lng.toRad(),A=a.toRad(),v=d.toRad(),P=w-h,R=b-_,D=2*Math.asin(Math.sqrt(Math.sin(P/2)*Math.sin(P/2)+Math.cos(h)*Math.cos(w)*Math.sin(R/2)*Math.sin(R/2)));if(D==0)return null;var E=Math.acos((Math.sin(w)-Math.sin(h)*Math.cos(D))/(Math.sin(D)*Math.cos(h)));isNaN(E)&&(E=0);var O=Math.acos((Math.sin(h)-Math.sin(w)*Math.cos(D))/(Math.sin(D)*Math.cos(w)));if(Math.sin(b-_)>0)var W=E,Z=2*Math.PI-O;else W=2*Math.PI-E,Z=O;var Y=(A-W+Math.PI)%(2*Math.PI)-Math.PI,it=(Z-v+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(Y)==0&&Math.sin(it)==0||Math.sin(Y)*Math.sin(it)<0)return null;var dt=Math.acos(-Math.cos(Y)*Math.cos(it)+Math.sin(Y)*Math.sin(it)*Math.cos(D)),Wt=Math.atan2(Math.sin(D)*Math.sin(Y)*Math.sin(it),Math.cos(it)+Math.cos(Y)*Math.cos(dt)),Mt=Math.asin(Math.sin(h)*Math.cos(Wt)+Math.cos(h)*Math.sin(Wt)*Math.cos(A)),te=Math.atan2(Math.sin(A)*Math.sin(Wt)*Math.cos(h),Math.cos(Wt)-Math.sin(h)*Math.sin(Mt)),Ht=_+te;return Ht=(Ht+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(Mt.toDeg(),Ht.toDeg())},f.latlon.prototype.rhumbDistanceTo=function(i){var a=r,l=this.lat.toRad(),d=i.lat.toRad(),h=(i.lat-this.lat).toRad(),_=Math.abs(i.lng-this.lng).toRad(),w=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(l/2+Math.PI/4)),b=isFinite(h/w)?h/w:Math.cos(l);Math.abs(_)>Math.PI&&(_=_>0?-(2*Math.PI-_):2*Math.PI+_);var A=Math.sqrt(h*h+b*b*_*_)*a;return A.toPrecisionFixed(4)},f.latlon.prototype.rhumbBearingTo=function(i){var a=this.lat.toRad(),l=i.lat.toRad(),d=(i.lng-this.lng).toRad(),h=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));Math.abs(d)>Math.PI&&(d=d>0?-(2*Math.PI-d):2*Math.PI+d);var _=Math.atan2(d,h);return(_.toDeg()+360)%360},f.latlon.prototype.rhumbDestinationPoint=function(i,a){var l=r,d=parseFloat(a)/l,h=this.lat.toRad(),_=this.lng.toRad();i=i.toRad();var w=d*Math.cos(i);Math.abs(w)<1e-10&&(w=0);var b=h+w,A=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(h/2+Math.PI/4)),v=isFinite(w/A)?w/A:Math.cos(h),P=d*Math.sin(i)/v;Math.abs(b)>Math.PI/2&&(b=b>0?Math.PI-b:-Math.PI-b);var R=(_+P+3*Math.PI)%(2*Math.PI)-Math.PI;return new f.latlon(b.toDeg(),R.toDeg())},f.latlon.prototype.rhumbMidpointTo=function(i){var a=this.lat.toRad(),l=this.lng.toRad(),d=i.lat.toRad(),h=i.lng.toRad();Math.abs(h-l)>Math.PI&&(l+=2*Math.PI);var _=(a+d)/2,w=Math.tan(Math.PI/4+a/2),b=Math.tan(Math.PI/4+d/2),A=Math.tan(Math.PI/4+_/2),v=((h-l)*Math.log(A)+l*Math.log(b)-h*Math.log(w))/Math.log(b/w);return isFinite(v)||(v=(l+h)/2),v=(v+3*Math.PI)%(2*Math.PI)-Math.PI,new f.latlon(_.toDeg(),v.toDeg())},f.latlon.prototype.lat=function(i,a){return typeof i>"u"?this.lat:f.toLat(this.lat,i,a)},f.latlon.prototype.lon=function(i,a){return typeof i>"u"?this.lng:f.toLon(this.lng,i,a)},f.latlon.prototype.toString=function(i,a){return typeof i>"u"&&(i="dms"),f.toLat(this.lat,i,a)+", "+f.toLon(this.lng,i,a)},typeof Number.prototype.toRad>"u"&&(Number.prototype.toRad=function(){return this*Math.PI/180}),typeof Number.prototype.toDeg>"u"&&(Number.prototype.toDeg=function(){return this*180/Math.PI}),typeof Number.prototype.toPrecisionFixed>"u"&&(Number.prototype.toPrecisionFixed=function(i){var a=this.toPrecision(i);return a=a.replace(/(.+)e\+(.+)/,function(l,d,h){d=d.replace(/\./,"");for(var _=d.length-1;h-- >_;)d=d+"0";return d}),a=a.replace(/(.+)e-(.+)/,function(l,d,h){for(d=d.replace(/\./,"");h-- >1;)d="0"+d;return"0."+d}),a}),typeof String.prototype.trim>"u"&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")})}(ms)),ms}var $n=U0();class Fs{constructor(r){if(r.length===3)[this.lat,this.lon,this.alt]=r;else if(r.length===5)[this.loc,this.lat,this.lon,this.alt,this.grade]=r;else throw new Error("Point data invalid")}get __class(){return"Point"}get latlon(){return new $n.latlon(this.lat,this.lon)}}function qr(f,r,i){const a=new Fs([f.lat,f.lon,f.alt]);a.loc=i;const l=new $n.latlon(f.lat,f.lon),d=new $n.latlon(r.lat,r.lon),h=Math.abs(a.loc-f.loc),_=l.bearingTo(d),w=l.destinationPoint(_,h);return a.lat=Number(w.lat),a.lon=Number(w.lng),["grade"].forEach(v=>{a[v]=f[v]}),["alt"].forEach(v=>{a[v]=nn(f.loc,r.loc,f[v],r[v],a.loc)}),a}const $0=Ke("models:Waypoint");class Ss{constructor(r){Object.defineProperty(this,"_data",{value:{}}),r=I.defaults(r,{loop:1}),Object.assign(this,r)}get __class(){return"Waypoint"}get site(){return this._data.site}set site(r){if(r.__class!=="Site")throw new TypeError('Waypoint "site" field must be of "Site" class.');this._data.site=r}get course(){return this.site.course}get name(){return this.loop>=2&&this.type!=="finish"?`${this.site.name} ${this.loop}`:this.site.name}get description(){return this.site.description}get loc(){return(this.site.percent+this.loop-1)*this.course.loopDist}set loc(r){if(!I.isNumber(r))throw new Error("Wrong format for Waypoint.loc");this.type==="start"?this.site.percent=0:this.type==="finish"?this.site.percent=1:this.site.percent=r/this.course.loopDist%1}get lat(){return I.isNumber(this.site.lat)||this.refreshLLA(),this.site.lat}get lon(){return I.isNumber(this.site.lon)||this.refreshLLA(),this.site.lon}get alt(){var r,i;return this.site.elevation===void 0&&((i=(r=this.course)==null?void 0:r.track)!=null&&i.points)&&this.refreshLLA(),this.site.elevation}set lat(r){this.site.lat=r}set lon(r){this.site.lon=r}set alt(r){this.site.elevation=r}get tier(){return this.site.tier||1}get type(){return this.site.type}get dropbags(){return this.site.dropbags||!1}set dropbags(r){this.site.dropbags=!!r}get crew(){return this.site.crew||!1}set crew(r){this.site.crew=!!r}get terrainFactor(){return this.site.terrainFactor}get terrainType(){return this.site.terrainType}len(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.len}gain(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.gain}loss(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.loss}time(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.time}pace(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.pace}elapsed(r){if(this.loc===0)return 0;const i=this.matchingSegment(r);if(i)return i.elapsed}get hasTypicalDelay(){return this.type==="aid"||this.type==="water"||this.loop>=2&&this.type==="start"}delay(r,i){console.warn('"Waypoint.delay" field is deprecated.');const a=i.find(l=>l.site===this.site._id&&this.loop===l.loop);return a?a.delay:this.hasTypicalDelay?r:0}get cutoff(){var r;if(this.tier===1){const i=(r=this.site.cutoffs)==null?void 0:r.find(a=>a.loop===this.loop);if(i)return i.time}return null}set cutoff(r){var a;const i=(a=this.site.cutoffs)==null?void 0:a.findIndex(l=>l.loop===this.loop);i>=0?r?this.site.cutoffs[i].time=r:this.site.cutoffs.splice(i,1):r&&(this.site.cutoffs||(this.site.cutoffs=[]),this.site.cutoffs.push({time:r,loop:this.loop}))}matchingSegment(r){return r.find(i=>i.waypoint.site._id===this.site._id&&i.waypoint.loop===this.loop)}refreshLLA(){var d,h,_;if($0("refreshLLA"),!((_=(h=(d=this.course)==null?void 0:d.track)==null?void 0:h.points)!=null&&_.length))throw new rn("No track points defined","points");let r,i,a,l;this.type==="start"?{lat:r,lon:i,alt:a}=this.course.track.points[0]:this.type==="finish"?{lat:r,lon:i,alt:a}=I.last(this.course.track.points):{lat:r,lon:i,alt:a,ind:l}=this.course.track.getLLA(this.loc/this.course.distScale,{start:this.site.pointsIndex||0}),this.lat=r,this.lon=i,this.alt=a,l&&(this.site.pointsIndex=l),this.course.clearCache(1)}serialize(){const r=I.pick(this,["loop","name","type","cutoff","loc","lat","lon","alt","tier","crew","dropbags","terrainType","terrainFactor"]);return r.site=this.site._id,r}}const Nr=Ke("models:Waypoint");class Wr{constructor(r){if(Nr(`constructor: ${r.name||"unnamed"}`),Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),r=I.defaults(r,{cutoffs:[]}),!r.course)throw new Error('Site requires "course" field to be defined.');Object.assign(this,r)}clearCache(){Nr(`clearCache: ${this.name}`),Object.keys(this._cache).forEach(r=>{delete this._cache[r]})}get __class(){return"Site"}get course(){return this._data.course}set course(r){if(r.__class!=="Course")throw new TypeError('Site "course" field must be of "Course" class.');this._data.course=r}get percent(){switch(this.type){case"start":return 0;case"finish":return 1;default:return this._data.percent}}set percent(r){this._data.percent=r}get waypoints(){return this._cache.waypoints?this._cache.waypoints:(Nr(`generating waypoints array: ${this.name}`),this.type==="finish"?this._cache.waypoints=[new Ss({site:this,loop:this.course.loops})]:this._cache.waypoints=I.range(this.course.loops).map(r=>new Ss({site:this,loop:r+1})),this._cache.waypoints)}serialize(){Nr(`serialize: ${this.name}`);const r=Object.keys(this);return r.push("percent"),I.pick(this,r)}}const Pu=({points:f,locs:r,gt:i})=>{const a=bu(f.map(d=>d.loc),f.map(d=>d.alt),r,i),l=[];return r.forEach((d,h)=>{let _=a[h][0]/10;_>50?_=50:_<-50&&(_=-50);const w=d*a[h][0]+a[h][1];l.push({grade:_,alt:w})}),l};function q0(f){const r=[];let i=0;for(i=0;i<f.length;i++)r.push(f[i].loc);const a=Pu({points:f,locs:r,gt:.05});f.forEach((l,d)=>{l.grade=a[d].grade})}const Tu=f=>{let r=0,i=0;f[0].loc=0;for(let a=1,l=f.length;a<l;a++)r=Number(f[a-1].latlon.distanceTo(f[a].latlon)),i+=r,f[a].loc=i},wn=Ke("models:Track");class Gr{constructor(r){wn("Creating new Track object"),Object.defineProperty(this,"_data",{value:{stats:{}}}),Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"type",{value:"course",enumerable:!0,writable:!0}),r.type&&(this.type=r.type),wn(`Initializing fields: ${Object.keys(r).join(", ")}`),Object.assign(this,r)}get __class(){return"Track"}clearCache(){Object.keys(this._cache).forEach(r=>{delete this._cache[r]})}set points(r){wn("set-points"),this.clearCache(),Array.isArray(r)||(r=r.lat.map((i,a)=>[r.lat[a],r.lon[a],r.alt[a]])),r[0].__class!=="Point"&&(r=r.map(i=>new Fs(i))),Tu(r),q0(r),this._data.points=r,wn(`set-points - ${r.length} points`)}get points(){return this._data.points}set start(r){this._data.start=r}get start(){var i;const r=(i=this.points)!=null&&i[0]?I.pick(this.points[0],["lat","lon"]):this._data.start;if(!r)throw new rn("Neither start not track points are defined.","points");return r}set finish(r){this._data.finish=r}get finish(){var i;const r=(i=this.points)!=null&&i.length?I.pick(I.last(this.points),["lat","lon"]):this._data.finish;if(!r)throw new rn("Neither finish nor points points are defined.","points");return r}set stats(r){Object.assign(this._data,r)}get stats(){if(this._cache.stats)return this._cache.stats;if(this.points){wn("Calculating");const r=I.last(this.points).loc;let i=0,a=0,l=0,d=this.points[0].alt;return this.points.forEach(h=>{l=h.alt-d,l<0?a+=l:i+=l,d=h.alt}),this._cache.stats={gain:i,loss:a,dist:r},this._cache.stats}return this._data.stats}get dist(){return this.stats.dist}set dist(r){this._data.stats.dist=r}get gain(){return this.stats.gain}set gain(r){this._data.stats.gain=r}get loss(){return this.stats.loss}set loss(r){this._data.stats.loss=r}getLLA(r,i={}){const a=Array.isArray(r),l=a?[...r]:[r];l.forEach((A,v)=>{A>this.dist&&(l[v]=A%this.dist)});let d=l.length===1&&i.start&&i.start<this.points.length-1?i.start:0;const h=!!(d&&this.points[d].loc>l[0]),_=[],w=this.points.length-1;r=l.shift();function b(A){return h?A+1:A-1}for(;d<=w&&d>=0;){let A,v;if(r===0?(A=this.points[0],v=0):He(r,this.dist,4)?(A=I.last(this.points),v=this.points.length-1):!h&&(d===w||this.points[d].loc>=r)||h&&(d===0||this.points[d].loc<=r)?this.points[d].loc===r||!h&&d===w||h&&d===0?(A=this.points[d],v=d):(A=qr(this.points[b(d)],this.points[d],r),v=d):h?d--:d++,A){const{lat:P,lon:R,alt:D,grade:E}=A;if(_.push({lat:P,lon:R,alt:D,grade:E,ind:v}),r=l.shift(),r==null)break}}return a?_:_[0]}getNearestPoint(r,i,a){let d=this.points.findIndex(w=>w===i),h=this.points[d],_=0;for(;a>.025;){const w=a/5,b=[h];for(let P=1;P<=5;P++){const R=h.loc+w*P;if(R<=this.dist){for(;this.points[d+1].loc<R&&d<this.points.length-1;)d++;b.push(this.points[d])}}const A=b.map(P=>Number(r.distanceTo(P.latlon)));_=Math.min(...A);const v=A.findIndex(P=>P===_);h=b[v],a=a/5}return{point:h,delta:_}}getNearestLoc(r,i=null,a){const d=new $n.latlon(r[0],r[1]);let h,_;const w=(b,A)=>{for(_=b;A>.025;){const v=A/5;let P=[];for(let E=-5;E<=5;E++){const O=_+v*E;O>0&&O<=this.dist&&P.push(Math.max(0,Math.min(O,this.dist)))}P=P.filter((E,O,W)=>W.indexOf(E)===O);const R=this.getLLA(P);R.forEach(E=>{const O=new $n.latlon(E.lat,E.lon);E.dist=Number(d.distanceTo(O))}),h=R.reduce((E,O)=>Math.min(E,O.dist),R[0].dist);const D=R.findIndex(E=>E.dist===h);_=P[D],A=A/5}};if(i!==null){i=Math.min(i,this.dist);const b=Math.max(.5,.05*this.dist);if(w(i,b),h<.1)return _}return i=this.dist/2,a=Math.max(this.dist-i,i),w(i,a),_}reduceDensity({spacing:r,length:i}={}){const a=wn.extend("reduceDensity");if(r||(r=.025),i||(i=this.points.length/2),this.dist/r>i/2)return a("Does not meet criteria"),this;const l=this.dist,d=Math.floor(l/r)+1,h=Array(d).fill(0).map((v,P)=>Nt(P++*r,3));h[h.length-1]<l&&h.push(l);const _=Pu({points:this.points,locs:h,gt:2*r}),w=this.getLLA(h,0).map((v,P)=>[Nt(v.lat,6),Nt(v.lon,6),Nt(_[P].alt,2)]),b=this.source,A=new Gr({source:b,points:w});return a(`Reduced from ${this.points.length} to ${A.points.length} points.`),A}}const be=Ke("models:Course");class z0{constructor(r){Object.defineProperty(this,"_cache",{value:{}}),Object.assign(this,r)}get __class(){return"CourseSplits"}get segments(){var r;return(r=this._cache.segments)!=null&&r.length||(this._cache.segments=Au({course:this.course})),this._cache.segments}set segments(r){this._cache.segments=r}get miles(){var r;return(r=this._cache.miles)!=null&&r.length||(this._cache.miles=$r({unit:"miles",course:this.course})),this._cache.miles}set miles(r){this._cache.miles=r}get kilometers(){var r;return(r=this._cache.kilometers)!=null&&r.length||(this._cache.kilometers=$r({unit:"kilometers",course:this.course})),this._cache.kilometers}set kilometers(r){this._cache.kilometers=r}}const G0=["cache","distance"];class H0{constructor(r){Object.defineProperty(this,"_data",{value:r._data||{sites:[new Wr({course:this,_id:I.random(1e4,2e4),name:"Start",type:"start",percent:0}),new Wr({course:this,_id:I.random(3e4,4e4),name:"Finish",type:"finish",percent:1})]},enumerable:!0}),Object.defineProperty(this,"_cache",{value:{}});const i=Object.keys(r).filter(a=>!G0.includes(a));Object.assign(this,I.pick(r,i))}get __class(){return"Course"}get loops(){return this._data.loops||1}set loops(r){r!==this._data.loops&&(this._data.loops=r,this.clearCache(2))}get dist(){var r;return this._cache.dist||(this._cache.dist=this._data.dist||((r=this.track)!=null&&r.dist?this.track.dist*this.loops:void 0))}get gain(){var r;return this._cache.gain||(this._cache.gain=this._data.gain||((r=this.track)!=null&&r.gain?this.track.gain*this.loops:void 0))}get loss(){var r;return this._cache.loss||(this._cache.loss=this._data.loss||((r=this.track)!=null&&r.loss?this.track.loss*this.loops:void 0))}set dist(r){He(r,this._data.dist,6)||(be(`overriding dist to ${r}`),this._data.dist=r,this.clearCache(2))}set gain(r){He(r,this._data.gain,6)||(be(`overriding gain to ${r}`),this._data.gain=r,this.clearCache(2))}set loss(r){He(r,this._data.loss,6)||(be(`overriding loss to ${r}`),this._data.loss=r,this.clearCache(2))}get distScale(){return this._data.dist?this._data.dist/(this.track.dist*this.loops):1}get gainScale(){return this._data.gain?this._data.gain/(this.track.gain*this.loops):1}get lossScale(){return this._data.loss?this._data.loss/(this.track.loss*this.loops):1}get loopDist(){return this.dist/this.loops}get loopGain(){return this.gain/this.loops}get loopLoss(){return this.loss/this.loops}get sites(){return this._data.sites}set sites(r){this._data.sites=r.map(i=>i.__class==="Site"?i:new Wr(I.assign(i,{course:this}))),this.clearCache(1)}clearCache(r=1){be(`clearCache-${r}`),(r===1?["waypoints","terrainFactors","cutoffs","stats","splits"]:Object.keys(this._cache)).forEach(a=>{delete this._cache[a]}),r===2&&this.sites.forEach(a=>{a.clearCache()})}get waypoints(){var i;if(this._cache.waypoints)return this._cache.waypoints;if(!((i=this.track)!=null&&i.dist))return[];let r=[];return this.sites.forEach(a=>{r.push(...a.waypoints)}),r=r.sort((a,l)=>a.loc-l.loc),this._cache.waypoints=r,this._cache.waypoints}get track(){return this._data.track}set track(r){be("set-track"),r.__class==="Track"?this._data.track=r:this._data.track=new Gr(r),this.clearCache(2)}get points(){var r,i;if(this._cache.points)return this._cache.points;if(be("generating points array"),!((i=(r=this.track)==null?void 0:r.points)!=null&&i.length))throw new rn("Track points are not defined.","points");this._cache.points=new Array(this.track.points.length*this.loops);for(let a=0;a<this.loops;a++)for(let l=0;l<this.track.points.length;l++)this.points[l+a*this.track.points.length]=new xs(this,this.track.points[l],a);return this._cache.points}set points(r){throw new Error("cannot set points directly")}getPoint({loc:r,insert:i=!1}){const a=this.points.findIndex(b=>zr(b.loc,r,4)),l=this.points[a];if(He(l.loc,r,4))return l;be(`getPoint: ${i?"inserting":"creating"} new CoursePoint at ${r}`);const d=a-1,h=this.points[d],_=qr(h.point,l.point,r%this.loopDist/this.distScale),w=new xs(this,_,Math.floor(r/this.loopDist));return h.actual&&l.actual&&(w.actual=qr(h.actual,l.actual,r),w.actual.elapsed=nn(h.loc,l.loc,h.actual.elapsed,l.actual.elapsed,w.loc)),i&&this.points.splice(a,0,w),w}refreshWaypointLLAs(){this.waypoints.filter(r=>r.loop===1||r.type==="finish").forEach(r=>{r.refreshLLA()})}get terrainFactors(){if(this._cache.terrainFactors)return this._cache.terrainFactors;be("regenerating terrainFactors");const r=this.waypoints.filter((i,a)=>{var l;return a===0||!I.isNil(i.terrainFactor)&&i.terrainFactor!==((l=this.waypoints[a-1])==null?void 0:l.terrainFactor)});return this._cache.terrainFactors=r.map((i,a)=>new J0({startWaypoint:i,endWaypoint:r[a+1]||I.last(this.waypoints),value:i.terrainFactor})),this._cache.terrainFactors}get terrainTypes(){if(this._cache.terrainTypes)return this._cache.terrainTypes;be("regenerating terrainTypes");const r=this.waypoints.filter((i,a)=>{var l;return!I.isNil(i.terrainType)&&i.terrainType!==((l=this.waypoints[a-1])==null?void 0:l.terrainType)});return this._cache.terrainTypes=r.map((i,a)=>new Z0({startWaypoint:i,endWaypoint:r[a+1]||I.last(this.waypoints),value:i.terrainType})),this._cache.terrainTypes}get cutoffs(){return this._cache.cutoffs?this._cache.cutoffs:(this._cache.cutoffs=this.waypoints.filter(r=>r.cutoff).map(r=>new K0({waypoint:r})),this._cache.cutoffs)}get splits(){return this._cache.splits||(this._cache.splits=new z0({course:this})),this._cache.splits}get stats(){if(this._cache.stats)return this._cache.stats;be("stats:calculate");const r=this.track.points.map(h=>h.alt),i=this.track.points.map(h=>h.grade),a=this.terrainFactors.map(h=>h.value/100+1),l={altitude:{avg:I.sum(this.track.points.map((h,_)=>{var w;return h.alt*(h.loc-(((w=this.track.points[_-1])==null?void 0:w.loc)||0))}))/this.track.dist,max:I.max(r),min:I.min(r)},grade:{avg:(I.last(this.track.points).alt-this.track.points[0].alt)/this.track.dist/10,max:I.max(i),min:I.min(i)},terrain:{avg:(I.sumBy(this.terrainFactors,h=>(h.end-h.start)*h.value)/this.dist+100)/100,max:I.max(a),min:I.min(a)}},d=h=>this.terrainFactors.reduce((_,w)=>w.value/100+1===h?_+w.end-w.start:_,0);return Object.assign(l.terrain,{maxDist:d(l.terrain.max),minDist:d(l.terrain.min)}),this._cache.stats=l,l}set stats(r){this._cache.stats=r}set eventStart(r){r?this._data.eventStart=new Date(r):delete this._data.eventStart,delete this._cache.event}get eventStart(){return this._data.eventStart}set eventTimezone(r){r?this._data.eventTimezone=r:delete this._data.eventTimezone,delete this._cache.event}get eventTimezone(){return this._data.eventTimezone}get event(){var a;if(this._cache.event)return this._cache.event;const r=this.eventStart||void 0,i=this.eventTimezone||void 0;return this._cache.event=r&&i&&((a=this.track)!=null&&a.start)?new Os({...this.track.start,start:r,timezone:i}):void 0,this._cache.event}}class K0{constructor(r){Object.assign(this,r)}get loc(){return this.waypoint.loc}get time(){return this.waypoint.cutoff}}class J0{constructor(r){r=I.defaults(r,{value:0}),Object.assign(this,r)}get start(){return this.startWaypoint.loc}get end(){return this.endWaypoint.loc}}class Z0{constructor(r){Object.assign(this,r)}get start(){return this.startWaypoint.loc}get end(){return this.endWaypoint.loc}}var ys={},vu;function Y0(){return vu||(vu=1,function(f){(function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(_){return l(h(_),arguments)}function a(_,w){return i.apply(null,[_].concat(w||[]))}function l(_,w){var b=1,A=_.length,v,P="",R,D,E,O,W,Z,Y,it;for(R=0;R<A;R++)if(typeof _[R]=="string")P+=_[R];else if(typeof _[R]=="object"){if(E=_[R],E.keys)for(v=w[b],D=0;D<E.keys.length;D++){if(v==null)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',E.keys[D],E.keys[D-1]));v=v[E.keys[D]]}else E.param_no?v=w[E.param_no]:v=w[b++];if(r.not_type.test(E.type)&&r.not_primitive.test(E.type)&&v instanceof Function&&(v=v()),r.numeric_arg.test(E.type)&&typeof v!="number"&&isNaN(v))throw new TypeError(i("[sprintf] expecting number but found %T",v));switch(r.number.test(E.type)&&(Y=v>=0),E.type){case"b":v=parseInt(v,10).toString(2);break;case"c":v=String.fromCharCode(parseInt(v,10));break;case"d":case"i":v=parseInt(v,10);break;case"j":v=JSON.stringify(v,null,E.width?parseInt(E.width):0);break;case"e":v=E.precision?parseFloat(v).toExponential(E.precision):parseFloat(v).toExponential();break;case"f":v=E.precision?parseFloat(v).toFixed(E.precision):parseFloat(v);break;case"g":v=E.precision?String(Number(v.toPrecision(E.precision))):parseFloat(v);break;case"o":v=(parseInt(v,10)>>>0).toString(8);break;case"s":v=String(v),v=E.precision?v.substring(0,E.precision):v;break;case"t":v=String(!!v),v=E.precision?v.substring(0,E.precision):v;break;case"T":v=Object.prototype.toString.call(v).slice(8,-1).toLowerCase(),v=E.precision?v.substring(0,E.precision):v;break;case"u":v=parseInt(v,10)>>>0;break;case"v":v=v.valueOf(),v=E.precision?v.substring(0,E.precision):v;break;case"x":v=(parseInt(v,10)>>>0).toString(16);break;case"X":v=(parseInt(v,10)>>>0).toString(16).toUpperCase();break}r.json.test(E.type)?P+=v:(r.number.test(E.type)&&(!Y||E.sign)?(it=Y?"+":"-",v=v.toString().replace(r.sign,"")):it="",W=E.pad_char?E.pad_char==="0"?"0":E.pad_char.charAt(1):" ",Z=E.width-(it+v).length,O=E.width&&Z>0?W.repeat(Z):"",P+=E.align?it+v+O:W==="0"?it+O+v:O+it+v)}return P}var d=Object.create(null);function h(_){if(d[_])return d[_];for(var w=_,b,A=[],v=0;w;){if((b=r.text.exec(w))!==null)A.push(b[0]);else if((b=r.modulo.exec(w))!==null)A.push("%");else if((b=r.placeholder.exec(w))!==null){if(b[2]){v|=1;var P=[],R=b[2],D=[];if((D=r.key.exec(R))!==null)for(P.push(D[1]);(R=R.substring(D[0].length))!=="";)if((D=r.key_access.exec(R))!==null)P.push(D[1]);else if((D=r.index_access.exec(R))!==null)P.push(D[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=P}else v|=2;if(v===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");A.push({placeholder:b[0],param_no:b[1],keys:b[2],sign:b[3],pad_char:b[4],align:b[5],width:b[6],precision:b[7],type:b[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");w=w.substring(b[0].length)}return d[_]=A}f.sprintf=i,f.vsprintf=a,typeof window<"u"&&(window.sprintf=i,window.vsprintf=a)})()}(ys)),ys}var Br=Y0();class Iu{constructor(r,i){this._target=r,this._callbacks=I.fromPairs(i.map(a=>[a,[]]))}add(r,i){if(!this._callbacks[r])throw new Error(`${r} is not a valid callback for object`);this._callbacks[r].find(a=>a===i)?console.warn("callback already exists."):this._callbacks[r].push(i)}remove(r,i){if(!this._callbacks[r])throw new Error(`${r} is not a valid callback for object`);I.pull(this._callbacks[r],i)}clear(r){(r?[r]:Object.keys(this._callbacks)).forEach(a=>this._callbacks[a]=[])}execute(r){this._callbacks[r].forEach(i=>i(this._target))}}const j0=Ke("PaceChunk");class mu{constructor(r={}){cu(this,"l");if(!I.has(r,"points"))throw new Error('"points" required.');if(!I.has(r,"constraints"))throw new Error('"constraints" required.');Object.assign(this,r)}set elapsed(r){this.constraints.elapsed=r}get elapsed(){return(I.isFunction(this.constraints[1])?this.constraints[1]():this.constraints[1])-this.constraints[0]}get dist(){return I.last(this.points).loc-I.first(this.points).loc}get pace(){return(this.elapsed-this.delay)/this.dist}get np(){return this.pace/this.factor}get moving(){return this.elapsed-this.delay}applyPacing(){delete this.plan.pacing._cache.factor;const r=this.points;r[0].elapsed=this.constraints[0],r[0].time=r[0].elapsed-I.sum(this.plan.pacing.chunks.filter(b=>b.points[0].loc<r[0].loc).map(b=>b.delay)),this.plan.event.start&&(r[0].tod=this.plan.event.elapsedToTimeOfDay(r[0].elapsed));let i=r[0].elapsed,a=r[0].delay||0,l=0,d=0,h=0;const _=this.factor?this.np:this.plan.pacing.pace,w=Object.fromEntries(Me.map(b=>[b,0]));for(let b=1,A=r.length;b<A;b++){l=r[b].loc-r[b-1].loc,bs(r[b-1],{plan:this.plan}),Me.forEach(P=>{w[P]+=r[b-1].factors[P]*l});const v=r[b-1].factors.combined;h+=v*l,d=_*v*l,r[b].time=r[b-1].time+d,a=r[b-1].delay||0,i+=d+a,r[b].elapsed=i,this.plan.event.start&&(r[b].tod=this.plan.event.elapsedToTimeOfDay(i))}bs(I.last(r),{plan:this.plan}),this.factors=new qn(Object.fromEntries(Me.map(b=>[b,w[b]/this.dist]))),this.factor=h/this.dist}calculate(){const a=j0.extend(Br.vsprintf("calculate:%.2f-%.2f",[I.first(this.points).loc,I.last(this.points).loc]));let l=this.factor||0,d;const h={};let _=!1;for(d=0;d<20&&(this.applyPacing(),h.iterations=d>=2,h.factor=!I.round(l-this.factor,10),l=this.factor,h.target=Math.abs((I.isFunction(this.constraints[1])?this.constraints[1]():this.constraints[1])-I.last(this.points).elapsed)<.1,a(Br.vsprintf("%i|%s",[d,Object.keys(h).map(w=>Br.vsprintf("%s=%s",[w,h[w]?"P":"F"])).join("|")])),_=!Object.keys(h).filter(w=>!h[w]).length,!_);d++);a("iteration complete"),this.status={tests:h,success:_,iterations:d+1}}}const Vt=Ke("Pacing");class X0{constructor(r={}){Object.defineProperty(this,"_cache",{value:{}}),this.callbacks=new Iu(this,["onUpdated","onFail","onInvalidated"]),Object.assign(this,r)}get __class(){return"Pacing"}clearCache(){Vt("clearCache"),Object.keys(this._cache).forEach(r=>{delete this._cache[r]})}invalidate(){Vt("invalidate"),this.chunks=[],this.clearCache(),this.callbacks.execute("onInvalidated")}get elapsed(){return Vt("elapsed:get"),this._cache.elapsed?this._cache.elapsed:I.last(this.plan.points).elapsed}get pace(){return Vt("pace:get"),(this.elapsed-this.plan.delay)/this.plan.course.dist}get factor(){return this._cache.factor?this._cache.factor:(Vt("factor:update"),this.chunks&&(this._cache.factor=I.sum(this.chunks.map(r=>r.factor*r.dist))/this.plan.course.dist),this._cache.factor||1)}get factors(){if(Vt("factors:get"),!!this.chunks)return this._cache.factors?this._cache.factors:(Vt("factors:update"),new qn(Object.fromEntries(Me.map(r=>[r,I.sum(this.chunks.map(i=>i.factors[r]*i.dist))/this.plan.course.dist]))))}get np(){return Vt("np:get"),this.pace/this.factor}get moving(){return this.elapsed-this.plan.delay}get status(){var r,i,a;return{complete:((r=this.chunks)==null?void 0:r.length)>0,success:((i=this.chunks)==null?void 0:i.filter(l=>{var d;return!((d=l.status)!=null&&d.success)}).length)===0,chunks:((a=this.chunks)==null?void 0:a.length)||0}}calculate(){var a,l,d;const r=Vt.extend("calculate");if(r("exec"),!((a=this.plan.points)!=null&&a.length))throw r("calculate: error; no points"),new rn("Plan points are not defined.","points");r("clearing cache"),this.clearCache(),r("adding points at each terrain factor break"),(l=this.plan.course.terrainFactors)==null||l.forEach(h=>this.plan.getPoint({loc:h.start,insert:!0})),r("adding points at each cutoff"),this.plan.adjustForCutoffs&&this.plan.cutoffs.forEach(h=>{h.point=this.plan.getPoint({loc:h.loc,insert:!0})}),this.plan.points.filter(h=>h.delay).forEach(h=>{delete h.delay}),(d=this.plan.delays)==null||d.forEach(h=>{const _=this.plan.getPoint({loc:h.loc,insert:!0});_.delay=h.delay}),r("creating pace chunks"),this.initChunks();const i=I.reverse([...this.plan.cutoffs]);i.unshift(null),i.push(null),i.forEach(h=>{for(;this.chunks.find(_=>!_.status);)this.calcChunks(),this.validateChunks();if(!h)return!0;if(h.point.elapsed-h.time>.5){r(`cutoff at ${h.loc} missed`);const _=this.chunks[0];I.last(_.points)===h.point?(r(`setting cutoff at ${h.loc}`),_.constraints=[0,h.time],delete _.status):this.splitChunk(_,{point:h.point,elapsed:h.time})}}),I.isFunction(I.last(this.chunks).constraints[1])&&this.chunks.length>2&&(r("rerunning last chunk"),I.last(this.chunks).calculate()),Vt(`pacing status=${this.status.success?"PASS":"FAIL"}.`),this.status.success?this.callbacks.execute("onUpdated"):this.callbacks.execute("onFail")}initChunks(){let r;switch(this.plan.pacingMethod){case"time":r=this.plan.pacingTarget;break;case"pace":r=this.plan.pacingTarget*this.plan.course.dist+this.plan.delay;break;case"np":r=()=>this.plan.pacingTarget*(this.factor||1)*this.plan.course.dist+this.plan.delay;break;default:throw new Error(`Incorrect pacing method ${this.plan.pacingMethod}`)}this.chunks=[new mu({plan:this.plan,points:this.plan.points,constraints:[0,r],delay:this.plan.delay})],this.plan.points.forEach(i=>{i._chunk=this.chunks[0]})}calcChunks(){Vt("calcChunks"),this.clearCache(),this.chunks.filter(r=>!r.status).forEach(r=>r.calculate())}validateChunks(){let r=1;for(;r<=this.chunks.length-1;)this.chunks[r].np<this.chunks[r-1].np?this.mergeChunks(this.chunks[r-1],this.chunks[r]):r++}splitChunk(r,{point:i,elapsed:a}){Vt.extend("split")(`breaking chunks at ${i.loc} km`);const d=r.points.findIndex(w=>w===i),h=I.round(i.elapsed-i.time),_=new mu({plan:this.plan,points:r.points.slice(0,d+1),constraints:[0,a],delay:h});_.points.filter((w,b)=>b<_.points.length-1).forEach(w=>{w._chunk=_}),this.chunks.unshift(_),r.constraints[0]=a,r.delay-=h,r.points=r.points.slice(d),delete r.status}mergeChunks(r,i){const a=this.chunks.findIndex(d=>d===r),l=this.chunks.findIndex(d=>d===i);if(l-a!==1)throw new Error("chunks must be sequential");Vt(Br.sprintf("calcChunks: merging %i&%i (%.2f&%.2f)",a,l,r.np,i.np)),r.points.pop(),r.points.push(...i.points),r.delay+=i.delay,delete r.status,r.points.forEach(d=>{d._chunk=r}),r.constraints=[r.constraints[0],i.constraints[1]],this.chunks.splice(l,1)}}const Q0=["lat","lon","alt","latlon","grade","loc","actual"];class As{constructor(r,i){Object.defineProperty(this,"_plan",{value:r}),Object.defineProperty(this,"_point",{value:i}),Object.defineProperty(this,"_chunk",{writable:!0,enumerable:!1}),Q0.forEach(a=>{Object.defineProperty(this,a,{get(){return this._point[a]}})})}get __class(){return"PlanPoint"}get np(){return this._chunk.np}get factor(){var r;return(r=this.factors)==null?void 0:r.combined}get pace(){const{np:r,factor:i}=this;if(i&&r)return i*r}}const St=Ke("models:Plan"),Ge=(f,r)=>T0(f.site,r.site)&&f.loop===r.loop;class V0{constructor(r){Object.defineProperty(this,"_cache",{value:{}}),Object.defineProperty(this,"_data",{value:{}}),Object.assign(this,r)}get __class(){return"PlanSplits"}get segments(){var r;return(r=this._cache.segments)!=null&&r.length||(St("calculating segments"),this.plan.checkPacing(),this._cache.segments=Au({plan:this.plan})),this._cache.segments}set segments(r){this._cache.segments=r}get miles(){var r;return(r=this._cache.miles)!=null&&r.length||(St("calculating miles"),this.plan.checkPacing(),this._cache.miles=$r({unit:"miles",plan:this.plan})),this._cache.miles}set miles(r){this._cache.miles=r}get kilometers(){var r;return(r=this._cache.kilometers)!=null&&r.length||(St("calculating kilometers"),this.plan.checkPacing(),this._cache.kilometers=$r({unit:"kilometers",plan:this.plan})),this._cache.kilometers}set kilometers(r){this._cache.kilometers=r}}class t_{constructor(r){if(Object.defineProperty(this,"pacing",{writable:!1,value:new X0({plan:this})}),Object.defineProperty(this,"_data",{value:{adjustForCutoffs:!0,delays:[],notes:[]},enumerable:!1}),Object.defineProperty(this,"_cache",{value:{},writable:!0}),r.course)Object.defineProperty(this,"course",{writable:!1,value:r.course});else throw new Error("Course required");const i=["course","_data","cache"];Object.keys(r).forEach(a=>{i.includes(a)||(this[a]=r[a])}),Object.defineProperty(this,"callbacks",{writable:!1,value:new Iu(this,["onUpdated"])})}get __class(){return"Plan"}clearCache(){St("clearCache"),this._cache={}}set eventStart(r){r?this._data.eventStart=new Date(r):delete this._data.eventStart,delete this._cache.event}get eventStart(){return this._data.eventStart}set eventTimezone(r){r?this._data.eventTimezone=r:delete this._data.eventTimezone,delete this._cache.event}get eventTimezone(){return this._data.eventTimezone}get event(){if(this._cache.event)return this._cache.event;let r=this.eventStart||this.course.eventStart;r||(console.warn("eventStart not defined in either plan or course, defaulting to zero."),r=new Date(0));let i=this.eventTimezone||this.course.eventTimezone;return i||(console.warn("eventTimezone not defined in either plan or course, defaulting to UTC."),i="UTC"),this._cache.event=new Os({...this.course.track.start,start:r,timezone:i}),this._cache.event}get adjustForCutoffs(){return this._data.adjustForCutoffs}set adjustForCutoffs(r){St("set:adjustForCutoffs"),this._data.adjustForCutoffs=r,delete this._cache.cutoffs}get cutoffs(){if(this._cache.cutoffs)return this._cache.cutoffs;this._cache.cutoffs=this.adjustForCutoffs?this.course.cutoffs.map(i=>new n_({courseCutoff:i,plan:this,point:this.getPoint({loc:i.loc,insert:!0})})):[];let r=0;for(;this._cache.cutoffs.length-1>=r;){const i=this._cache.cutoffs[r];this._cache.cutoffs.find((a,l)=>l>r&&a.time<=i.time)?(St(`get cutoffs: deleting extraneous cutoff at ${i.loc} km`),this._cache.cutoffs.splice(r,1)):r++}return this._cache.cutoffs}get strategy(){return this._cache.strategy?this._cache.strategy:(this._cache.strategy=new Su({values:this._data.strategy,length:this.course.dist}),this._cache.strategy)}set strategy(r){delete this._cache.strategy,I.isNil(r)?this._data.strategy=void 0:Array.isArray(r)&&r.length&&r.length===r.filter(i=>I.isNumber(i.onset)&&I.isNumber(i.value)&&I.isString(i.type)).length?this._data.strategy=r:(this._data.strategy=void 0,St('Plan "strategy" invalid.'))}get heatModel(){return this._cache.heatModel!==void 0?this._cache.heatModel:(this._data.heatModel?this._cache.heatModel=Object.assign({start:this.event.sun.sunrise+1800,stop:this.event.sun.sunset+7200},I.pick(this._data.heatModel,["baseline","max"])):this._cache.heatModel=null,this._cache.heatModel)}set heatModel(r){this._data.heatModel=r}get totalDelay(){return this.delays.reduce((r,i)=>r+i.delay,0)}get delays(){if(this._cache.delays)return this._cache.delays;const r=this.course.waypoints.map(a=>{var h;const l=(h=this._data.delays)==null?void 0:h.find(_=>Ge(_.waypoint,a)),d=l?l.delay:a.hasTypicalDelay?this.waypointDelay:0;return new e_({waypoint:a,delay:d})}).filter(a=>a.delay>0).sort((a,l)=>a.loc-l.loc);let i=0;for(;r.length-1>=i;)i>0&&r[i].loc===r[i-1].loc?(St(`get delays: merging delay at ${r[i].loc} km`),r[i-1].delay+=r[i].delay,r.splice(i,1)):i++;return this._cache.delays=r,this._cache.delays}set delays(r){if(I.isUndefined(r))r=[];else if(!I.isArray(r))throw new Error('"delays" must be an array');this._data.delays=r,delete this._cache.delays}get delay(){return this.totalDelay}get notes(){return this._cache.notes?this._cache.notes:(this._cache.notes=this._data.notes.map(r=>({waypoint:this.course.waypoints.find(i=>Ge(r.waypoint,i)),text:r.text})),this._cache.notes)}set notes(r){if(I.isUndefined(r))r=[];else if(!I.isArray(r))throw new Error('"notes" must be an array');this._data.notes=r,delete this._cache.notes}get splits(){return this._cache.splits||(St("creating splits"),this._cache.splits=new V0({plan:this})),this._cache.splits}getDelayAtWaypoint(r){var i;return((i=this.delays.find(a=>Ge(a.waypoint,r)))==null?void 0:i.delay)||0}getTypicalDelayAtWaypoint(r){return r.hasTypicalDelay?this.waypointDelay:0}getNoteAtWaypoint(r){var i;return((i=this.notes.find(a=>Ge(a.waypoint,r)))==null?void 0:i.text)||""}getPoint({loc:r,insert:i=!1}){const a=this.points.findIndex(w=>zr(w.loc,r,4)),l=this.points[a];if(He(l.loc,r,4))return l;St(`getPoint: ${i?"inserting":"creating"} new PlanPoint at ${r}`);const d=a-1,h=this.points[d],_=new As(this,this.course.getPoint({loc:r,insert:i}));if(!isNaN(h.time)&&!isNaN(l.time)){const w=l.elapsed-l.time-(h.elapsed-h.time);_.time=nn(h.loc,l.loc,h.time+w,l.time,l.loc),_.elapsed=l.elapsed-(l.time-_.time),this.event.start&&(_.tod=this.event.elapsedToTimeOfDay(_.elapsed))}return i&&this.points.splice(a,0,_),_}get points(){var r,i;if(!this._cache.points){if(St("creating points array"),!((i=(r=this.course)==null?void 0:r.points)!=null&&i.length))throw St("cannot create points array; course points are not defined."),new rn("Course points are not defined.","points");this._cache.points=this.course.points.map(a=>new As(this,a))}return this._cache.points}get events(){if(this._cache.events)return this._cache.events;St("calculating events.sun");const r=[],i=["dawn","sunrise","sunset","dusk"],a=this.event.elapsedToTimeOfDay(0),l=Math.ceil((a+I.last(this.points).elapsed)/86400);for(let d=0;d<l;d++)i.forEach(h=>{const _=this.event.sun[h]-a+86400*d;_>=0&&_<=I.last(this.points).elapsed&&r.push({event:h,elapsed:_})});return r.sort((d,h)=>d.elapsed-h.elapsed),r.length&&yu(this.points.map(h=>h.elapsed),this.points.map(h=>h.loc),r.map(h=>h.elapsed)).forEach((h,_)=>{r[_].loc=h}),this._cache.events={sun:r},this._cache.events}get stats(){if(this._cache.stats)return this._cache.stats;St("calculating stats.factors");const r=Object.fromEntries(Me.map(d=>{const h=this.points.map(_=>_.factors[d]);return[d,{min:I.min(h),max:I.max(h)}]}));St("calculating stats.sun");const i={day:{time:0,dist:0},twilight:{time:0,dist:0},dark:{time:0,dist:0}};let a=0,l=0;return this.points.forEach((d,h)=>{var _,w;a=d.loc-(((_=this.points[h-1])==null?void 0:_.loc)||0),l=d.elapsed-(((w=this.points[h-1])==null?void 0:w.elapsed)||0),!isNaN(this.event.sun.dawn)&&!isNaN(this.event.sun.dusk)&&(d.tod<=this.event.sun.dawn||d.tod>=this.event.sun.dusk)?(i.dark.time+=l,i.dark.dist+=a):d.tod<this.event.sun.sunrise||d.tod>this.event.sun.sunset?(i.twilight.time+=l,i.twilight.dist+=a):(i.day.time+=l,i.day.dist+=a)}),this._cache.stats={factors:r,sun:i},this._cache.stats}update(r){const i=St.extend("update");i(`fields: ${Object.keys(r).join(", ")}`),I.forOwn(r,(a,l)=>{switch(l){case"_id":case"name":case"description":this[l]=a;break;case"delays":{this._data.delays=a,delete this._cache.delays,this.invalidatePacing();break}case"delay":{let{delay:d,waypoint:h}=a;if(h=this.course.waypoints.find(w=>Ge(w,h)),!h)throw new Error("unknown waypoint");const _=this._data.delays.findIndex(w=>Ge(w.waypoint,h));d!==this.getTypicalDelayAtWaypoint(h)?_>=0?this._data.delays[_]={waypoint:h,delay:d}:this._data.delays.push({waypoint:h,delay:d}):_>=0&&this._data.delays.splice(_,1),delete this._cache.cutoffs,delete this._cache.delays,this.invalidatePacing();break}case"note":{let{text:d,waypoint:h}=a;if(h=this.course.waypoints.find(w=>Ge(w,h)),!h)throw new Error("unknown waypoint");const _=this._data.notes.findIndex(w=>Ge(w.waypoint,h));d?_>=0?this._data.notes[_]={waypoint:h,text:d}:this._data.notes.push({waypoint:h,text:d}):_>=0&&this._data.notes.splice(_,1),delete this._cache.notes;break}default:this[l]=a,i("clearCache, invalidatePacing"),this.clearCache(),this.invalidatePacing()}}),this.callbacks.execute("onUpdated")}invalidatePacing(){St("invalidatePacing"),this.pacing.invalidate(),delete this._cache.splits}checkPacing(){var r,i;if(St("checkPacing"),(r=this.pacing.status)!=null&&r.complete||(St("checkPacing: calculate"),this.pacing.calculate()),!((i=this.points)!=null&&i.length))throw new Error("No plan points");return!0}}class e_{constructor(r){Object.assign(this,r)}get loc(){return this.waypoint.loc}}class n_{constructor(r){Object.assign(this,r)}get waypoint(){return this.courseCutoff.waypoint}get loc(){return this.courseCutoff.loc}get time(){return this.courseCutoff.time-Math.max(this.plan.cutoffMargin||0,this.plan.getDelayAtWaypoint(this.waypoint))}}class r_ extends Ts{constructor(r=[]){super({}),this.segments=r}get first(){return this.segments[0]}get last(){return I.last(this.segments)}sum(r){if(!this.segments.find(i=>!I.isNumber(i[r])))return I.sumBy(this.segments,r)}get start(){return this.segments[0].start}get end(){return this.last.end}get len(){return this.sum("len")}get gain(){return this.sum("gain")}get loss(){return this.sum("loss")}set grade(r){this._data.grade=r}get grade(){return I.isNumber(this._data.grade)||(this._data.grade=this.segments.reduce((r,i)=>r+i.grade*i.len,0)/this.len),this._data.grade}get name(){return this.last.name}get time(){return this.sum("time")}get elapsed(){return this.last.elapsed}get actualElapsed(){return this.last.actualElapsed}get actualTime(){return this.sum("actualTime")}get tod(){return this.last.tod}get waypoint(){return this.last.waypoint}get factors(){const r={combined:1};return Me.forEach(i=>{const a=this.segments.reduce((l,d)=>l+d.len*d.factors[i],0);isNaN(a)||(r[i]=a/this.len),r.combined*=r[i]}),r}get status(){return this.last.status}get point1(){return this.first.point1}get point2(){return this.last.point2}}exports.Course=H0;exports.CoursePoint=xs;exports.Event=Os;exports.Factors=qn;exports.Plan=t_;exports.PlanPoint=As;exports.Point=Fs;exports.Segment=Ts;exports.Site=Wr;exports.Strategy=Su;exports.SuperSegment=r_;exports.Track=Gr;exports.Waypoint=Ss;exports.addLocations=Tu;exports.adjustStrategy=xu;exports.calcSegments=Es;exports.dateToTODSeconds=Ms;exports.factorList=Me;exports.getHeatFactor=Cu;exports.interpolatePoint=qr;exports.math=w0;exports.scaleDark=Mu;
